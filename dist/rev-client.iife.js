"use strict";var revClientLib=(()=>{var pe=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Ne=Object.prototype.hasOwnProperty;var ze=(s,n)=>{for(var t in n)pe(s,t,{get:n[t],enumerable:!0})},Be=(s,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Me(n))!Ne.call(s,i)&&i!==t&&pe(s,i,{get:()=>n[i],enumerable:!(e=Ge(n,i))||e.enumerable});return s};var Je=s=>Be(pe({},"__esModule",{value:!0}),s);var yt={};ze(yt,{RevClient:()=>_,RevError:()=>C,ScrollError:()=>V,default:()=>mt,utils:()=>dt});var{toString:Qe}=Object.prototype;function v(s){if(Qe.call(s)!=="[object Object]")return!1;let n=Object.getPrototypeOf(s);return n===null||n===Object.getPrototypeOf({})}function H(s){return typeof s?.stream=="function"}function Se(s){return`${s[0]}${s.slice(1)}`}function Ze(s){let n=crypto.getRandomValues(new Uint8Array(s/2));return Array.from(n).map(t=>t.toString(16).padStart(2,"0")).join("")}async function Ye(s){let n=new TextEncoder().encode(s),t=await crypto.subtle.digest("SHA-256",n),e=String.fromCharCode(...new Uint8Array(t));return btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}async function Xe(s,n){let t=new TextEncoder,e=await crypto.subtle.importKey("raw",t.encode(n),{name:"HMAC",hash:"SHA-256"},!0,["sign"]),i=await crypto.subtle.sign("HMAC",e,t.encode(s));return btoa(String.fromCharCode(...new Uint8Array(i)))}var h={AbortController:globalThis.AbortController,AbortSignal:globalThis.AbortSignal,createAbortError(s){return new DOMException(s,"AbortError")},fetch:(...s)=>globalThis.fetch(...s),FormData:globalThis.FormData,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response,randomValues:Ze,sha256Hash:Ye,hmacSign:Xe,async parseFileUpload(s,n){let{filename:t,contentType:e,contentLength:i}=n;if(H(s)){let{type:r,name:o,size:a}=s;return r&&!e&&(e=r),o&&!t&&(t=o),a&&!i&&(i=a),{file:s,options:{...n,filename:t,contentType:e,contentLength:i}}}throw new TypeError("Only Blob / Files are supported for file uploads. Pass a File/Blob object")},appendFileToForm(s,n,t){let{file:e,options:{filename:i}}=t;s.append(n,e,i)},async prepareUploadHeaders(s,n,t){}};var Ae=60*1e3;function et(s,n={}){if(s&&typeof s=="object"&&(n=Object.assign({},s,n),s=void 0),s||(s=n.fn),typeof s!="function")throw new TypeError("Rate limit function is not a function");let{perSecond:t,perMinute:e,perHour:i,signal:r}=n,o=parseFloat(n.limit)||1,a=parseInt(n.interval,10);if(t&&(o=parseFloat(t),a=1e3),e&&(o=parseFloat(e),a=Ae),i&&(o=parseFloat(i),a=Ae*60),o<1?(a/=o,o=1):o=Math.floor(o),!Number.isFinite(o))throw new TypeError(`Invalid limit ${o}`);if(!Number.isFinite(a)||a<=0)throw new TypeError("Invalid interval option");let c=new Map,p=0,u=0,l=function(...g){let d;return new Promise((f,b)=>{let R=()=>{f(s.apply(null,g)),c.delete(d)},T=Date.now();T-p>a?(u=1,p=T):u<o?u++:(p+=a,u=1),d=setTimeout(R,p-T),c.set(d,b)})},m=r?()=>l.abort(r.reason?`${r.reason}`:void 0,!0):void 0;return l.abort=(g="Cancelled rate-limit queue",d=!1)=>{d&&r?.removeEventListener("abort",m);for(let[f,b]of c.entries())clearTimeout(f),b(h.createAbortError(g));c.clear()},r?.addEventListener("abort",m),l}var k=et;var ue={get:24e3,post:3600,searchVideos:120,uploadVideo:30,updateVideo:30,videoDetails:2e3,attendeesRealtime:2,auditEndpoint:60,loginReport:10},Oe=()=>Promise.resolve();function Ee(s){return{...s&&ue,...typeof s=="object"&&s}}function le(s,n){let t=ue[s],e=n??t;if(!isFinite(e)||e<=0)return Oe;let i=e/12;return k({fn:Oe,limit:i,interval:5e3})}function Ce(s={}){let n=Object.keys(ue).map(t=>[t,le(t,s[t])]);return Object.fromEntries(n)}function qe(s,n){Object.values(s).forEach(e=>e.abort?.(n))}function I(s,n){return s?(s instanceof Date||(s=new Date(s)),isNaN(s.getTime())?n:s):n}async function De(s,n=()=>!0,t=3,e=1e3){let i=0;for(;i<t;)try{return await s()}catch(r){if(i+=1,i>=t||!n(r,i))throw r;await F(e)}}async function F(s,n){return new Promise(t=>{let e,i=()=>{clearTimeout(e),n?.removeEventListener("abort",i),t()};e=setTimeout(i,s),n?.addEventListener("abort",i)})}function E(s){if(s!=="null"&&s)try{return JSON.parse(s)}catch{}return null}var C=class s extends Error{constructor(t,e){let{status:i=500,statusText:r="",url:o}=t;super(`${i} ${r}`);if("captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor),this.status=i,this.url=o,this.code=`${i}`,this.detail=r,v(e))e.code&&(this.code=e.code),e.detail&&(this.detail=e.detail);else if(typeof e=="string")if(e=e.trim(),e.startsWith("{")){let{code:a,detail:c}=E(e)||{};a&&(this.code=a),c&&(this.detail=c)}else this.status===429?this.detail="Too Many Requests":/^(<!DOCTYPE|<html)/.test(e)&&(this.detail=e.replace(/.*<body>\s+/s,"").replace(/<\/body>.*/s,"").slice(0,256))}get name(){return"RevError"}get[Symbol.toStringTag](){return"RevError"}static async create(t){let e;try{e=await t.text()}catch(i){e={code:"Unknown",detail:`Unable to parse error response body: ${i}`}}return new s(t,e)}},V=class extends Error{constructor(t=408,e="ScrollExpired",i="Timeout while fetching all results in search request"){super("Search Scroll Expired");Error.captureStackTrace(this,this.constructor),this.status=t,this.code=e,this.detail=i}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var A=class{constructor(n={}){this.options={maxResults:1/0,onProgress:(t,e,i)=>{},onError:t=>{throw t},onScrollError:t=>{console.warn("DEPRECATED: use onError instead of onScrollError with rev search requests"),this.options.onError(t)},...n},this.current=0,this.total=void 0,this.done=!1}async nextPage(){let{onProgress:n,onError:t}=this.options;if(this.done)return{current:this.current,total:this.current,done:this.done,items:[]};let e=await this._requestPage(),i=this._parsePage(e),{current:r,items:o,total:a,done:c,error:p}=i;return n(o,r,a),p&&t(p),{current:r,items:o,total:a,done:c}}_parsePage(n){let{maxResults:t}=this.options,{items:e=[],done:i=this.done,total:r,pageCount:o,error:a}=n;i&&(this.done=!0),isFinite(r)&&(this.total=Math.min(r,t)),o||(o=e.length);let c=this.current;return c+o>=t&&(o=t-c,e=e.slice(0,o),this.done=!0),this.current+=o,this.current===this.total&&(this.done=!0),this.done&&(this.total=this.current),a&&(this.done=!0),{current:c,total:this.total,done:this.done,error:a,items:e}}async exec(){let n=[];for await(let t of this)n.push(t);return n}async*[Symbol.asyncIterator](){do{let{items:n}=await this.nextPage();for await(let t of n)yield t}while(!this.done)}};async function Ie(s,n){let t=s.headers.get("Content-Type")||n||"",e=s.headers.get("Content-Length");if(t.startsWith("application/json")&&e!=="0")try{return await s.json()}catch{}return t.startsWith("text")?s.text():s.body}var y=class extends A{constructor(t,e,i={},r={}){super({onProgress:(c,p,u)=>{let{hitsKey:l}=e;t.log("debug",`searching ${l}, ${p}-${p+c.length} of ${u}...`)},onError:c=>{throw c},...r});let{scrollId:o,...a}=i;this.query=a,this._reqImpl=this._buildReqFunction(t,e),this.current=0,this.total=1/0,this.done=!1}_requestPage(){return this._reqImpl()}_buildReqFunction(t,e){let{endpoint:i,totalKey:r,hitsKey:o,isPost:a=!1,request:c,transform:p}=e,u=c||(a?t.post.bind(t):t.get.bind(t));return async()=>{let l=await u(i,this.query,{responseType:"json"}),{scrollId:m,[r]:g,[o]:d=[],statusCode:f,statusDescription:b}=l,R=!1;this.query.scrollId=m,m||(R=!0);let T=typeof p=="function"?await Promise.resolve(p(d)):d;T.length===0&&(R=!0);let x=f>=400&&b?new V(f,b):void 0;return{total:g,done:R,pageCount:d.length,items:T,error:x}}}};function W(s){let n,t,e={async roles(i=!0){if(n&&i===!0)return n;let r=await s.get("/api/v2/users/roles");return i&&(n=r),r},async getRoleByName(i,r=!0){let o=await e.roles(r),a=o.find(c=>c.roleType===i||c.name===i);if(!a)throw new TypeError(`Invalid Role Name ${i}. Valid values are: ${o.flatMap(c=>c.roleType?[c.roleType,c.name]:[c.name]).join(", ")}`);return{id:a.id,name:a.roleType||a.name}},async customFields(i=!0){if(t&&i===!0)return t;let r=await s.get("/api/v2/video-fields",void 0,{responseType:"json"});return i&&(t=r),r},async getCustomFieldByName(i,r=!0){let o=await e.customFields(r),a=o.find(c=>c.name===i);if(!a)throw new TypeError(`Invalid Custom Field Name ${i}. Valid values are: ${o.map(c=>c.name).join(", ")}`);return a},async brandingSettings(){return s.get("/api/v2/accounts/branding-settings")},async webcastRegistrationFields(){return(await s.get("/api/v2/accounts/webcast-registration-fields")).registrationFields},async createWebcastRegistrationField(i){return(await s.post("/api/v2/accounts/webcast-registration-fields",i)).fieldId},async updateWebcastRegistrationField(i,r){return s.put(`/api/v2/accounts/webcast-registration-fields/${i}`,r)},async deleteWebcastRegistrationField(i){return s.delete(`/api/v2/accounts/webcast-registration-fields/${i}`)},listIQCreditsUsage(i,r){let o={endpoint:"/api/v2/analytics/accounts/iq-credits-usage",totalKey:"total",hitsKey:"sessions"};return new y(s,o,i,r)},async verifySystemHealth(){return await s.get("/api/v2/system-health"),!0},async maintenanceSchedule(){let{schedules:i}=await s.get("/api/v2/maintenance-schedule");return i},async userLocationService(){return s.get("/api/v2/user-location")},async expirationRules(){return s.get("/api/v2/expiration-rules")},async featureSettings(i){let r=i?{videoId:i}:void 0;return s.get("/api/v2/videos/feature-settings",r)}};return e}function $e(s){s=s.replace(/(\r\n|\n|\r)/gm,`
`).replace(/\n$/g,"");let n="",t=!1,e=!1,i="",r=[],o=[],a,c=s.length;function p(l){if(e)return l;if(l!=="")return l.trim()}for(a=0;a<c;a+=1)n=s.charAt(a),!t&&(n===","||n===`
`)?(i=p(i),r.push(i),n===`
`&&(o.push(r),r=[]),i="",e=!1):n==='"'?t?s.charAt(a+1)==='"'?(i+='"',a+=1):t=!1:(t=!0,e=!0):i+=n===`
`?`
`:n;i=p(i),r.push(i),o.push(r);let u=o.shift();return o.map(l=>{let m={};return l.forEach((g,d)=>{g!==void 0&&(m[u[d]]=g)}),m})}function tt(s){return{messageKey:s.MessageKey,entityKey:s.EntityKey,when:s.When,entityId:s.EntityId,principal:E(s.Principal)||{},message:E(s.Message)||{},currentState:E(s.CurrentState)||{},previousState:E(s.PreviousState)||{}}}var w=class extends A{constructor(t,e,i="audit records",{toDate:r,fromDate:o,beforeRequest:a,...c}={}){super({onProgress:(l,m,g)=>{t.log("debug",`loading ${i}, ${m} of ${g}...`)},...c});let{from:p,to:u}=this._parseDates(o,r);this.params={toDate:u.toISOString(),fromDate:p.toISOString()},this._req=this._buildReqFunction(t,e,a)}_requestPage(){return this._req()}_buildReqFunction(t,e,i){return async()=>{await i?.(this);let r=await t.request("GET",e,this.params,{responseType:"text"}),{body:o,headers:a}=r,c=$e(o).map(l=>tt(l)),p=parseInt(a.get("totalRecords")||"",10);Object.assign(this.params,{nextContinuationToken:a.get("nextContinuationToken")||void 0,fromDate:a.get("nextfromDate")||void 0});let u=!this.params.nextContinuationToken;return{items:c,total:p,done:u}}}_parseDates(t,e){let i=I(e,new Date),r=new Date(i);r.setFullYear(i.getFullYear()-1);let o=I(t,r);return i<o&&([i,o]=[o,i]),{from:o,to:i}}};function K(s,n){let t=Ee(n).auditEndpoint;function e(){if(!t)return a=>a;let o=le("auditEndpoint",t);return(a={})=>({...a,async beforeRequest(c){return await o(),a.beforeRequest?.(c)}})}let i={accountAccess:e(),userAccess:e(),accountUsers:e(),user:e(),accountGroups:e(),group:e(),accountDevices:e(),device:e(),accountVideos:e(),video:e(),accountWebcasts:e(),webcast:e(),principal:e()};return{accountAccess(o,a){let c=i.accountAccess(a);return new w(s,`/network/audit/accounts/${o}/userAccess`,"UserAccess",c)},userAccess(o,a,c){let p=i.userAccess(c);return new w(s,`/network/audit/accounts/${a}/userAccess/${o}`,`UserAccess_${o}`,p)},accountUsers(o,a){let c=i.accountUsers(a);return new w(s,`/network/audit/accounts/${o}/users`,"User",c)},user(o,a,c){let p=i.user(c);return new w(s,`/network/audit/accounts/${a}/users/${o}`,"User",p)},accountGroups(o,a){let c=i.accountGroups(a);return new w(s,`/network/audit/accounts/${o}/groups`,"Groups",c)},group(o,a,c){let p=i.group(c);return new w(s,`/network/audit/accounts/${a}/groups/${o}`,"Group",p)},accountDevices(o,a){let c=i.accountDevices(a);return new w(s,`/network/audit/accounts/${o}/devices`,"Devices",c)},device(o,a,c){let p=i.device(c);return new w(s,`/network/audit/accounts/${a}/devices/${o}`,"Device",p)},accountVideos(o,a){let c=i.accountVideos(a);return new w(s,`/network/audit/accounts/${o}/videos`,"Videos",c)},video(o,a,c){let p=i.video(c);return new w(s,`/network/audit/accounts/${a}/videos/${o}`,"Video",p)},accountWebcasts(o,a){let c=i.accountWebcasts(a);return new w(s,`/network/audit/accounts/${o}/scheduledEvents`,"Webcasts",c)},webcast(o,a,c){let p=i.webcast(c);return new w(s,`/network/audit/accounts/${a}/scheduledEvents/${o}`,"Webcast",p)},principal(o,a,c){let p=i.principal(c);return new w(s,`/network/audit/accounts/${a}/principals/${o}`,"Principal",p)}}}function $(s,n){let t=new h.Headers(s);return new h.Headers(n).forEach((e,i)=>t.set(i,e)),t}var st="http://rev";function Ue(s,n,t){let e=new URL("/api/v2/oauth2/authorize",s.revUrl);return e.search=new URLSearchParams({client_id:s.oauthApiKey,code_challenge:n,response_type:"code",redirect_uri:s.redirectUri,...t&&{state:t}}).toString(),e.toString()}async function ke(s=h.randomValues(48)){let n=await h.sha256Hash(s);return{codeVerifier:s,codeChallenge:n}}async function de(s,n,t="1"){let{hmacSign:e}=h,i="code",{oauthApiKey:r,redirectUri:o}=s,c=`${r}::${new Date().toISOString()}`,p=await e(c,n);return{apiKey:r,signature:p,verifier:c,redirect_uri:o,response_type:i,state:t}}function Fe(s){typeof s=="string"&&(s=new URL(s,st)),s instanceof URL&&(s=s.searchParams);let n=s instanceof URLSearchParams?Object.fromEntries(s):s,{auth_code:t="",state:e="",error:i=void 0}=n;return{isSuccess:!i,authCode:`${t}`.replace(/ /g,"+"),state:e,error:i}}function G(s){let n={async loginToken(t,e,i){return s.post("/api/v2/authenticate",{apiKey:t,secret:e},i)},async extendSessionToken(t){return s.post(`/api/v2/auth/extend-session-timeout/${t}`)},async logoffToken(t){return s.delete(`/api/v2/tokens/${t}`)},async loginUser(t,e,i){return s.post("/api/v2/user/login",{username:t,password:e},i)},async logoffUser(t){return s.post("/api/v2/user/logoff",{userId:t})},async extendSessionUser(t){return s.post("/api/v2/user/extend-session-timeout",{userId:t})},async loginJWT(t,e){return s.get("/api/v2/jwtauthenticate",{jwt_token:t},e)},async loginGuestRegistration(t,e,i){let r={...i,headers:$(i?.headers,{"x-requested-with":"xmlhttprequest"})};return s.post(`/external/auth/jwt/${t}`,{token:`vbrick_rev ${e}`},i)},async extendSession(){return s.post("/api/v2/user/extend-session")},async verifySession(){return s.get("/api/v2/user/session")},get logoutUser(){return n.logoffUser},get logoutToken(){return n.logoffToken},async buildOAuth2Authentication(t,e="1",i){let{codeChallenge:r,codeVerifier:o}=await ke(i);return{url:`${Ue(t,r,e)}`,codeVerifier:o}},async loginOAuth2(t,e,i,r){return s.post("/api/v2/oauth2/token",{code:e.replace(/ /g,"+"),client_id:t.oauthApiKey,grant_type:"authorization_code",redirect_uri:t.redirectUri,code_verifier:i},r)},async buildOAuthAuthenticationURL(t,e,i="1"){let r=await de(t,e,i),o=new URL("/api/v2/oauth/authorization",s.url);return o.search=`${new URLSearchParams(r)}`,`${o}`},buildOAuthAuthenticationQuery:de,parseOAuthRedirectResponse:Fe,async loginOAuth(t,e){let i="authorization_code",{oauthApiKey:r,redirectUri:o}=t;return e=e.replace(/ /g,"+"),s.post("/api/v2/oauth/token",{authCode:e,apiKey:r,redirectUri:o,grantType:i})},async extendSessionOAuth(t,e){let i="refresh_token",{oauthApiKey:r}=t;return s.post("/api/v2/oauth/token",{apiKey:r,refreshToken:e,grantType:i})}};return n}function M(s){return{async create(t){return s.post("/api/v2/categories",t,{responseType:"json"})},async details(t){return s.get(`/api/v2/categories/${t}`,void 0,{responseType:"json"})},async update(t,e){return s.put(`/api/v2/categories/${t}`,e)},async delete(t){return s.delete(`/api/v2/categories/${t}`)},async list(t,e){let i=Object.assign({},t&&{parentCategoryId:t},e!=null&&{includeAllDescendants:e}),{categories:r}=await s.get("/api/v2/categories",i,{responseType:"json"});return r},async listAssignable(){return s.get("/api/v2/assignable-categories")}}}function N(s){return{async create(t){let{channelId:e}=await s.post("/api/v2/channels",t,{responseType:"json"});return e},async update(t,e){return s.put(`/api/v2/channels/${t}`,e)},async delete(t){return s.delete(`/api/v2/channels/${t}`)},list(t=0,e={}){return new me(s,t,e)},async addMembers(t,e){let i=e.map(r=>({op:"add",path:"/Members/-",value:r}));await s.patch(`/api/v2/channels/${t}`,i)},async removeMembers(t,e){let i=e.map(r=>({op:"remove",path:"/Members",value:typeof r=="string"?r:r.id}));await s.patch(`/api/v2/channels/${t}`,i)},search(t,e={}){let i={endpoint:`/api/v2/search/access-entity${e?.assignable?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities"},r={type:e.type||"Channel",...t&&{q:t}};return new y(s,i,r,e)}}}var me=class{constructor(n,t=0,e={}){this.options={maxResults:1/0,pageSize:10,onProgress:(i,r,o)=>{n.log("debug",`loading channels, ${r} of ${o}...`)},...e},this.current=0,this.total=1/0,this.done=!1,this.currentPage=t,this._req=()=>{let i={page:this.currentPage,size:this.options.pageSize};return n.get("/api/v2/channels",i,{responseType:"json"})}}async nextPage(){let{maxResults:n,onProgress:t}=this.options,e=this.current,i=await this._req();if((!Array.isArray(i)||i.length==0)&&(this.done=!0,i=[]),e+i.length>=n){let r=n-e;i=i.slice(0,r),this.done=!0}return this.total=e+i.length,t(i,e,this.total),this.current+=i.length,this.currentPage+=1,{current:e,total:this.total,done:this.done,items:i}}async exec(){let n=[];for await(let t of this)n.push(t);return n}async*[Symbol.asyncIterator](){do{let{items:n}=await this.nextPage();for await(let t of n)yield t}while(!this.done)}};function z(s){return{async listDMEs(){return(await s.get("/api/v2/devices/dmes")).devices},async listZoneDevices(){return(await s.get("/api/v2/zonedevices")).devices},async listPresentationProfiles(){return s.get("/api/v2/presentation-profiles")},async add(t){return s.post("/api/v2/devices/dmes",t)},async healthStatus(t){return s.get(`/api/v2/devices/dmes/${t}/health-status`)},async delete(t){return s.delete(`/api/v2/devices/dmes/${t}`)},async rebootDME(t){return s.put(`/api/v2/devices/dmes/${t}`)}}}function B(s){let n={async create(t){let{groupId:e}=await s.post("/api/v2/groups",t);return e},async delete(t){await s.delete(`/api/v2/groups/${t}`)},async details(t){return s.get(`/api/v2/groups/${t}`)},search(t,e={}){let i={endpoint:`/api/v2/search/access-entity${e?.assignable?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities",transform:o=>o.map(it)},r={type:"group"};return t&&(r.q=t),new y(s,i,r,e)},list(t={}){return n.search(void 0,t)},listUsers(t,e={}){let i={endpoint:`/api/v2/search/groups/${t}/users`,totalKey:"totalUsers",hitsKey:"userIds"};return new y(s,i,void 0,e)},listUserDetails(t,e={}){let i={endpoint:`/api/v2/search/groups/${t}/users`,totalKey:"totalUsers",hitsKey:"userIds",transform:async r=>{let o=[];for(let a of r){let c={userId:a};try{let p=await s.user.details(a);Object.assign(c,p)}catch(p){c.error=p}o.push(c)}return o}};return new y(s,i,void 0,e)}};return n}function it(s){return{id:s.Id,name:s.Name,entityType:s.EntityType}}function nt(s,n){let t=["scrollId","statusCode","statusDescription"];return Object.fromEntries(Object.entries(s).filter(([i,r])=>!(i===n||t.includes(i)||Array.isArray(r))))}var J=class extends y{constructor(t,e,i={},r={}){let o={endpoint:`/api/v2/playlists/${e}`,totalKey:"totalVideos",hitsKey:"videos",request:async(a,c,p)=>{await t.session.queueRequest("searchVideos");let u=await t.get(a,c,p);return Object.assign(this.playlist,nt(u,"videos")),u}};super(t,o,i,r);this.playlist={}}get playlistName(){return this.playlist.name||this.playlist.playlistDetails?.name}get dynamicSearchCriteria(){return this.playlist?.playlistType==="Dynamic"?this.playlist.playlistDetails?.playlistDetails||this.playlist.playlistDetails:void 0}async getPlaylistInfo(){this.options.maxResults=0;let{items:t}=await this.nextPage();return{...this.playlist,videos:t,playlistName:this.playlistName,dynamicSearchCriteria:this.dynamicSearchCriteria}}};function Q(s){return{async create(t,e){let r=Array.isArray(e)?{name:t,playlistType:"Static",videoIds:e}:{name:t,playlistType:"Dynamic",playlistDetails:e},{playlistId:o}=await s.post("/api/v2/playlists",r,{responseType:"json"});return o},async details(t,e){return s.get(`/api/v2/playlists/${t}`,e,{responseType:"json"})},listVideos(t,e,i){return new J(s,t,e,i)},async update(t,e){let r=Array.isArray(e)?{playlistVideoDetails:e}:{playlistDetails:e};return s.put(`/api/v2/playlists/${t}`,r)},async updateFeatured(t){let e={playlistVideoDetails:t};return s.put("/api/v2/playlists/featured-playlist",e)},async delete(t){return s.delete(`/api/v2/playlists/${t}`)},async list(){function t(a){let{id:c,playlistId:p,featurePlaylistId:u,featuredPlaylist:l,name:m,playlistName:g,...d}=a;return{...d,id:c??p??u??l,name:m??g,videos:a.videos??a.Videos}}let e=await s.get("/api/v2/playlists",void 0,{responseType:"json"}),i=!Array.isArray(e),o={playlists:(i?e.playlists:e).map(t)};return i&&(v(e.featuredPlaylist)?o.featuredPlaylist=t(e.featuredPlaylist):Array.isArray(e.videos)&&(o.featuredPlaylist=t(e))),o}}}function Z(s){return{async startVideoConferenceRecording(t,e,i){let{videoId:r}=await s.post("/api/v2/vc/start-recording",{title:i,sipAddress:t,sipPin:e},{responseType:"json"});return r},async getVideoConferenceStatus(t){let{status:e}=await s.get(`/api/v2/vc/recording-status/${t}`,void 0,{responseType:"json"});return e},async stopVideoConferenceRecording(t){let e={videoId:t},i=await s.post("/api/v2/vc/stop-recording",e,{responseType:"json"});return v(i)?i.message:i},async startPresentationProfileRecording(t){let{scheduledRecordingId:e}=await s.post("/api/v2/pp/start-recording",t,{responseType:"json"});return e},async getPresentationProfileStatus(t){return await s.get(`/api/v2/pp/recording-status/${t}`,void 0,{responseType:"json"})},async stopPresentationProfileRecording(t){let e={scheduledRecordingId:t};return await s.get("/api/v2/vc/recording-status",e,{responseType:"json"})}}}var ye={".7z":"application/x-7z-compressed",".asf":"video/x-ms-asf",".avi":"video/x-msvideo",".csv":"text/csv",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".f4v":"video/x-f4v",".flv":"video/x-flv",".gif":"image/gif",".jpg":"image/jpeg",".m4a":"audio/mp4",".m4v":"video/x-m4v",".mkv":"video/x-matroska",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mpg":"video/mpeg",".pdf":"application/pdf",".png":"image/png",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".rar":"application/x-rar-compressed",".srt":"application/x-subrip",".svg":"image/svg+xml",".swf":"application/x-shockwave-flash",".ts":"video/mp2t",".txt":"text/plain",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".zip":"application/zip",".mks":"video/x-matroska",".mts":"model/vnd.mts",".vtt":"text/vtt",".wma":"audio/x-ms-wma"};function ge(s="",n="video/mp4"){return s=s.toLowerCase(),s&&s in ye?ye[s]:n}function fe(s,n=".mp4"){let t=s&&Object.entries(ye).find(([e,i])=>s.startsWith(i));return t?t[0]:n}function rt(s,n){let{file:t,options:{filename:e="upload",contentType:i=""}}=s;i==="application/octet-stream"&&(i=""),/charset/.test(i)&&(i=i.replace(/;?.*charset.*$/,""));let r=e.replace(/\.[^\.]+$/,""),o=e.replace(r,"");return o||(o=fe(i)),e=`${r}${o}`,i||(i=ge(o,n)),H(t)&&t.type!==i&&(s.file=t.slice(0,t.size,i)),Object.assign(s.options,{filename:e,contentType:i}),s}function L(s,n,t){s.append(n,JSON.stringify(t))}async function q(s,n,t,e={}){let i={filename:"upload",contentType:"",...e},r=await h.parseFileUpload(t,i);return r=rt(r),await h.appendFileToForm(s,n,r),r.options}async function ot(s,n,t){await h.prepareUploadHeaders(s,n,t)}async function D(s,n,t,e,i=!1,r={}){let{headers:o}=r;i=typeof i=="boolean"?i:!!i?.useChunkedTransfer;let a=new h.Headers(o);await ot(e,a,i),r.headers=a;let{body:c}=await s.request(n,t,e,r);return c}function U(s){let{signal:n,...t}=s;return{requestOptions:n?{signal:n}:{},uploadOptions:t}}function Y(s){let{FormData:n}=h;return{async video(e,i={uploader:s.session.username??""},r={}){let{uploadOptions:o,requestOptions:a}=U(r),c=new n;if(!i.uploader){let l=s.session.username;if(l)i.uploader=l;else throw new TypeError("metadata must include uploader parameter")}L(c,"video",i);let p=await q(c,"VideoFile",e,o);s.log("info",`Uploading ${p.filename} (${p.contentType})`),await s.session.queueRequest("uploadVideo");let{videoId:u}=await D(s,"POST","/api/v2/uploads/videos",c,p,a);return u},async transcription(e,i,r="en",o={}){let{uploadOptions:a,requestOptions:c}=U(o),p=new n,u=r.toLowerCase(),l=await q(p,"File",i,a),m={files:[{language:u,fileName:l.filename}]};L(p,"TranscriptionFiles",m),s.log("info",`Uploading transcription to ${e} (${u} ${l.filename} (${l.contentType})`),await D(s,"POST",`/api/v2/uploads/transcription-files/${e}`,p,l,c)},async supplementalFile(e,i,r={}){let{uploadOptions:o,requestOptions:a}=U(r),c=new n,p=await q(c,"File",i,o),u={files:[{fileName:p.filename}]};L(c,"SupplementalFiles",u),s.log("info",`Uploading supplemental content to ${e} (${p.filename} (${p.contentType})`),await D(s,"POST",`/api/v2/uploads/supplemental-files/${e}`,c,p,a)},async chapters(e,i,r="replace",o={}){let{uploadOptions:a,requestOptions:c}=U(o),p=new n,u={chapters:[]};for(let m of i){let{title:g,time:d,imageFile:f,uploadOptions:b={}}=m,R={time:d};if(g&&(R.title=g),f){let T=await q(p,"File",f,{...a,...b});R.imageFile=T.filename}u.chapters.push(R)}L(p,"Chapters",u),s.log("info",`${r==="replace"?"Uploading":"Updating"} ${u.chapters.length} chapters to ${e}`),await D(s,r==="replace"?"POST":"PUT",`/api/v2/uploads/chapters/${e}`,p,a,c)},async thumbnail(e,i,r={}){let{uploadOptions:o,requestOptions:a}=U(r),c=new n,p=await q(c,"ThumbnailFile",i,o);s.log("info",`Uploading thumbnail for ${e} (${p.filename} (${p.contentType})`),await D(s,"POST",`/api/v2/uploads/images/${e}`,c,p,a)},async presentationChapters(e,i,r={}){let{uploadOptions:o,requestOptions:a}=U(r),c=new n,p=await q(c,"ThumbnailFile",i,o);s.log("info",`Uploading thumbnail for ${e} (${p.filename} (${p.contentType})`),await D(s,"POST",`/api/v2/uploads/images/${e}`,c,p,a)}}}function X(s){async function n(e,i){let r=i==="username"||i==="email"?{type:i}:void 0;return s.get(`/api/v2/users/${e}`,r)}let t={get roles(){return s.admin.roles},async create(e){let{userId:i}=await s.post("/api/v2/users",e);return i},async delete(e){await s.delete(`/api/v2/users/${e}`)},details:n,async getByUsername(e){return t.details(e,"username")},async getByEmail(e){return t.details(e,"email")},async exists(e,i){let r=i==="username"||i==="email"?{type:i}:void 0,o=await s.request("GET",`/api/v2/users/${e}`,r,{responseType:"json",throwHttpErrors:!1});return o.statusCode===200?o.body:!1},async addToGroup(e,i){let r=[{op:"add",path:"/GroupIds/-",value:i}];await s.patch(`/api/v2/users/${e}`,r)},async removeFromGroup(e,i){let r=[{op:"remove",path:"/GroupIds",value:i}];await s.patch(`/api/v2/users/${e}`,r)},async suspend(e){let i=[{op:"replace",path:"/ItemStatus",value:"Suspended"}];await s.patch(`/api/v2/users/${e}`,i)},async unsuspend(e){let i=[{op:"replace",path:"/ItemStatus",value:"Active"}];await s.patch(`/api/v2/users/${e}`,i)},search(e,i={}){let{assignable:r=!1}=i,o={endpoint:`/api/v2/search/access-entity${r?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities",transform:c=>c.map(at)},a={type:"user"};return e&&(a.q=e),new y(s,o,a,i)},async listSubscriptions(){return s.get("/api/v2/users/subscriptions")},async subscribe(e,i){return s.post("/api/v2/users/subscribe",{id:e,type:i})},async unsubscribe(e,i){return s.post("/api/v2/users/unsubscribe",{id:e,type:i})},async getNotifications(e=!1){return s.get("/api/v2/users/notifications",{unread:e})},async markNotificationRead(e){await s.put("/api/v2/users/notifications",e?{notificationId:e}:void 0)},async loginReport(e,i){let r={...e&&{sortField:e},...i&&{sortOrder:i}};await s.session.queueRequest("loginReport");let{Users:o}=await s.get("/api/v2/users/login-report",r,{responseType:"json"});return o}};return t}function at(s){return{userId:s.Id,entityType:s.EntityType,email:s.Email,firstname:s.FirstName,lastname:s.LastName,username:s.UserName,profileImageUri:s.ProfileImageUri}}var Ve=30,ct="asc";function ee(s,n){let t=new Date(s.getTime());return t.setDate(t.getDate()+n),t}function pt(s){let{incrementDays:n=Ve,sortDirection:t=ct,videoIds:e,startDate:i,endDate:r,...o}=s;return n=Math.min(Math.max(1/24/60,parseFloat(n)||Ve),30),Array.isArray(e)&&(e=e.map(a=>a.trim()).filter(Boolean).join(",")),{incrementDays:n,sortDirection:t,videoIds:e,...ut(i,r),...o}}function ut(s,n){let t=new Date,e=I(s),i=I(n);return i||(e?(i=ee(e,30),i.getTime()>t.getTime()&&(i=t)):i=t),e||(e=ee(i,-30)),e.getTime()>i.getTime()&&([e,i]=[i,e]),{startDate:e,endDate:i}}var te=class extends A{constructor(t,e={},i="/api/v2/videos/report"){super(pt(e));this._endpoint=i,this._rev=t}async _requestPage(){let{startDate:t,endDate:e}=this,{incrementDays:i,sortDirection:r,videoIds:o}=this.options,a=r==="asc",c=t,p=e,u=!1;a?(p=ee(c,i),p>=e&&(u=!0,p=e)):(c=ee(p,-1*i),c<=t&&(u=!0,c=t));let l={after:c.toJSON(),before:p.toJSON()};o&&(l.videoIds=o);let m=await this._rev.get(this._endpoint,l,{responseType:"json"});return u||(a?this.startDate=p:this.endDate=c),{items:m,done:u}}get startDate(){return this.options.startDate}set startDate(t){this.options.startDate=t}get endDate(){return this.options.endDate}set endDate(t){this.options.endDate=t}};function Le(s){function n(t,e={}){return v(t)?e=t:typeof t=="string"&&(e={...e??{},videoIds:t}),new te(s,e,"/api/v2/videos/report")}return{report:n,uniqueSessionsReport(t,e={}){return new te(s,e,`/api/v2/videos/${t}/report`)}}}function _e(s){async function n(o,a={}){return await s.request("GET",`/api/v2/videos/${o}/download`,void 0,{...a,responseType:"stream"})}async function t(o){let{imageUrl:a}=o,{body:c}=await s.request("GET",a,void 0,{responseType:"blob"});return c}async function e(o,a){let c=v(o)?o.downloadUrl:`/api/v2/videos/${o}/supplemental-files/${a}`,{body:p}=await s.request("GET",c,void 0,{responseType:"blob"});return p}async function i(o,a){let c=v(o)?o.downloadUrl:`/api/v2/videos/${o}/transcription-files/${a}`,{body:p}=await s.request("GET",c,void 0,{responseType:"blob"});return p}async function r(o){let{videoId:a="",imageId:c=""}=typeof o=="string"?{imageId:o}:o;if(!(a||c))throw new TypeError("No video/image specified to download");c?c.endsWith(".jpg")||(c=`${c}.jpg`):c=(await s.get(`/api/v2/videos/${a}/playback-url`)).video.thumbnailUrl;let p=c.startsWith("http")?c:`/api/v2/media/videos/thumbnails/${c}.jpg`,{body:u}=await s.request("GET",p,void 0,{responseType:"blob"});return u}return{download:n,downloadChapter:t,downloadSupplemental:e,downloadThumbnail:r,downloadTranscription:i}}function je(s){return{listExternalAccess(n,t,e){let i={endpoint:`/api/v2/videos/${n}/external-access`,totalKey:"total",hitsKey:"items"},r=t?{q:t}:void 0;return new y(s,i,r,e)},async createExternalAccess(n,t){await s.post(`/api/v2/videos/${n}/external-access`,t)},async renewExternalAccess(n,t){return s.put(`/api/v2/videos/${n}/external-access`,t)},async deleteExternalAccess(n,t){return s.delete(`/api/v2/videos/${n}/external-access`,t)},async revokeExternalAccess(n,t){return s.put(`/api/v2/videos/${n}/external-access/revoke`,t)}}}function se(s){async function n(e,i=!1){return(await s.get(`/api/v2/videos/${e}/comments`,i?{showAll:"true"}:void 0)).comments}let t={async setTitle(e,i){let r=[{op:"add",path:"/Title",value:i}];await s.session.queueRequest("updateVideo"),await s.patch(`/api/v2/videos/${e}`,r)},async setCustomField(e,i){let r=[{op:"replace",path:"/CustomFields",value:[i]}];await s.session.queueRequest("updateVideo"),await s.patch(`/api/v2/videos/${e}`,r)},async delete(e){await s.session.queueRequest("updateVideo"),await s.delete(`/api/v2/videos/${e}`)},async status(e){return s.get(`/api/v2/videos/${e}/status`)},async details(e){return await s.session.queueRequest("videoDetails"),s.get(`/api/v2/videos/${e}/details`)},comments:n,async chapters(e){try{let{chapters:i}=await s.get(`/api/v2/videos/${e}/chapters`);return i}catch(i){if(i instanceof C&&i.code==="NoVideoChapters")return[];throw i}},async supplementalFiles(e){let{supplementalFiles:i}=await s.get(`/api/v2/videos/${e}/supplemental-files`);return i},async transcriptions(e){let{transcriptionFiles:i}=await s.get(`/api/v2/videos/${e}/transcription-files`);return i},get upload(){return s.upload.video},async migrate(e,i){await s.put(`/api/v2/videos/${e}/migration`,i)},search(e={},i={}){let r={endpoint:"/api/v2/videos/search",totalKey:"totalVideos",hitsKey:"videos",async request(a,c,p){return await s.session.queueRequest("searchVideos"),s.get(a,c,p)}};return new y(s,r,e,i)},searchDetailed(e={},i={}){let r={endpoint:"/api/v2/videos/search",totalKey:"totalVideos",hitsKey:"videos",transform:async a=>{let c=[];for(let p of a){let u=p;try{let l=await t.details(p.id);Object.assign(u,l)}catch(l){u.error=l}c.push(u)}return c}};return new y(s,r,e,i)},async playbackInfo(e){let{video:i}=await s.get(`/api/v2/videos/${e}/playback-url`);return i},async playbackUrls(e,{ip:i,userAgent:r}={},o){let a=i?{ip:i}:void 0,c={...o,...r&&{headers:$(o?.headers,{"User-Agent":r})},responseType:"json"};return s.get(`/api/v2/videos/${e}/playback-urls`,a,c)},..._e(s),...Le(s),...je(s),async trim(e,i){return await s.session.queueRequest("uploadVideo"),s.post(`/api/v2/videos/${e}/trim`,i)},async convertDualStreamToSwitched(e){return await s.session.queueRequest("updateVideo"),s.put(`/api/v2/videos/${e}/convert-dual-streams-to-switched-stream`)},async patch(e,i){await s.session.queueRequest("updateVideo"),await s.patch(`/api/v2/videos/${e}`,i)},async waitTranscode(e,i){let{pollIntervalSeconds:r=30,timeoutMinutes:o=240,signal:a,ignorePlaybackWhileTranscoding:c=!0,onProgress:p,onError:u=f=>{throw f}}=i,l=1e3*60,m=Date.now()+o*l||1/0,g=Math.max((r||30)*1e3,5e3),d={status:"UploadFailed"};for(;Date.now()<m&&!a?.aborted;){try{d=await t.status(e);let{isProcessing:f,overallProgress:b=0,status:R}=d;if(c&&R==="Ready"&&f&&(R="Processing"),R==="ProcessingFailed"&&(b=1,f=!1),Object.assign(d,{status:R,overallProgress:b,isProcessing:f}),p?.(d),b===1&&!f)break}catch(f){await Promise.resolve(u(f))}await F(g,a)}return d}};return t}function He(s,n){let t=["scrollId","statusCode","statusDescription"];return Object.fromEntries(Object.entries(s).filter(([i,r])=>!(i===n||t.includes(i)||Array.isArray(r))))}var ie=class extends y{constructor(n,t,e={},i={}){let r={endpoint:`/api/v2/scheduled-events/${t}/real-time/attendees`,totalKey:"total",hitsKey:"attendees",request:async(o,a,c)=>{await n.session.queueRequest("attendeesRealtime");let p=await n.post(o,a,c),u=He(p,"attendees");return Object.assign(this.summary,u),p}};super(n,r,e,i),this.summary={}}async getSummary(){return this.options.maxResults=0,await this.nextPage(),this.summary}},ne=class extends y{constructor(n,t,e={}){let{eventId:i,runNumber:r}=t,o=r&&r>=0?{runNumber:r}:{},a={endpoint:`/api/v2/scheduled-events/${i}/post-event-report`,totalKey:"totalSessions",hitsKey:"sessions",request:async(c,p,u)=>{let l=await n.get(c,p,u),m=He(l,"sessions");return Object.assign(this.summary,m),l}};super(n,a,o,e),this.summary={}}async getSummary(){return this.options.maxResults=0,await this.nextPage(),this.summary}};function re(s){let n={async list(t={}){return s.get("/api/v2/scheduled-events",t,{responseType:"json"})},search(t,e){let i={endpoint:"/api/v2/search/scheduled-events",totalKey:"total",hitsKey:"events",request:(r,o,a)=>s.post(r,o,a),isPost:!0};return new y(s,i,t,e)},async create(t){let{eventId:e}=await s.post("/api/v2/scheduled-events",t);return e},async details(t){return s.get(`/api/v2/scheduled-events/${t}`)},async edit(t,e){return s.put(`/api/v2/scheduled-events/${t}`,e)},async delete(t){return s.delete(`/api/v2/scheduled-events/${t}`)},async editAccess(t,e){return s.put(`/api/v2/scheduled-events/${t}/access-control`,e)},attendees(t,e,i){return new ne(s,{eventId:t,runNumber:e},i)},realtimeAttendees(t,e,i){return new ie(s,t,e,i)},async questions(t,e){let i=(e??-1)>=0?{runNumber:e}:{};return s.get(`/api/v2/scheduled-events/${t}/questions`,i,{responseType:"json"})},async pollResults(t,e){let i=(e??-1)>=0?{runNumber:e}:{},{polls:r}=await s.get(`/api/v2/scheduled-events/${t}/poll-results`,i,{responseType:"json"});return r},async comments(t,e){let i=(e??-1)>=0?{runNumber:e}:{};return s.get(`/api/v2/scheduled-events/${t}/comments`,i,{responseType:"json"})},async status(t){return s.get(`/api/v2/scheduled-events/${t}/status`)},async isPublic(t){let e=await s.request("GET",`/api/v2/scheduled-events/${t}/is-public`,void 0,{throwHttpErrors:!1,responseType:"json"});return e.statusCode!==401&&e.body?.isPublic},async playbackUrls(t,{ip:e,userAgent:i}={},r){let o=e?{ip:e}:void 0,a={...r,...i&&{headers:$(r?.headers,{"User-Agent":i})},responseType:"json"};return s.get(`/api/v2/scheduled-events/${t}/playback-url`,o,a)},async playbackUrl(t,e={}){s.log("debug","webcast.playbackUrl is deprecated - use webcast.playbackUrls instead");let{playbackResults:i}=await n.playbackUrls(t,e);return i},async startEvent(t,e=!1){await s.put(`/api/v2/scheduled-events/${t}/start`,{preProduction:e})},async stopEvent(t,e=!1){await s.delete(`/api/v2/scheduled-events/${t}/start`,{preProduction:e})},async startBroadcast(t){await s.put(`/api/v2/scheduled-events/${t}/broadcast`)},async stopBroadcast(t){await s.delete(`/api/v2/scheduled-events/${t}/broadcast`)},async startRecord(t){await s.put(`/api/v2/scheduled-events/${t}/record`)},async stopRecord(t){await s.delete(`/api/v2/scheduled-events/${t}/record`)},async linkVideo(t,e,i=!0){let r={videoId:e,redirectVod:i};return s.put(`/api/v2/scheduled-events/${t}/linked-video`,r)},async unlinkVideo(t){return s.delete(`/api/v2/scheduled-events/${t}/linked-video`)},async guestRegistration(t,e){return s.get(`/api/v2/scheduled-events/${t}/registrations/${e}`)},async createGuestRegistration(t,e){return s.post(`/api/v2/scheduled-events/${t}/registrations`,e)},listGuestRegistrations(t,e={},i){let r={endpoint:`/api/v2/scheduled-events/${t}/registrations`,totalKey:"total",hitsKey:"guestUsers"};return new y(s,r,e,i)},updateGuestRegistration(t,e,i){return s.put(`/api/v2/scheduled-events/${t}/registrations/${e}`,i)},patchGuestRegistration(t,e,i){let r=Object.entries(i).map(([o,a])=>({op:"replace",path:`/${Se(o)}`,value:a}));return s.put(`/api/v2/scheduled-events/${t}/registrations/${e}`,r)},deleteGuestRegistration(t,e){return s.delete(`/api/v2/scheduled-events/${t}/registrations/${e}`)}};return n}function oe(s){let n={async list(){return s.get("/api/v2/zones",void 0,{responseType:"json"})},async flatList(){let{defaultZone:t,zones:e}=await n.list(),i=[t];function r(o){let{childZones:a=[],...c}=o;i.push(c),a.forEach(r)}return e.forEach(r),i},async create(t){let{zoneId:e}=await s.post("/api/v2/zones",t,{responseType:"json"});return e},async edit(t,e){return s.put(`/api/v2/zones/${t}`,e)},delete(t){return s.delete(`/api/v2/zones/${t}`)},get devices(){return s.device.listZoneDevices}};return n}function ae(s){let n="",t="",e;return{async getAccountId(r=!1){if(!n||r){let o=await s.get("/",void 0,{responseType:"text"}).catch(a=>"");n=(/BootstrapContext.*account[":{ ]*"id"\s*:\s*"([^"]+)"/.exec(o)||[])[1]||""}return n},async getRevVersion(r=!1){if(!t||r){let o=await s.get("/js/version.js",void 0,{responseType:"text"}).catch(a=>"");t=(/buildNumber:\s+['"]([\d.]+)/.exec(o)||[])[1]||""}return t},async getUserLocalIp(r=1e4,o=!1){if((!e||o)&&(e=await s.get("/api/v2/user-location")),!e?.enabled||e.locationUrls.length===0)return;let a=new AbortController,c=async function(u){try{let{ip:l=""}=await s.get(u,{},{headers:{Authorization:""},responseType:"json",signal:a.signal});return l=`${l}`.split(",")[0].trim(),l&&a.abort(),l}catch(l){s.log("debug",`ULS URL Failed: ${u}`,l);return}},p=setTimeout(()=>a.abort(),r);try{return(await Promise.all(e.locationUrls.map(c))).find(l=>!!l)}finally{clearTimeout(p)}}}}var he=1e3*60,P=Symbol("credentials"),ce=class{constructor(n,t={}){this._isExtending=!1;this.extendOptions={extendThresholdMilliseconds:3*he,keepAliveInterval:5*he,verify:!0,...t},Object.defineProperties(this,{_session:{get:()=>n,enumerable:!1}})}getNextExtendTime(){let{expires:n}=this._session;if(!n)return 0;let{keepAliveInterval:t,extendThresholdMilliseconds:e}=this.extendOptions,i=n.getTime()-Date.now();return Math.max(0,Math.min(i-e,t))}async _poll(){let{_session:n}=this,t=this._reset(),{signal:e}=t;for(;n.isConnected&&!e.aborted;){let i=this.getNextExtendTime();if(await F(i,e),e.aborted)break;try{this._isExtending=!0,await n.lazyExtend(this.extendOptions)}catch(r){t.abort(),this.error=r}finally{this._isExtending=!1}}}start(){this._isExtending||this._poll()}stop(){this._isExtending||this.controller&&this.controller.abort()}_reset(){this.error=void 0,this._isExtending=!1;let n=this.controller;return this.controller=new h.AbortController,n&&n.abort(),this.controller}get isAlive(){return this.controller&&!this.controller.signal.aborted}},S=class{constructor(n,t,e,i){this.expires=new Date,e===!0?this.keepAlive=new ce(this):v(e)&&(this.keepAlive=new ce(this,e));let r;i&&(r=Ce(v(i)?i:void 0)),Object.defineProperties(this,{rev:{get(){return n},enumerable:!1},[P]:{get(){return t},enumerable:!1},_rateLimits:{get(){return r},enumerable:!1}})}async login(){this.token=void 0,this.expires=new Date;let{expiration:n,...t}=await this._login();Object.assign(this,t);let e=new Date(n);e.getTime()<this.expires.getTime()?this.expires.setUTCMinutes(this.expires.getUTCMinutes()+10):this.expires=e,this.keepAlive&&this.keepAlive.start()}async extend(){let{expiration:n}=await this._extend();this.expires=new Date(n)}async logoff(){this.keepAlive&&this.keepAlive.stop();try{await this._logoff()}finally{this.token=void 0,this.expires=new Date}}async verify(){try{return await this.rev.auth.verifySession(),!0}catch{return!1}}async lazyExtend(n={}){let{extendThresholdMilliseconds:t=3*he,verify:e=!0}=n,{expires:i}=this,r=i?i.getTime()-Date.now():-1;if(r<=0)return await this.login(),!0;if(r>t)try{return await this.extend(),!0}catch(o){this.rev.log("warn","Error extending session - re-logging in",o)}else if(!e||await this.verify())return!1;return await this.login(),!0}async queueRequest(n){await this._rateLimits?.[n]?.()}async clearQueues(n){await qe(this._rateLimits??{},n)}get isExpired(){let{expires:n}=this;return n?Date.now()>n.getTime():!0}get isConnected(){return!!this.token&&!this.isExpired}get username(){return this[P].username}get hasRateLimits(){return!!this._rateLimits}};P;var Re=class extends S{async _login(){let{oauthConfig:t,authCode:e}=this[P];if(!t||!e)throw new TypeError("OAuth Config / auth code not specified");let{accessToken:i,expiration:r,refreshToken:o,userId:a}=await this.rev.auth.loginOAuth(t,e);return{token:i,expiration:r,refreshToken:o,userId:a}}async _extend(){let{[P]:{oauthConfig:t}}=this,{accessToken:e,expiration:i,refreshToken:r}=await this.rev.auth.extendSessionOAuth(t,this.refreshToken);return Object.assign(this,{token:e,refreshToken:r}),{expiration:i}}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires,refreshToken:this.refreshToken}}},ve=class extends S{async _login(){let{oauthConfig:t,code:e,codeVerifier:i}=this[P];if(!t||!e||!i)throw new TypeError("OAuth Config / auth code / verifier not specified");let{access_token:r,expires_in:o,refresh_token:a,userId:c}=await this.rev.auth.loginOAuth2(t,e,i),p=Date.now()+parseInt(o,10)*1e3,u=new Date(p).toISOString();return{token:r,expiration:u,refreshToken:a,userId:c}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},be=class extends S{async _login(){let{username:t,password:e}=this[P];if(!t||!e)throw new TypeError("username/password not specified");let{token:i,expiration:r,id:o}=await this.rev.auth.loginUser(t,e);return{token:i,expiration:r,userId:o}}async _extend(){let{userId:t}=this;return this.rev.auth.extendSessionUser(t)}async _logoff(){let{userId:t}=this;return this.rev.auth.logoffUser(t)}toJSON(){return{token:this.token||"",expiration:this.expires,userId:this.userId}}},we=class extends S{async _login(){let{apiKey:n,secret:t}=this[P];if(!n||!t)throw new TypeError("apiKey/secret not specified");return this.rev.auth.loginToken(n,t)}async _extend(){let{apiKey:n}=this[P];return this.rev.auth.extendSessionToken(n)}async _logoff(){let{apiKey:n}=this[P];return this.rev.auth.logoffToken(n)}toJSON(){return{token:this.token||"",expiration:this.expires,apiKey:this[P].apiKey}}},Pe=class extends S{async _login(){let{jwtToken:n}=this[P];if(!n)throw new TypeError("JWT Token not specified");let{accessToken:t,expiration:e}=await this.rev.auth.loginJWT(n);return{token:t,expiration:e,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},Te=class extends S{async _login(){let{webcastId:n,guestRegistrationToken:t}=this[P];if(!t||!n)throw new TypeError("Guest Registration Token or Webcast ID not specified");let{accessToken:e}=await this.rev.auth.loginGuestRegistration(n,t),i=Date.now()+1e3*60*15,r=new Date(i).toISOString();return{token:e,expiration:r,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},xe=class extends S{async _login(){return await this.rev.auth.verifySession(),{token:this.token||"",expiration:this.expires?.toISOString(),issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}get isConnected(){return!0}get isExpired(){return!1}};function We(s,n,t,e){let i,{session:r={},publicOnly:o,...a}=n,{token:c,expiration:p,refreshToken:u,userId:l}=r,m=Date.now(),g=new Date(p||m),d=c&&typeof c=="string"&&g.getTime()>m,f=n.oauthConfig&&n.code&&n.codeVerifier,b=n.oauthConfig&&(n.authCode||d&&u),R=n.apiKey&&(n.secret||d&&!l),T=n.username&&(n.password||d&&l),x=n.jwtToken,j=n.webcastId&&n.guestRegistrationToken;if(f)i=new ve(s,a,t,e);else if(b)i=new Re(s,a,t,e),u&&(i.refreshToken=u);else if(R)i=new we(s,a,t,e);else if(x)i=new Pe(s,a,t,e);else if(j)i=new Te(s,a,t,e);else if(T)i=new be(s,a,t,e),l&&(i.userId=l);else if(d||o)i=new xe(s,a,t,e);else throw new TypeError("Must specify credentials (username+password, apiKey+secret or oauthConfig+authCode)");return d&&(i.token=c,i.expires=g),i}var _=class{constructor(n){if(!v(n)||!n.url)throw new TypeError("Missing configuration options for client - url and username/password or apiKey/secret");let{url:t,log:e,logEnabled:i=!1,keepAlive:r=!0,rateLimits:o=!1,...a}=n,c=new URL(t);this.url=c.origin,this.session=We(this,a,r,o),this.logEnabled=!!i,e&&(this.log=(p,...u)=>{this.logEnabled&&e(p,...u)}),Object.defineProperties(this,{admin:{value:W(this),writable:!1},audit:{value:K(this,o),writable:!1},auth:{value:G(this),writable:!1},category:{value:M(this),writable:!1},channel:{value:N(this),writable:!1},device:{value:z(this),writable:!1},environment:{value:ae(this),writable:!1},group:{value:B(this),writable:!1},playlist:{value:Q(this),writable:!1},recording:{value:Z(this),writable:!1},upload:{value:Y(this),writable:!1},user:{value:X(this),writable:!1},video:{value:se(this),writable:!1},webcast:{value:re(this),writable:!1},webcasts:{get:()=>(this.log("debug","webcasts is deprecated - use rev.webcast instead"),this.webcast),enumerable:!1},zones:{value:oe(this),writable:!1}})}async request(n,t,e=void 0,i={}){let r=new URL(t,this.url);if(r.origin!==this.url)throw new TypeError(`Invalid endpoint - must be relative to ${this.url}`);let{headers:o,responseType:a,throwHttpErrors:c=!0,...p}=i,u=new h.Headers(o);this.session.token&&!u.has("Authorization")&&u.set("Authorization",`VBrick ${this.session.token}`),u.get("Authorization")===""&&u.delete("Authorization");let l={mode:"cors",method:n,...p,headers:u},m=!u.has("Content-Type"),g=n.toUpperCase();if(e)if(["POST","PUT","PATCH"].includes(g))typeof e=="string"?l.body=e:e instanceof h.FormData?(m=!1,l.body=e):v(e)||Array.isArray(e)?l.body=JSON.stringify(e):l.body=e;else if(v(e))for(let[j,Ke]of Object.entries(e))r.searchParams.append(j,Ke);else throw new TypeError(`Invalid payload for request to ${n} ${t}`);if(u.has("Accept")||u.set("Accept","application/json"),m&&u.set("Content-Type","application/json"),this.log("debug",`Request ${n} ${t}`),this.session.hasRateLimits)switch(g){case"GET":await this.session.queueRequest("get");break;case"POST":case"PATCH":case"PUT":case"DELETE":await this.session.queueRequest("post");break}let d=await h.fetch(`${r}`,{...l,method:n,headers:u}),{ok:f,status:b,statusText:R,headers:T}=d;if(this.log("debug",`Response ${n} ${t} ${b} ${R}`),!f){if(c)throw await C.create(d);a=void 0}let x=d.body;switch(a){case"json":x=await d.json();break;case"text":x=await d.text();break;case"blob":x=await d.blob();break;case"stream":x=d.body;break;default:x=await Ie(d,u.get("Accept"))}return{statusCode:b,headers:T,body:x,response:d}}async get(n,t,e){let{body:i}=await this.request("GET",n,t,e);return i}async post(n,t,e){let{body:i}=await this.request("POST",n,t,e);return i}async put(n,t,e){let{body:i}=await this.request("PUT",n,t,e);return i}async patch(n,t,e){await this.request("PATCH",n,t,e)}async delete(n,t,e){await this.request("DELETE",n,t,e)}async connect(){await De(()=>this.session.login(),n=>![401,429].includes(n.status))}async disconnect(){try{await this.session.logoff()}catch(n){this.log("warn",`Error in logoff, ignoring: ${n}`)}}async extendSession(){return this.session.extend()}async verifySession(){return this.session.verify()}get isConnected(){return this.session.isConnected}get token(){return this.session.token}get sessionExpires(){return this.session.expires}get sessionState(){return this.session.toJSON()}set sessionState(n){this.session.token=`${n.token}`,this.session.expires=new Date(n.expiration);for(let t of["apiKey","refreshToken","userId"])t in n&&(this.session[t]=`${n[t]||""}`)}log(n,...t){if(!this.logEnabled)return;let e=new Date().toJSON().replace("T"," ").slice(0,-5);console.debug(`${e} REV-CLIENT [${n}]`,...t)}};var dt={rateLimit:k,getExtensionForMime:fe,getMimeForExtension:ge},mt=_;return Je(yt);})();
//# sourceMappingURL=rev-client.iife.js.map