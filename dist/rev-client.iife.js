"use strict";var revClientLib=(()=>{var ue=Object.defineProperty;var Xe=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var tt=Object.prototype.hasOwnProperty;var st=(t,n)=>{for(var s in n)ue(t,s,{get:n[s],enumerable:!0})},it=(t,n,s,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of et(n))!tt.call(t,i)&&i!==s&&ue(t,i,{get:()=>n[i],enumerable:!(e=Xe(n,i))||e.enumerable});return t};var nt=t=>it(ue({},"__esModule",{value:!0}),t);var bt={};st(bt,{RevClient:()=>W,RevError:()=>x,ScrollError:()=>j,default:()=>wt,utils:()=>vt});var le={".7z":"application/x-7z-compressed",".asf":"video/x-ms-asf",".avi":"video/x-msvideo",".csv":"text/csv",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".f4v":"video/x-f4v",".flv":"video/x-flv",".gif":"image/gif",".jpg":"image/jpeg",".m4a":"audio/mp4",".m4v":"video/x-m4v",".mkv":"video/x-matroska",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mpg":"video/mpeg",".pdf":"application/pdf",".png":"image/png",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".rar":"application/x-rar-compressed",".srt":"application/x-subrip",".svg":"image/svg+xml",".swf":"application/x-shockwave-flash",".ts":"video/mp2t",".txt":"text/plain",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".zip":"application/zip",".mks":"video/x-matroska",".mts":"model/vnd.mts",".vtt":"text/vtt",".wma":"audio/x-ms-wma"};function de(t="",n="video/mp4"){return t=t.toLowerCase(),t&&t in le?le[t]:n}function me(t,n=".mp4"){let s=t&&Object.entries(le).find(([e,i])=>t.startsWith(i));return s?s[0]:n}function Ee(t="upload",n="",s){n==="application/octet-stream"&&(n=""),/charset/.test(n)&&(n=n.replace(/;?.*charset.*$/,""));let e=t.replace(/\.[^\.]+$/,""),i=t.replace(e,"");return i||(i=me(n||s||"")),t=`${e}${i}`,(!n||[".vtt",".srt"].includes(i))&&(n=de(i,s)),{filename:t,contentType:n}}var{toString:rt}=Object.prototype;function R(t){if(rt.call(t)!=="[object Object]")return!1;let n=Object.getPrototypeOf(t);return n===null||n===Object.getPrototypeOf({})}function De(t){return typeof t?.stream=="function"}function $e(t){return`${t[0]}${t.slice(1)}`}var A={async string(t,n){let s=t instanceof URL?t:new URL(t,"invalid://");if(!/^data|blob|file/.test(s.protocol))throw new TypeError("Only Blob / DateURI URLs are supported");if(n.disableExternalResources&&s.protocol==="file:")throw new Error("file: protocol not allowed");let e=await(await m.fetch(s)).blob();return A.blob(e,n)},async stream(t,n){let{contentType:s}=n;if(!(t instanceof ReadableStream))throw new TypeError("Only Blob / Files are supported for file uploads. Pass a File/Blob object");let e=new Response(t,{headers:s?{"content-type":s}:{}});return A.response(e,n)},async response(t,n){let{body:s,headers:e}=t;if(!t.ok||!s)throw await x.create(t);return A.blob(await t.blob(),n)},async blob(t,n){let{filename:s=t.name??"upload",contentType:e=t.type??"",defaultContentType:i}=n,r=Ee(s,e,i);return t.type!==r.contentType&&typeof t.slice=="function"&&(t=new File([t],r.filename,{type:r.contentType})),{file:t,options:{...n,...t.size&&{contentLength:t.size},...r}}},async parse(t,n){if(typeof t=="string"||t instanceof URL)return A.string(t,n);if(t instanceof m.Response)return A.response(t,n);if(!De(t))throw new TypeError("Only Blob / Files are supported for file uploads. Pass a File/Blob object");return A.blob(t,n)}};function F(t,n,s){t.append(n,JSON.stringify(s))}async function q(t,n,s,e={}){let{file:i,options:r}=await m.uploadParser.parse(s,e);return t.append(n,i,r.filename),r}async function E(t,n,s,e,i,r={}){let{headers:o}=r,a=new m.Headers(o);r.headers=a;let c=m.beforeFileUploadRequest(e,a,i,r),{body:p}=await t.request(n,s,c,r);return p}function ot(t){let n=crypto.getRandomValues(new Uint8Array(t/2));return Array.from(n).map(s=>s.toString(16).padStart(2,"0")).join("")}async function at(t){let n=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",n),e=String.fromCharCode(...new Uint8Array(s));return btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}async function ct(t,n){let s=new TextEncoder,e=await crypto.subtle.importKey("raw",s.encode(n),{name:"HMAC",hash:"SHA-256"},!0,["sign"]),i=await crypto.subtle.sign("HMAC",e,s.encode(t));return btoa(String.fromCharCode(...new Uint8Array(i)))}var ge={AbortController:globalThis.AbortController,AbortSignal:globalThis.AbortSignal,createAbortError(t){return new DOMException(t,"AbortError")},fetch:globalThis.fetch,FormData:globalThis.FormData,File:globalThis.File,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response,uploadParser:A,randomValues:ot,sha256Hash:at,hmacSign:ct,beforeFileUploadRequest(t,n,s,e){return t},asPlatformStream(t){return t},asWebStream(t){return t}},m=ge,G=!1,ye,fe=[];function Ce(){return!!G}function Ie(){if(G)return ye||(ye=(async()=>{for(;fe.length>0;){let t=fe.shift();if(typeof t=="function")try{let n=await t(ge);Object.assign(ge,n)}catch{}}G=!1,ye=void 0})()),ye}function ke(t){fe.push(t),G=!0}var Ue=60*1e3;function pt(t,n={}){if(t&&typeof t=="object"&&(n=Object.assign({},t,n),t=void 0),t||(t=n.fn),typeof t!="function")throw new TypeError("Rate limit function is not a function");let{perSecond:s,perMinute:e,perHour:i,signal:r}=n,o=parseFloat(n.limit)||1,a=parseInt(n.interval,10);if(s&&(o=parseFloat(s),a=1e3),e&&(o=parseFloat(e),a=Ue),i&&(o=parseFloat(i),a=Ue*60),o<1?(a/=o,o=1):o=Math.floor(o),!Number.isFinite(o))throw new TypeError(`Invalid limit ${o}`);if(!Number.isFinite(a)||a<=0)throw new TypeError("Invalid interval option");let c=new Map,p=0,u=0,l=function(...h){let d;return new Promise((v,g)=>{let w=()=>{v(t.apply(null,h)),c.delete(d)},b=Date.now();b-p>a?(u=1,p=b):u<o?u++:(p+=a,u=1),d=setTimeout(w,p-b),c.set(d,g)})},f=r?()=>l.abort(r.reason?`${r.reason}`:void 0,!0):void 0;return l.abort=(h="Cancelled rate-limit queue",d=!1)=>{d&&r?.removeEventListener("abort",f);for(let[v,g]of c.entries())clearTimeout(v),g(m.createAbortError(h));c.clear()},r?.addEventListener("abort",f),l}var L=pt;var he={get:24e3,post:3600,searchVideos:120,uploadVideo:30,updateVideo:30,videoDetails:2e3,attendeesRealtime:2,auditEndpoint:60,loginReport:10,viewReport:120},Ve=()=>Promise.resolve();function Fe(t){return{...t&&he,...typeof t=="object"&&t}}function Re(t,n){let s=he[t],e=n??s;if(!isFinite(e)||e<=0)return Ve;let i=e/12;return L({fn:Ve,limit:i,interval:5e3})}function Le(t={}){let n=Object.keys(he).map(s=>[s,Re(s,t[s])]);return Object.fromEntries(n)}function _e(t,n){Object.values(t).forEach(e=>e.abort?.(n))}function U(t,n){return t?(t instanceof Date||(t=new Date(t)),isNaN(t.getTime())?n:t):n}async function je(t,n=()=>!0,s=3,e=1e3){let i=0;for(;i<s;)try{return await t()}catch(r){if(i+=1,i>=s||!n(r,i))throw r;await _(e)}}async function _(t,n){return new Promise(s=>{let e,i=()=>{clearTimeout(e),n?.removeEventListener("abort",i),s()};e=setTimeout(i,t),n?.addEventListener("abort",i)})}function C(t){if(t!=="null"&&t)try{return JSON.parse(t)}catch{}return null}var x=class t extends Error{constructor(n,s){let{status:e=500,statusText:i="",url:r}=n;if(super(`${e} ${i}`),"captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor),this.status=e,this.url=r,this.code=`${e}`,this.detail=i,R(s))s.code&&(this.code=s.code),s.detail&&(this.detail=s.detail);else if(typeof s=="string")if(s=s.trim(),s.startsWith("{")){let{code:o,detail:a}=C(s)||{};o&&(this.code=o),a&&(this.detail=a)}else this.status===429?this.detail="Too Many Requests":/^(<!DOCTYPE|<html)/.test(s)&&(this.detail=s.replace(/.*<body>\s+/s,"").replace(/<\/body>.*/s,"").slice(0,256))}get name(){return"RevError"}get[Symbol.toStringTag](){return"RevError"}static async create(n){let s;try{s=await n.text()}catch(e){s={code:"Unknown",detail:`Unable to parse error response body: ${e}`}}return new t(n,s)}},j=class extends Error{constructor(n=408,s="ScrollExpired",e="Timeout while fetching all results in search request"){super("Search Scroll Expired"),Error.captureStackTrace(this,this.constructor),this.status=n,this.code=s,this.detail=e}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var $=class{constructor(n={}){this.options={maxResults:1/0,onProgress:(s,e,i)=>{},onError:s=>{throw s},onScrollError:s=>{console.warn("DEPRECATED: use onError instead of onScrollError with rev search requests"),this.options.onError(s)},signal:void 0,...n},this.current=0,this.total=void 0,this.done=!1}async nextPage(){let{onProgress:n,onError:s,signal:e}=this.options;if(e?.aborted&&(this.done=!0),this.done)return{current:this.current,total:this.current,done:this.done,items:[]};let i=await this._requestPage(),r=this._parsePage(i),{current:o,items:a,total:c,done:p,error:u}=r;return n(a,o,c),u&&s(u),{current:o,items:a,total:c,done:p}}_parsePage(n){let{maxResults:s}=this.options,{items:e=[],done:i=this.done,total:r,pageCount:o,error:a}=n;i&&(this.done=!0),isFinite(r)&&(this.total=Math.min(r,s)),o||(o=e.length);let c=this.current;return c+o>=s&&(o=s-c,e=e.slice(0,o),this.done=!0),this.current+=o,this.current===this.total&&(this.done=!0),this.done&&(this.total=this.current),a&&(this.done=!0),{current:c,total:this.total,done:this.done,error:a,items:e}}async exec(){let n=[];for await(let s of this)n.push(s);return n}async*[Symbol.asyncIterator](){let{signal:n}=this.options;do{let{items:s}=await this.nextPage();for await(let e of s){if(n?.aborted)break;yield e}}while(!this.done)}};async function We(t,n){let s=t.headers.get("Content-Type")||n||"",e=t.headers.get("Content-Length");if(s.startsWith("application/json")&&e!=="0")try{return await t.json()}catch{}return s.startsWith("text")?t.text():t.body}var y=class extends ${constructor(n,s,e={},i={}){super({onProgress:(a,c,p)=>{let{hitsKey:u}=s;n.log("debug",`searching ${u}, ${c}-${c+a.length} of ${p}...`)},onError:a=>{throw a},...i});let{scrollId:r,...o}=e;this.query=o,this._reqImpl=this._buildReqFunction(n,s),this.current=0,this.total=1/0,this.done=!1}_requestPage(){return this._reqImpl()}_buildReqFunction(n,s){let{endpoint:e,totalKey:i,hitsKey:r,isPost:o=!1,request:a,transform:c}=s,p=a||(o?n.post.bind(n):n.get.bind(n));return async()=>{let u=await p(e,this.query,{responseType:"json"}),{scrollId:l,[i]:f,[r]:h=[],statusCode:d,statusDescription:v}=u,g=!1;this.query.scrollId=l,l||(g=!0);let w=typeof c=="function"?await Promise.resolve(c(h)):h;w.length===0&&(g=!0);let b=d>=400&&v?new j(d,v):void 0;return{total:f,done:g,pageCount:h.length,items:w,error:b}}}};function H(t){let n,s,e={async roles(i=!0){if(n&&i===!0)return n;let r=await t.get("/api/v2/users/roles");return i&&(n=r),r},async getRoleByName(i,r=!0){let o=await e.roles(r),a=o.find(c=>c.roleType===i||c.name===i);if(!a)throw new TypeError(`Invalid Role Name ${i}. Valid values are: ${o.flatMap(c=>c.roleType?[c.roleType,c.name]:[c.name]).join(", ")}`);return{id:a.id,name:a.roleType||a.name}},async customFields(i=!0){if(s&&i===!0)return s;let r=await t.get("/api/v2/video-fields",void 0,{responseType:"json"});return i&&(s=r),r},async getCustomFieldByName(i,r=!0){let o=await e.customFields(r),a=o.find(c=>c.name===i);if(!a)throw new TypeError(`Invalid Custom Field Name ${i}. Valid values are: ${o.map(c=>c.name).join(", ")}`);return a},async brandingSettings(){return t.get("/api/v2/accounts/branding-settings")},async webcastRegistrationFields(){return(await t.get("/api/v2/accounts/webcast-registration-fields")).registrationFields},async createWebcastRegistrationField(i){return(await t.post("/api/v2/accounts/webcast-registration-fields",i)).fieldId},async updateWebcastRegistrationField(i,r){return t.put(`/api/v2/accounts/webcast-registration-fields/${i}`,r)},async deleteWebcastRegistrationField(i){return t.delete(`/api/v2/accounts/webcast-registration-fields/${i}`)},listIQCreditsUsage(i,r){let o={endpoint:"/api/v2/analytics/accounts/iq-credits-usage",totalKey:"total",hitsKey:"sessions"};return new y(t,o,i,r)},async verifySystemHealth(){return await t.get("/api/v2/system-health"),!0},async maintenanceSchedule(){let{schedules:i}=await t.get("/api/v2/maintenance-schedule");return i},async userLocationService(){return t.get("/api/v2/user-location")},async expirationRules(){return t.get("/api/v2/expiration-rules")},async featureSettings(i){let r=i?{videoId:i}:void 0;return t.get("/api/v2/videos/feature-settings",r)}};return e}function Ge(t){t=t.replace(/(\r\n|\n|\r)/gm,`
`).replace(/\n$/g,"");let n="",s=!1,e=!1,i="",r=[],o=[],a,c=t.length;function p(l){if(e)return l;if(l!=="")return l.trim()}for(a=0;a<c;a+=1)n=t.charAt(a),!s&&(n===","||n===`
`)?(i=p(i),r.push(i),n===`
`&&(o.push(r),r=[]),i="",e=!1):n==='"'?s?t.charAt(a+1)==='"'?(i+='"',a+=1):s=!1:(s=!0,e=!0):i+=n===`
`?`
`:n;i=p(i),r.push(i),o.push(r);let u=o.shift();return o.map(l=>{let f={};return l.forEach((h,d)=>{h!==void 0&&(f[u[d]]=h)}),f})}function ut(t){return{messageKey:t.MessageKey,entityKey:t.EntityKey,when:t.When,entityId:t.EntityId,principal:C(t.Principal)||{},message:C(t.Message)||{},currentState:C(t.CurrentState)||{},previousState:C(t.PreviousState)||{}}}var T=class extends ${constructor(n,s,e="audit records",{toDate:i,fromDate:r,beforeRequest:o,...a}={}){super({onProgress:(u,l,f)=>{n.log("debug",`loading ${e}, ${l} of ${f}...`)},...a});let{from:c,to:p}=this._parseDates(r,i);this.params={toDate:p.toISOString(),fromDate:c.toISOString()},this._req=this._buildReqFunction(n,s,o)}_requestPage(){return this._req()}_buildReqFunction(n,s,e){return async()=>{await e?.(this);let i=await n.request("GET",s,this.params,{responseType:"text"}),{body:r,headers:o}=i,a=Ge(r).map(u=>ut(u)),c=parseInt(o.get("totalRecords")||"",10);Object.assign(this.params,{nextContinuationToken:o.get("nextContinuationToken")||void 0,fromDate:o.get("nextfromDate")||void 0});let p=!this.params.nextContinuationToken;return{items:a,total:c,done:p}}}_parseDates(n,s){let e=U(s,new Date),i=new Date(e);i.setFullYear(e.getFullYear()-1);let r=U(n,i);return e<r&&([e,r]=[r,e]),{from:r,to:e}}};function K(t,n){let s=Fe(n).auditEndpoint;function e(){if(!s)return a=>a;let o=Re("auditEndpoint",s);return(a={})=>({...a,async beforeRequest(c){return await o(),a.beforeRequest?.(c)}})}let i={accountAccess:e(),userAccess:e(),accountUsers:e(),user:e(),accountGroups:e(),group:e(),accountDevices:e(),device:e(),accountVideos:e(),video:e(),accountWebcasts:e(),webcast:e(),principal:e()};return{accountAccess(o,a){let c=i.accountAccess(a);return new T(t,`/network/audit/accounts/${o}/userAccess`,"UserAccess",c)},userAccess(o,a,c){let p=i.userAccess(c);return new T(t,`/network/audit/accounts/${a}/userAccess/${o}`,`UserAccess_${o}`,p)},accountUsers(o,a){let c=i.accountUsers(a);return new T(t,`/network/audit/accounts/${o}/users`,"User",c)},user(o,a,c){let p=i.user(c);return new T(t,`/network/audit/accounts/${a}/users/${o}`,"User",p)},accountGroups(o,a){let c=i.accountGroups(a);return new T(t,`/network/audit/accounts/${o}/groups`,"Groups",c)},group(o,a,c){let p=i.group(c);return new T(t,`/network/audit/accounts/${a}/groups/${o}`,"Group",p)},accountDevices(o,a){let c=i.accountDevices(a);return new T(t,`/network/audit/accounts/${o}/devices`,"Devices",c)},device(o,a,c){let p=i.device(c);return new T(t,`/network/audit/accounts/${a}/devices/${o}`,"Device",p)},accountVideos(o,a){let c=i.accountVideos(a);return new T(t,`/network/audit/accounts/${o}/videos`,"Videos",c)},video(o,a,c){let p=i.video(c);return new T(t,`/network/audit/accounts/${a}/videos/${o}`,"Video",p)},accountWebcasts(o,a){let c=i.accountWebcasts(a);return new T(t,`/network/audit/accounts/${o}/scheduledEvents`,"Webcasts",c)},webcast(o,a,c){let p=i.webcast(c);return new T(t,`/network/audit/accounts/${a}/scheduledEvents/${o}`,"Webcast",p)},principal(o,a,c){let p=i.principal(c);return new T(t,`/network/audit/accounts/${a}/principals/${o}`,"Principal",p)}}}function V(t,n){let s=new m.Headers(t);return new m.Headers(n).forEach((e,i)=>s.set(i,e)),s}var lt="http://rev";function He(t,n,s){let e=new URL("/api/v2/oauth2/authorize",t.revUrl);return e.search=new URLSearchParams({client_id:t.oauthApiKey,code_challenge:n,response_type:"code",redirect_uri:t.redirectUri,...s&&{state:s}}).toString(),e.toString()}async function Ke(t=m.randomValues(48)){let n=await m.sha256Hash(t);return{codeVerifier:t,codeChallenge:n}}async function ve(t,n,s="1"){let{hmacSign:e}=m,i="code",{oauthApiKey:r,redirectUri:o}=t,c=`${r}::${new Date().toISOString()}`,p=await e(c,n);return{apiKey:r,signature:p,verifier:c,redirect_uri:o,response_type:i,state:s}}function Me(t){typeof t=="string"&&(t=new URL(t,lt)),t instanceof URL&&(t=t.searchParams);let n=t instanceof URLSearchParams?Object.fromEntries(t):t,{auth_code:s="",state:e="",error:i=void 0}=n;return{isSuccess:!i,authCode:`${s}`.replace(/ /g,"+"),state:e,error:i}}function M(t){let n={async loginToken(s,e,i){return t.post("/api/v2/authenticate",{apiKey:s,secret:e},i)},async extendSessionToken(s){return t.post(`/api/v2/auth/extend-session-timeout/${s}`)},async logoffToken(s){return t.delete(`/api/v2/tokens/${s}`)},async loginUser(s,e,i){return t.post("/api/v2/user/login",{username:s,password:e},i)},async logoffUser(s){return t.post("/api/v2/user/logoff",{userId:s})},async extendSessionUser(s){return t.post("/api/v2/user/extend-session-timeout",{userId:s})},async loginJWT(s,e){return t.get("/api/v2/jwtauthenticate",{jwt_token:s},e)},async loginGuestRegistration(s,e,i){let r={...i,headers:V(i?.headers,{"x-requested-with":"xmlhttprequest"})};return t.post(`/external/auth/jwt/${s}`,{token:`vbrick_rev ${e}`},i)},async extendSession(){return t.post("/api/v2/user/extend-session")},async verifySession(){return t.get("/api/v2/user/session")},get logoutUser(){return n.logoffUser},get logoutToken(){return n.logoffToken},async buildOAuth2Authentication(s,e="1",i){let{codeChallenge:r,codeVerifier:o}=await Ke(i);return{url:`${He(s,r,e)}`,codeVerifier:o}},async loginOAuth2(s,e,i,r){return t.post("/api/v2/oauth2/token",{code:e.replace(/ /g,"+"),client_id:s.oauthApiKey,grant_type:"authorization_code",redirect_uri:s.redirectUri,code_verifier:i},r)},async buildOAuthAuthenticationURL(s,e,i="1"){let r=await ve(s,e,i),o=new URL("/api/v2/oauth/authorization",t.url);return o.search=`${new URLSearchParams(r)}`,`${o}`},buildOAuthAuthenticationQuery:ve,parseOAuthRedirectResponse:Me,async loginOAuth(s,e){let i="authorization_code",{oauthApiKey:r,redirectUri:o}=s;return e=e.replace(/ /g,"+"),t.post("/api/v2/oauth/token",{authCode:e,apiKey:r,redirectUri:o,grantType:i})},async extendSessionOAuth(s,e){let i="refresh_token",{oauthApiKey:r}=s;return t.post("/api/v2/oauth/token",{apiKey:r,refreshToken:e,grantType:i})}};return n}function N(t){return{async create(s){return t.post("/api/v2/categories",s,{responseType:"json"})},async details(s){return t.get(`/api/v2/categories/${s}`,void 0,{responseType:"json"})},async update(s,e){return t.put(`/api/v2/categories/${s}`,e)},async delete(s){return t.delete(`/api/v2/categories/${s}`)},async list(s,e){let i=Object.assign({},s&&{parentCategoryId:s},e!=null&&{includeAllDescendants:e}),{categories:r}=await t.get("/api/v2/categories",i,{responseType:"json"});return r},async listAssignable(){return t.get("/api/v2/assignable-categories")}}}function z(t){return{async create(s){let{channelId:e}=await t.post("/api/v2/channels",s,{responseType:"json"});return e},async update(s,e){return t.put(`/api/v2/channels/${s}`,e)},async delete(s){return t.delete(`/api/v2/channels/${s}`)},list(s=0,e={}){return new we(t,s,e)},async addMembers(s,e){let i=e.map(r=>({op:"add",path:"/Members/-",value:r}));await t.patch(`/api/v2/channels/${s}`,i)},async removeMembers(s,e){let i=e.map(r=>({op:"remove",path:"/Members",value:typeof r=="string"?r:r.id}));await t.patch(`/api/v2/channels/${s}`,i)},search(s,e={}){let i={endpoint:`/api/v2/search/access-entity${e?.assignable?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities"},r={type:e.type||"Channel",...s&&{q:s}};return new y(t,i,r,e)}}}var we=class{constructor(n,s=0,e={}){this.options={maxResults:1/0,pageSize:10,onProgress:(i,r,o)=>{n.log("debug",`loading channels, ${r} of ${o}...`)},...e},this.current=0,this.total=1/0,this.done=!1,this.currentPage=s,this._req=()=>{let i={page:this.currentPage,size:this.options.pageSize};return n.get("/api/v2/channels",i,{responseType:"json"})}}async nextPage(){let{maxResults:n,onProgress:s}=this.options,e=this.current,i=await this._req();if((!Array.isArray(i)||i.length==0)&&(this.done=!0,i=[]),e+i.length>=n){let r=n-e;i=i.slice(0,r),this.done=!0}return this.total=e+i.length,s(i,e,this.total),this.current+=i.length,this.currentPage+=1,{current:e,total:this.total,done:this.done,items:i}}async exec(){let n=[];for await(let s of this)n.push(s);return n}async*[Symbol.asyncIterator](){do{let{items:n}=await this.nextPage();for await(let s of n)yield s}while(!this.done)}};function B(t){return{async listDMEs(){return(await t.get("/api/v2/devices/dmes")).devices},async listZoneDevices(){return(await t.get("/api/v2/zonedevices")).devices},async listPresentationProfiles(){return t.get("/api/v2/presentation-profiles")},async add(s){return t.post("/api/v2/devices/dmes",s)},async healthStatus(s){return t.get(`/api/v2/devices/dmes/${s}/health-status`)},async delete(s){return t.delete(`/api/v2/devices/dmes/${s}`)},async rebootDME(s){return t.put(`/api/v2/devices/dmes/${s}`)}}}function J(t){let n={async create(s){let{groupId:e}=await t.post("/api/v2/groups",s);return e},async delete(s){await t.delete(`/api/v2/groups/${s}`)},async details(s){return t.get(`/api/v2/groups/${s}`)},search(s,e={}){let i={endpoint:`/api/v2/search/access-entity${e?.assignable?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities",transform:o=>o.map(dt)},r={type:"group"};return s&&(r.q=s),new y(t,i,r,e)},list(s={}){return n.search(void 0,s)},listUsers(s,e={}){let i={endpoint:`/api/v2/search/groups/${s}/users`,totalKey:"totalUsers",hitsKey:"userIds"};return new y(t,i,void 0,e)},listUserDetails(s,e={}){let i={endpoint:`/api/v2/search/groups/${s}/users`,totalKey:"totalUsers",hitsKey:"userIds",transform:async r=>{let o=[];for(let a of r){let c={userId:a};try{let p=await t.user.details(a);Object.assign(c,p)}catch(p){c.error=p}o.push(c)}return o}};return new y(t,i,void 0,e)}};return n}function dt(t){return{id:t.Id,name:t.Name,entityType:t.EntityType}}function mt(t,n){let s=["scrollId","statusCode","statusDescription"];return Object.fromEntries(Object.entries(t).filter(([i,r])=>!(i===n||s.includes(i)||Array.isArray(r))))}var Q=class extends y{constructor(s,e,i={},r={}){let o={endpoint:`/api/v2/playlists/${e}`,totalKey:"totalVideos",hitsKey:"videos",request:async(a,c,p)=>{await s.session.queueRequest("searchVideos");let u=await s.get(a,c,p);return Object.assign(this.playlist,mt(u,"videos")),u}};super(s,o,i,r);this.playlist={}}get playlistName(){return this.playlist.playlistDetails?.name||this.playlist.name}get searchFilter(){return this.playlist?.playlistType==="Dynamic"?this.playlist.playlistDetails?.searchFilter||this.playlist.searchFilter:void 0}async getPlaylistInfo(){this.options.maxResults=0;let{items:s}=await this.nextPage();return{...this.playlist,...this.playlist?.playlistDetails,videos:s,playlistName:this.playlistName,searchFilter:this.searchFilter}}};function Z(t){return{async create(s,e){let r=Array.isArray(e)?{name:s,playlistType:"Static",videoIds:e}:{name:s,playlistType:"Dynamic",playlistDetails:e},{playlistId:o}=await t.post("/api/v2/playlists",r,{responseType:"json"});return o},async details(s,e){return t.get(`/api/v2/playlists/${s}`,e,{responseType:"json"})},listVideos(s,e,i){return new Q(t,s,e,i)},async update(s,e){let r=Array.isArray(e)?{playlistVideoDetails:e}:{playlistDetails:e};return t.put(`/api/v2/playlists/${s}`,r)},async updateFeatured(s){let e={playlistVideoDetails:s};return t.put("/api/v2/playlists/featured-playlist",e)},async delete(s){return t.delete(`/api/v2/playlists/${s}`)},async list(){function s(a){let{id:c,playlistId:p,featurePlaylistId:u,featuredPlaylist:l,name:f,playlistName:h,...d}=a;return{...d,id:c??p??u??l,name:f??h,videos:a.videos??a.Videos}}let e=await t.get("/api/v2/playlists",void 0,{responseType:"json"}),i=!Array.isArray(e),o={playlists:(i?e.playlists:e).map(s)};return i&&(R(e.featuredPlaylist)?o.featuredPlaylist=s(e.featuredPlaylist):Array.isArray(e.videos)&&(o.featuredPlaylist=s(e))),o}}}function Y(t){return{async startVideoConferenceRecording(s,e,i){let{videoId:r}=await t.post("/api/v2/vc/start-recording",{title:i,sipAddress:s,sipPin:e},{responseType:"json"});return r},async getVideoConferenceStatus(s){let{status:e}=await t.get(`/api/v2/vc/recording-status/${s}`,void 0,{responseType:"json"});return e},async stopVideoConferenceRecording(s){let e={videoId:s},i=await t.post("/api/v2/vc/stop-recording",e,{responseType:"json"});return R(i)?i.message:i},async startPresentationProfileRecording(s){let{scheduledRecordingId:e}=await t.post("/api/v2/pp/start-recording",s,{responseType:"json"});return e},async getPresentationProfileStatus(s){return await t.get(`/api/v2/pp/recording-status/${s}`,void 0,{responseType:"json"})},async stopPresentationProfileRecording(s){let e={scheduledRecordingId:s};return await t.get("/api/v2/vc/recording-status",e,{responseType:"json"})}}}function I(t,n){let{filename:s,contentType:e,contentLength:i,useChunkedTransfer:r,defaultContentType:o=n,...a}=t;return{requestOptions:a,uploadOptions:{filename:s,contentType:e,contentLength:i,useChunkedTransfer:r,defaultContentType:o}}}function X(t){let{FormData:n}=m;return{async video(e,i={uploader:t.session.username??""},r={}){let{uploadOptions:o,requestOptions:a}=I(r,"video/mp4"),c=new n;if(!i.uploader){let l=t.session.username;if(l)i.uploader=l;else throw new TypeError("metadata must include uploader parameter")}F(c,"video",i);let p=await q(c,"VideoFile",e,o);t.log("info",`Uploading ${p.filename} (${p.contentType})`),await t.session.queueRequest("uploadVideo");let{videoId:u}=await E(t,"POST","/api/v2/uploads/videos",c,p,a);return u},async replaceVideo(e,i,r={}){let{uploadOptions:o,requestOptions:a}=I(r,"video/mp4"),c=new n,p=await q(c,"VideoFile",i,o);t.log("info",`Replacing ${e} with ${p.filename} (${p.contentType})`),await t.session.queueRequest("uploadVideo"),await E(t,"PUT",`/api/v2/uploads/videos/${e}`,c,p,a)},async transcription(e,i,r="en",o={}){let{uploadOptions:a,requestOptions:c}=I(o,"application/x-subrip"),p=new n,u=r.toLowerCase();(a.contentType==="text/plain"||a.filename?.endsWith("txt"))&&(a.filename=`${a.filename||"upload"}.srt`);let l=await q(p,"File",i,a),f={files:[{language:u,fileName:l.filename}]};F(p,"TranscriptionFiles",f),t.log("info",`Uploading transcription to ${e} (${u} ${l.filename} (${l.contentType})`),await E(t,"POST",`/api/v2/uploads/transcription-files/${e}`,p,l,c)},async supplementalFile(e,i,r={}){let{uploadOptions:o,requestOptions:a}=I(r),c=new n,p=await q(c,"File",i,o),u={files:[{fileName:p.filename}]};F(c,"SupplementalFiles",u),t.log("info",`Uploading supplemental content to ${e} (${p.filename} (${p.contentType})`),await E(t,"POST",`/api/v2/uploads/supplemental-files/${e}`,c,p,a)},async chapters(e,i,r="replace",o={}){let{uploadOptions:a,requestOptions:c}=I(o,"image/png"),p=new n,u={chapters:[]};for(let f of i){let{title:h,time:d,imageFile:v,uploadOptions:g={}}=f,w={time:d};if(h&&(w.title=h),v){let b=await q(p,"File",v,{...a,...g});w.imageFile=b.filename}u.chapters.push(w)}F(p,"Chapters",u),t.log("info",`${r==="replace"?"Uploading":"Updating"} ${u.chapters.length} chapters to ${e}`),await E(t,r==="replace"?"POST":"PUT",`/api/v2/uploads/chapters/${e}`,p,a,c)},async thumbnail(e,i,r={}){let{uploadOptions:o,requestOptions:a}=I(r,"image/jpeg"),c=new n,p=await q(c,"ThumbnailFile",i,o);t.log("info",`Uploading thumbnail for ${e} (${p.filename} (${p.contentType})`),await E(t,"POST",`/api/v2/uploads/images/${e}`,c,p,a)},async presentationChapters(e,i,r={}){let{uploadOptions:o,requestOptions:a}=I(r,"application/vnd.ms-powerpoint"),c=new n,p=await q(c,"PresentationFile",i,o);t.log("info",`Uploading presentation for ${e} (${p.filename} (${p.contentType})`),await E(t,"POST",`/api/v2/uploads/video-presentations/${e}`,c,p,a)}}}function ee(t){async function n(e,i={}){let{lookupType:r,...o}=typeof i=="string"?{lookupType:i}:i,a=r==="username"||r==="email"?{type:r}:void 0;return t.get(`/api/v2/users/${e}`,a,{...o,responseType:"json"})}let s={get roles(){return t.admin.roles},async create(e){let{userId:i}=await t.post("/api/v2/users",e);return i},async delete(e){await t.delete(`/api/v2/users/${e}`)},details:n,async profile(e){return n("me",e)},async getByUsername(e){return s.details(e,{lookupType:"username"})},async getByEmail(e){return s.details(e,{lookupType:"email"})},async exists(e,i){let r=i==="username"||i==="email"?{type:i}:void 0,o=await t.request("GET",`/api/v2/users/${e}`,r,{responseType:"json",throwHttpErrors:!1});return o.statusCode===200?o.body:!1},async addToGroup(e,i){let r=[{op:"add",path:"/GroupIds/-",value:i}];await t.patch(`/api/v2/users/${e}`,r)},async removeFromGroup(e,i){let r=[{op:"remove",path:"/GroupIds",value:i}];await t.patch(`/api/v2/users/${e}`,r)},async suspend(e){let i=[{op:"replace",path:"/ItemStatus",value:"Suspended"}];await t.patch(`/api/v2/users/${e}`,i)},async unsuspend(e){let i=[{op:"replace",path:"/ItemStatus",value:"Active"}];await t.patch(`/api/v2/users/${e}`,i)},search(e,i={}){let{assignable:r=!1}=i,o={endpoint:`/api/v2/search/access-entity${r?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities",transform:c=>c.map(yt)},a={type:"user"};return e&&(a.q=e),new y(t,o,a,i)},async listSubscriptions(){return t.get("/api/v2/users/subscriptions")},async subscribe(e,i){return t.post("/api/v2/users/subscribe",{id:e,type:i})},async unsubscribe(e,i){return t.post("/api/v2/users/unsubscribe",{id:e,type:i})},async getNotifications(e=!1){return t.get("/api/v2/users/notifications",{unread:e})},async markNotificationRead(e){await t.put("/api/v2/users/notifications",e?{notificationId:e}:void 0)},async loginReport(e,i){let r={...e&&{sortField:e},...i&&{sortOrder:i}};await t.session.queueRequest("loginReport");let{Users:o}=await t.get("/api/v2/users/login-report",r,{responseType:"json"});return o}};return s}function yt(t){return{userId:t.Id,entityType:t.EntityType,email:t.Email,firstname:t.FirstName,lastname:t.LastName,username:t.UserName,profileImageUri:t.ProfileImageUri}}var Ne=30,gt="asc";function te(t,n){let s=new Date(t.getTime());return s.setDate(s.getDate()+n),s}function ft(t){let{incrementDays:n=Ne,sortDirection:s=gt,videoIds:e,startDate:i,endDate:r,...o}=t;return n=Math.min(Math.max(1/24/60,parseFloat(n)||Ne),30),Array.isArray(e)&&(e=e.map(a=>a.trim()).filter(Boolean).join(",")),{incrementDays:n,sortDirection:s,videoIds:e,...ht(i,r),...o}}function ht(t,n){let s=new Date,e=U(t),i=U(n);return i||(e?(i=te(e,30),i.getTime()>s.getTime()&&(i=s)):i=s),e||(e=te(i,-30)),e.getTime()>i.getTime()&&([e,i]=[i,e]),{startDate:e,endDate:i}}var se=class extends ${constructor(n,s={},e="/api/v2/videos/report"){super(ft(s)),this._endpoint=e,this._rev=n}async _requestPage(){let{startDate:n,endDate:s}=this,{incrementDays:e,sortDirection:i,videoIds:r}=this.options,o=i==="asc",a=n,c=s,p=!1;o?(c=te(a,e),c>=s&&(p=!0,c=s)):(a=te(c,-1*e),a<=n&&(p=!0,a=n));let u={after:a.toJSON(),before:c.toJSON()};r&&(u.videoIds=r),await this._rev.session.queueRequest("viewReport");let l=await this._rev.get(this._endpoint,u,{responseType:"json"});return p||(o?this.startDate=c:this.endDate=a),{items:l,done:p}}get startDate(){return this.options.startDate}set startDate(n){this.options.startDate=n}get endDate(){return this.options.endDate}set endDate(n){this.options.endDate=n}};function ze(t){function n(e,i={}){return R(e)?i=e:typeof e=="string"&&(i={...i??{},videoIds:e}),new se(t,i,"/api/v2/videos/report")}function s(e,i,r=new Date,o){let a=i?{after:new Date(i).toISOString(),before:new Date(r??Date.now())}:void 0;return t.get(`/api/v2/videos/${e}/summary-statistics`,a,o)}return{report:n,uniqueSessionsReport(e,i={}){return new se(t,i,`/api/v2/videos/${e}/report`)},summaryStatistics:s}}function Be(t){async function n(o,a={}){return await t.request("GET",`/api/v2/videos/${o}/download`,void 0,{responseType:"stream",...a})}async function s(o,a={}){let{imageUrl:c}=o,{body:p}=await t.request("GET",c,void 0,{responseType:"blob",...a});return p}async function e(o,a,c){let p=R(o)?o.downloadUrl:`/api/v2/videos/${o}/supplemental-files/${a}`,u=R(a)?a:c,{body:l}=await t.request("GET",p,void 0,{responseType:"blob",...u});return l}async function i(o,a,c){let p=R(o)?o.downloadUrl:`/api/v2/videos/${o}/transcription-files/${a}`,u=R(a)?a:c,{body:l}=await t.request("GET",p,void 0,{responseType:"blob",...u});return l}async function r(o,a={}){let{videoId:c="",imageId:p=""}=typeof o=="string"?{imageId:o}:o;if(!(c||p))throw new TypeError("No video/image specified to download");let u="";c?u=`/api/v2/videos/${c}/thumbnail`:p.startsWith("http")?u=`${p}${p.endsWith(".jpg")?"":".jpg"}`:u=`/api/v2/media/videos/thumbnails/${p}.jpg`;let{body:l}=await t.request("GET",u,void 0,{responseType:"blob",...a});return l}return{download:n,downloadChapter:s,downloadSupplemental:e,downloadThumbnail:r,downloadTranscription:i}}function Je(t){return{listExternalAccess(n,s,e){let i={endpoint:`/api/v2/videos/${n}/external-access`,totalKey:"total",hitsKey:"items"},r=s?{q:s}:void 0;return new y(t,i,r,e)},async createExternalAccess(n,s){await t.post(`/api/v2/videos/${n}/external-access`,s)},async renewExternalAccess(n,s){return t.put(`/api/v2/videos/${n}/external-access`,s)},async deleteExternalAccess(n,s){return t.delete(`/api/v2/videos/${n}/external-access`,s)},async revokeExternalAccess(n,s){return t.put(`/api/v2/videos/${n}/external-access/revoke`,s)}}}function ie(t){async function n(e,i=!1){return(await t.get(`/api/v2/videos/${e}/comments`,i?{showAll:"true"}:void 0)).comments}let s={async setTitle(e,i){let r=[{op:"add",path:"/Title",value:i}];await t.session.queueRequest("updateVideo"),await t.patch(`/api/v2/videos/${e}`,r)},async setCustomField(e,i){let r=[{op:"replace",path:"/CustomFields",value:[i]}];await t.session.queueRequest("updateVideo"),await t.patch(`/api/v2/videos/${e}`,r)},async delete(e,i){await t.session.queueRequest("updateVideo"),await t.delete(`/api/v2/videos/${e}`,void 0,i)},async status(e,i){return t.get(`/api/v2/videos/${e}/status`,void 0,i)},async details(e,i){return await t.session.queueRequest("videoDetails"),t.get(`/api/v2/videos/${e}/details`,void 0,i)},async update(e,i,r){await t.session.queueRequest("updateVideo"),await t.put(`/api/v2/videos/${e}`,i,r)},comments:n,async chapters(e,i){try{let{chapters:r}=await t.get(`/api/v2/videos/${e}/chapters`,void 0,i);return r}catch(r){if(r instanceof x&&r.code==="NoVideoChapters")return[];throw r}},async supplementalFiles(e,i){let{supplementalFiles:r}=await t.get(`/api/v2/videos/${e}/supplemental-files`,void 0,i);return r},async transcriptions(e,i){let{transcriptionFiles:r}=await t.get(`/api/v2/videos/${e}/transcription-files`,void 0,i);return r},get upload(){return t.upload.video},get replace(){return t.upload.replaceVideo},async migrate(e,i,r){await t.session.queueRequest("updateVideo"),await t.put(`/api/v2/videos/${e}/migration`,i,r)},search(e={},i={}){let r={endpoint:"/api/v2/videos/search",totalKey:"totalVideos",hitsKey:"videos",async request(a,c,p){return await t.session.queueRequest("searchVideos"),t.get(a,c,p)}};return new y(t,r,e,i)},searchDetailed(e={},i={}){let r={endpoint:"/api/v2/videos/search",totalKey:"totalVideos",hitsKey:"videos",transform:async a=>{let c=[];for(let p of a){let u=p;try{let l=await s.details(p.id);Object.assign(u,l)}catch(l){u.error=l}c.push(u)}return c}};return new y(t,r,e,i)},async playbackInfo(e){let{video:i}=await t.get(`/api/v2/videos/${e}/playback-url`);return i},async playbackUrls(e,{ip:i,userAgent:r}={},o){let a=i?{ip:i}:void 0,c={...o,...r&&{headers:V(o?.headers,{"User-Agent":r})},responseType:"json"};return t.get(`/api/v2/videos/${e}/playback-urls`,a,c)},...Be(t),...ze(t),...Je(t),async trim(e,i){return await t.session.queueRequest("uploadVideo"),t.post(`/api/v2/videos/${e}/trim`,i)},async convertDualStreamToSwitched(e){return await t.session.queueRequest("updateVideo"),t.put(`/api/v2/videos/${e}/convert-dual-streams-to-switched-stream`)},async edit(e,i,r){return await t.session.queueRequest("uploadVideo"),t.post(`/api/v2/videos/${e}/edit`,i,r)},async patch(e,i,r){await t.session.queueRequest("updateVideo"),await t.patch(`/api/v2/videos/${e}`,i,r)},async generateMetadata(e,i=["all"],r){await t.session.queueRequest("updateVideo"),await t.put(`/api/v2/videos/${e}/generate-metadata`,{metadataGenerationFields:i},r)},async generateMetadataStatus(e,i){let{description:r}=await t.get(`/api/v2/videos/${e}/metadata-generation-status`,void 0,{...i,responseType:"json"});return r.status},async transcribe(e,i,r){let o=typeof i=="string"?{language:i}:i;return t.post(`/api/v2/videos/${e}/transcription`,o,{...r,responseType:"json"})},async transcriptionStatus(e,i,r){return t.get(`/api/v2/videos/${e}/transcriptions/${i}/status`,void 0,{...r,responseType:"json"})},async translate(e,i,r,o){let a={sourceLanguage:i,targetLanguages:typeof r=="string"?[r]:r};return t.post(`/api/v2/videos/${e}/translations`,a,{...o,responseType:"json"})},async getTranslationStatus(e,i,r){let{status:o}=await t.get(`/api/v2/videos/${e}/translations/${i}/status`,void 0,{...r,responseType:"json"});return o},async deleteTranscription(e,i,r){let o=Array.isArray(i)?i.map(a=>a.trim()).join(","):i;await t.delete(`/api/v2/videos/${e}`,o?{locale:o}:void 0,r)},async setAudioLanguage(e,i,r,o){let{id:a,audioTracks:c=[]}=typeof e=="string"?{id:e}:e,p=r??c.findIndex(l=>l.isDefault===!0)??0,u={op:"replace",path:`/audioTracks/${p}`,value:{track:p,languageId:i}};await s.patch(a,[u],o)},async waitTranscode(e,i={},r){let{pollIntervalSeconds:o=30,timeoutMinutes:a=240,signal:c,ignorePlaybackWhileTranscoding:p=!0,onProgress:u,onError:l=g=>{throw g}}=i,f=1e3*60,h=Date.now()+a*f||1/0,d=Math.max((o||30)*1e3,5e3),v={status:"UploadFailed"};for(;Date.now()<h&&!c?.aborted;){try{v=await s.status(e,i);let{isProcessing:g,overallProgress:w=0,status:b}=v;if(p&&b==="Ready"&&g&&(b="Processing"),b==="ProcessingFailed"&&(w=1,g=!1),Object.assign(v,{status:b,overallProgress:w,isProcessing:g}),u?.(v),w===1&&!g)break}catch(g){await Promise.resolve(l(g))}await _(d,c)}return v}};return s}function Qe(t,n){let s=["scrollId","statusCode","statusDescription"];return Object.fromEntries(Object.entries(t).filter(([i,r])=>!(i===n||s.includes(i)||Array.isArray(r))))}var ne=class extends y{constructor(n,s,e={},i={}){let r={endpoint:`/api/v2/scheduled-events/${s}/real-time/attendees`,totalKey:"total",hitsKey:"attendees",request:async(o,a,c)=>{await n.session.queueRequest("attendeesRealtime");let p=await n.post(o,a,c),u=Qe(p,"attendees");return Object.assign(this.summary,u),p}};super(n,r,e,i),this.summary={}}async getSummary(){return this.options.maxResults=0,await this.nextPage(),this.summary}},re=class extends y{constructor(n,s,e={}){let{eventId:i,runNumber:r}=s,o=r&&r>=0?{runNumber:r}:{},a={endpoint:`/api/v2/scheduled-events/${i}/post-event-report`,totalKey:"totalSessions",hitsKey:"sessions",request:async(c,p,u)=>{let l=await n.request("GET",c,p,{...u,responseType:"json",throwHttpErrors:!1});return await this._assertResponseOk(l),Object.assign(this.summary,Qe(l.body,"sessions")),l.body}};super(n,a,o,e),this.summary={}}async _assertResponseOk({response:n,statusCode:s,body:e}){if(n.ok)return e;throw s==400&&e?.errorDescription?new x(n,{details:e.errorDescription}):e||n.bodyUsed?new x(n,e):await x.create(n)}async getSummary(){return this.options.maxResults=0,await this.nextPage(),this.summary}};function oe(t){let n={async list(s={},e){return t.get("/api/v2/scheduled-events",s,{...e,responseType:"json"})},search(s,e){let i={endpoint:"/api/v2/search/scheduled-events",totalKey:"total",hitsKey:"events",request:(r,o,a)=>t.post(r,o,a),isPost:!0};return new y(t,i,s,e)},async create(s){let{eventId:e}=await t.post("/api/v2/scheduled-events",s);return e},async details(s,e){return t.get(`/api/v2/scheduled-events/${s}`,void 0,e)},async edit(s,e){return t.put(`/api/v2/scheduled-events/${s}`,e)},async delete(s){return t.delete(`/api/v2/scheduled-events/${s}`)},async editAccess(s,e){return t.put(`/api/v2/scheduled-events/${s}/access-control`,e)},attendees(s,e,i){return new re(t,{eventId:s,runNumber:e},i)},realtimeAttendees(s,e,i){return new ne(t,s,e,i)},async questions(s,e){let i=(e??-1)>=0?{runNumber:e}:{};return t.get(`/api/v2/scheduled-events/${s}/questions`,i,{responseType:"json"})},async pollResults(s,e){let i=(e??-1)>=0?{runNumber:e}:{},r=await t.get(`/api/v2/scheduled-events/${s}/poll-results`,i,{responseType:"text"}),{polls:o=[]}=r?JSON.parse(r):{};return o},async comments(s,e){let i=(e??-1)>=0?{runNumber:e}:{};return t.get(`/api/v2/scheduled-events/${s}/comments`,i,{responseType:"json"})},async status(s,e){return t.get(`/api/v2/scheduled-events/${s}/status`,void 0,e)},async isPublic(s,e){let i=await t.request("GET",`/api/v2/scheduled-events/${s}/is-public`,void 0,{...e,throwHttpErrors:!1,responseType:"json"});return i.statusCode!==401&&i.body?.isPublic},async playbackUrls(s,{ip:e,userAgent:i}={},r){let o=e?{ip:e}:void 0,a={...r,...i&&{headers:V(r?.headers,{"User-Agent":i})},responseType:"json"};return t.get(`/api/v2/scheduled-events/${s}/playback-url`,o,a)},async playbackUrl(s,e={}){t.log("debug","webcast.playbackUrl is deprecated - use webcast.playbackUrls instead");let{playbackResults:i}=await n.playbackUrls(s,e);return i},async startEvent(s,e=!1){await t.put(`/api/v2/scheduled-events/${s}/start`,{preProduction:e})},async stopEvent(s,e=!1){await t.delete(`/api/v2/scheduled-events/${s}/start`,{preProduction:e})},async startBroadcast(s){await t.put(`/api/v2/scheduled-events/${s}/broadcast`)},async stopBroadcast(s){await t.delete(`/api/v2/scheduled-events/${s}/broadcast`)},async startRecord(s){await t.put(`/api/v2/scheduled-events/${s}/record`)},async stopRecord(s){await t.delete(`/api/v2/scheduled-events/${s}/record`)},async linkVideo(s,e,i=!0){let r={videoId:e,redirectVod:i};return t.put(`/api/v2/scheduled-events/${s}/linked-video`,r)},async unlinkVideo(s){return t.delete(`/api/v2/scheduled-events/${s}/linked-video`)},async guestRegistration(s,e){return t.get(`/api/v2/scheduled-events/${s}/registrations/${e}`)},async createGuestRegistration(s,e){return t.post(`/api/v2/scheduled-events/${s}/registrations`,e)},listGuestRegistrations(s,e={},i){let r={endpoint:`/api/v2/scheduled-events/${s}/registrations`,totalKey:"total",hitsKey:"guestUsers"};return new y(t,r,e,i)},updateGuestRegistration(s,e,i){return t.put(`/api/v2/scheduled-events/${s}/registrations/${e}`,i)},patchGuestRegistration(s,e,i){let r=Object.entries(i).map(([o,a])=>({op:"replace",path:`/${$e(o)}`,value:a}));return t.put(`/api/v2/scheduled-events/${s}/registrations/${e}`,r)},deleteGuestRegistration(s,e){return t.delete(`/api/v2/scheduled-events/${s}/registrations/${e}`)},async listBanners(s){let{banners:e}=await t.get(`/api/v2/scheduled-events/${s}/banners`);return e||[]},addBanner(s,e){return t.post(`/api/v2/scheduled-events/${s}/banner`,e)},setBannerStatus(s,e,i){return t.put(`/api/v2/scheduled-events/${s}/banner/${e}/status`,{isEnabled:i})},updateBanner(s,e){let{id:i,...r}=e;return t.put(`/api/v2/scheduled-events/${s}/banner/${i}`,r)},deleteBanner(s,e){return t.delete(`/api/v2/scheduled-events/${s}/banner/${e}`)}};return n}function ae(t){let n={async list(){return t.get("/api/v2/zones",void 0,{responseType:"json"})},async flatList(){let{defaultZone:s,zones:e}=await n.list(),i=[s];function r(o){let{childZones:a=[],...c}=o;i.push(c),a.forEach(r)}return e.forEach(r),i},async create(s){let{zoneId:e}=await t.post("/api/v2/zones",s,{responseType:"json"});return e},async edit(s,e){return t.put(`/api/v2/zones/${s}`,e)},delete(s){return t.delete(`/api/v2/zones/${s}`)},get devices(){return t.device.listZoneDevices}};return n}function ce(t){let n="",s="",e;return{async getAccountId(r=!1){if(!n||r){let o=await t.get("/",void 0,{responseType:"text"}).catch(a=>"");n=(/BootstrapContext.*account[":{ ]*"id"\s*:\s*"([^"]+)"/.exec(o)||[])[1]||""}return n},async getRevVersion(r=!1){if(!s||r){let o=await t.get("/js/version.js",void 0,{responseType:"text"}).catch(a=>"");s=(/buildNumber:\s+['"]([\d.]+)/.exec(o)||[])[1]||""}return s},async getUserLocalIp(r=1e4,o=!1){if((!e||o)&&(e=await t.get("/api/v2/user-location")),!e?.enabled||e.locationUrls.length===0)return;let a=new AbortController,c=async function(u){try{let{ip:l=""}=await t.get(u,{},{headers:{Authorization:""},responseType:"json",signal:a.signal});return l=`${l}`.split(",")[0].trim(),l&&a.abort(),l}catch(l){t.log("debug",`ULS URL Failed: ${u}`,l);return}},p=setTimeout(()=>a.abort(),r);try{return(await Promise.all(e.locationUrls.map(c))).find(l=>!!l)}finally{clearTimeout(p)}}}}var be=1e3*60,S=Symbol("credentials"),pe=class{constructor(n,s={}){this._isExtending=!1;this.extendOptions={extendThresholdMilliseconds:3*be,keepAliveInterval:10*be,verify:!0,...s},Object.defineProperties(this,{_session:{get:()=>n,enumerable:!1}})}getNextExtendTime(){let{expires:n}=this._session;if(!n)return 0;let{keepAliveInterval:s,extendThresholdMilliseconds:e}=this.extendOptions,i=n.getTime()-Date.now();return Math.max(0,Math.min(i-e,s))}async _poll(){let{_session:n}=this,s=this._reset(),{signal:e}=s;for(;n.isConnected&&!e.aborted;){let i=this.getNextExtendTime();if(await _(i,e),e.aborted)break;try{this._isExtending=!0,await n.lazyExtend(this.extendOptions)}catch(r){s.abort(),this.error=r}finally{this._isExtending=!1}}}start(){this._isExtending||this._poll()}stop(){this._isExtending||this.controller&&this.controller.abort()}_reset(){this.error=void 0,this._isExtending=!1;let n=this.controller;return this.controller=new m.AbortController,n&&n.abort(),this.controller}get isAlive(){return this.controller&&!this.controller.signal.aborted}};S;var O=class{constructor(n,s,e,i){this.expires=new Date,e===!0?this.keepAlive=new pe(this):R(e)&&(this.keepAlive=new pe(this,e));let r;i&&(r=Le(R(i)?i:void 0)),Object.defineProperties(this,{rev:{get(){return n},enumerable:!1},[S]:{get(){return s},enumerable:!1},_rateLimits:{get(){return r},enumerable:!1}})}async login(){this.token=void 0,this.expires=new Date;let{expiration:n,...s}=await this._login();Object.assign(this,s);let e=new Date(n);e.getTime()<this.expires.getTime()?this.expires.setUTCMinutes(this.expires.getUTCMinutes()+10):this.expires=e,this.keepAlive&&this.keepAlive.start()}async extend(){let{expiration:n}=await this._extend();this.expires=new Date(n)}async logoff(){this.keepAlive&&this.keepAlive.stop();try{await this._logoff()}finally{this.token=void 0,this.expires=new Date}}async verify(){try{return await this.rev.auth.verifySession(),!0}catch{return!1}}async lazyExtend(n={}){let{extendThresholdMilliseconds:s=3*be,verify:e=!0}=n,{expires:i}=this,r=i?i.getTime()-Date.now():-1;if(r<=0)return await this.login(),!0;if(r>s)try{return await this.extend(),!0}catch(o){this.rev.log("warn","Error extending session - re-logging in",o)}else if(!e||await this.verify())return!1;return await this.login(),!0}async queueRequest(n){await this._rateLimits?.[n]?.()}async clearQueues(n){await _e(this._rateLimits??{},n)}get isExpired(){let{expires:n}=this;return n?Date.now()>n.getTime():!0}get isConnected(){return!!this.token&&!this.isExpired}get username(){return this[S].username}get hasRateLimits(){return!!this._rateLimits}},Te=class extends O{async _login(){let{oauthConfig:n,authCode:s}=this[S];if(!n||!s)throw new TypeError("OAuth Config / auth code not specified");let{accessToken:e,expiration:i,refreshToken:r,userId:o}=await this.rev.auth.loginOAuth(n,s);return{token:e,expiration:i,refreshToken:r,userId:o}}async _extend(){let{[S]:{oauthConfig:n}}=this,{accessToken:s,expiration:e,refreshToken:i}=await this.rev.auth.extendSessionOAuth(n,this.refreshToken);return Object.assign(this,{token:s,refreshToken:i}),{expiration:e}}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires,refreshToken:this.refreshToken}}},Pe=class extends O{async _login(){let{oauthConfig:n,code:s,codeVerifier:e}=this[S];if(!n||!s||!e)throw new TypeError("OAuth Config / auth code / verifier not specified");let{access_token:i,expires_in:r,refresh_token:o,userId:a}=await this.rev.auth.loginOAuth2(n,s,e),c=Date.now()+parseInt(r,10)*1e3,p=new Date(c).toISOString();return{token:i,expiration:p,refreshToken:o,userId:a}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},xe=class extends O{async _login(){let{username:n,password:s}=this[S];if(!n||!s)throw new TypeError("username/password not specified");let{token:e,expiration:i,id:r}=await this.rev.auth.loginUser(n,s);return{token:e,expiration:i,userId:r}}async _extend(){let{userId:n}=this;return this.rev.auth.extendSessionUser(n)}async _logoff(){let{userId:n}=this;return this.rev.auth.logoffUser(n)}toJSON(){return{token:this.token||"",expiration:this.expires,userId:this.userId}}},Se=class extends O{async _login(){let{apiKey:n,secret:s}=this[S];if(!n||!s)throw new TypeError("apiKey/secret not specified");return this.rev.auth.loginToken(n,s)}async _extend(){let{apiKey:n}=this[S];return this.rev.auth.extendSessionToken(n)}async _logoff(){let{apiKey:n}=this[S];return this.rev.auth.logoffToken(n)}toJSON(){return{token:this.token||"",expiration:this.expires,apiKey:this[S].apiKey}}},Oe=class extends O{async _login(){let{jwtToken:n}=this[S];if(!n)throw new TypeError("JWT Token not specified");let{accessToken:s,expiration:e}=await this.rev.auth.loginJWT(n);return{token:s,expiration:e,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},Ae=class extends O{async _login(){let{webcastId:n,guestRegistrationToken:s}=this[S];if(!s||!n)throw new TypeError("Guest Registration Token or Webcast ID not specified");let{accessToken:e}=await this.rev.auth.loginGuestRegistration(n,s),i=Date.now()+1e3*60*15,r=new Date(i).toISOString();return{token:e,expiration:r,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},qe=class extends O{async _login(){return await this.rev.auth.verifySession(),{token:this.token||"",expiration:this.expires?.toISOString(),issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}get isConnected(){return!0}get isExpired(){return!1}};function Ze(t,n,s,e){let i,{session:r={},publicOnly:o,...a}=n,{token:c,expiration:p,refreshToken:u,userId:l}=r,f=Date.now(),h=new Date(p||f),d=c&&typeof c=="string"&&h.getTime()>f,v=n.oauthConfig&&n.code&&n.codeVerifier,g=n.oauthConfig&&(n.authCode||d&&u),w=n.apiKey&&(n.secret||d&&!l),b=n.username&&(n.password||d&&l),P=n.jwtToken,k=n.webcastId&&n.guestRegistrationToken;if(v)i=new Pe(t,a,s,e);else if(g)i=new Te(t,a,s,e),u&&(i.refreshToken=u);else if(w)i=new Se(t,a,s,e);else if(P)i=new Oe(t,a,s,e);else if(k)i=new Ae(t,a,s,e);else if(b)i=new xe(t,a,s,e),l&&(i.userId=l);else if(d||o)i=new qe(t,a,s,e);else throw new TypeError("Must specify credentials (username+password, apiKey+secret or oauthConfig+authCode)");return d&&(i.token=c,i.expires=h),i}var W=class{constructor(n){if(!R(n)||!n.url)throw new TypeError("Missing configuration options for client - url and username/password or apiKey/secret");let{url:s,log:e,logEnabled:i=!1,keepAlive:r=!0,rateLimits:o=!1,defaultStreamPreference:a="stream",...c}=n,p=new URL(s);this.url=p.origin,this.session=Ze(this,c,r,o),this.logEnabled=!!i,e&&(this.log=(u,...l)=>{this.logEnabled&&e(u,...l)}),this._streamPreference=a,Object.defineProperties(this,{admin:{value:H(this),writable:!1},audit:{value:K(this,o),writable:!1},auth:{value:M(this),writable:!1},category:{value:N(this),writable:!1},channel:{value:z(this),writable:!1},device:{value:B(this),writable:!1},environment:{value:ce(this),writable:!1},group:{value:J(this),writable:!1},playlist:{value:Z(this),writable:!1},recording:{value:Y(this),writable:!1},upload:{value:X(this),writable:!1},user:{value:ee(this),writable:!1},video:{value:ie(this),writable:!1},webcast:{value:oe(this),writable:!1},webcasts:{get:()=>(this.log("debug","webcasts is deprecated - use rev.webcast instead"),this.webcast),enumerable:!1},zones:{value:ae(this),writable:!1}})}async request(n,s,e=void 0,i={}){Ce()&&await Ie();let r=new URL(s,this.url);if(r.origin!==this.url)throw new TypeError(`Invalid endpoint - must be relative to ${this.url}`);let{headers:o,responseType:a,throwHttpErrors:c=!0,...p}=i,u=new m.Headers(o);this.session.token&&!u.has("Authorization")&&u.set("Authorization",`VBrick ${this.session.token}`),u.get("Authorization")===""&&u.delete("Authorization");let l={mode:"cors",method:n,...p,headers:u},f=!u.has("Content-Type"),h=n.toUpperCase();if(e)if(["POST","PUT","PATCH"].includes(h))typeof e=="string"?l.body=e:e instanceof m.FormData?(f=!1,l.body=e):R(e)||Array.isArray(e)?l.body=JSON.stringify(e):l.body=e;else if(R(e))for(let[k,Ye]of Object.entries(e))r.searchParams.append(k,Ye);else throw new TypeError(`Invalid payload for request to ${n} ${s}`);if(u.has("Accept")||u.set("Accept","application/json"),f&&u.set("Content-Type","application/json"),this.log("debug",`Request ${n} ${s}`),this.session.hasRateLimits)switch(h){case"GET":await this.session.queueRequest("get");break;case"POST":case"PATCH":case"PUT":case"DELETE":await this.session.queueRequest("post");break}let d=await m.fetch(`${r}`,{...l,method:n,headers:u}),{ok:v,status:g,statusText:w,headers:b}=d;if(!v){if(c){let k=await x.create(d);throw this.log("debug",`Response ${n} ${s} ${g} ${k.code||w}`),k}a=void 0}this.log("debug",`Response ${n} ${s} ${g} ${w}`);let P=d.body;switch(a){case"json":`${b.get("content-length")}`=="0"?P=null:P=await d.json();break;case"text":P=await d.text();break;case"blob":P=await d.blob();break;case"stream":switch(this._streamPreference){case"webstream":P=m.asWebStream(d.body);break;case"nativestream":P=m.asPlatformStream(d.body);break;default:P=d.body}P=d.body;break;case"webstream":P=m.asWebStream(d.body);break;case"nativestream":P=m.asPlatformStream(d.body);break;default:P=await We(d,u.get("Accept"))}return{statusCode:g,headers:b,body:P,response:d}}async get(n,s,e){let{body:i}=await this.request("GET",n,s,e);return i}async post(n,s,e){let{body:i}=await this.request("POST",n,s,e);return i}async put(n,s,e){let{body:i}=await this.request("PUT",n,s,e);return i}async patch(n,s,e){await this.request("PATCH",n,s,e)}async delete(n,s,e){await this.request("DELETE",n,s,e)}async connect(){await je(()=>this.session.login(),n=>![401,429].includes(n.status))}async disconnect(){try{await this.session.logoff()}catch(n){this.log("warn",`Error in logoff, ignoring: ${n}`)}}async extendSession(){return this.session.extend()}async verifySession(){return this.session.verify()}get isConnected(){return this.session.isConnected}get token(){return this.session.token}get sessionExpires(){return this.session.expires}get sessionState(){return this.session.toJSON()}set sessionState(n){this.session.token=`${n.token}`,this.session.expires=new Date(n.expiration);for(let s of["apiKey","refreshToken","userId"])s in n&&(this.session[s]=`${n[s]||""}`)}log(n,...s){if(!this.logEnabled)return;let e=new Date().toJSON().replace("T"," ").slice(0,-5);console.debug(`${e} REV-CLIENT [${n}]`,...s)}};var vt={rateLimit:L,getExtensionForMime:me,getMimeForExtension:de,setPolyfills:ke},wt=W;return nt(bt);})();
//# sourceMappingURL=rev-client.iife.js.map