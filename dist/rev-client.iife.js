"use strict";var revClientLib=(()=>{var H=Object.defineProperty;var it=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var ot=Object.prototype.hasOwnProperty;var rt=(s,n,t)=>n in s?H(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var at=(s,n)=>{for(var t in n)H(s,t,{get:n[t],enumerable:!0})},pt=(s,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of nt(n))!ot.call(s,i)&&i!==t&&H(s,i,{get:()=>n[i],enumerable:!(e=it(n,i))||e.enumerable});return s};var ct=s=>pt(H({},"__esModule",{value:!0}),s);var d=(s,n,t)=>rt(s,typeof n!="symbol"?n+"":n,t);var qt={};at(qt,{RevClient:()=>G,RevError:()=>q,ScrollError:()=>W,default:()=>It,utils:()=>St});var ye={".7z":"application/x-7z-compressed",".asf":"video/x-ms-asf",".avi":"video/x-msvideo",".csv":"text/csv",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".f4v":"video/x-f4v",".flv":"video/x-flv",".gif":"image/gif",".jpg":"image/jpeg",".m4a":"audio/mp4",".m4v":"video/x-m4v",".mkv":"video/x-matroska",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mpg":"video/mpeg",".pdf":"application/pdf",".png":"image/png",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".rar":"application/x-rar-compressed",".srt":"application/x-subrip",".svg":"image/svg+xml",".swf":"application/x-shockwave-flash",".ts":"video/mp2t",".txt":"text/plain",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".zip":"application/zip",".mks":"video/x-matroska",".mts":"model/vnd.mts",".vtt":"text/vtt",".wma":"audio/x-ms-wma"};function fe(s="",n="video/mp4"){return s=s.toLowerCase(),s&&s in ye?ye[s]:n}function he(s,n=".mp4"){let t=s&&Object.entries(ye).find(([e,i])=>s.startsWith(i));return t?t[0]:n}function Ue(s="upload",n="",t){n==="application/octet-stream"&&(n=""),/charset/.test(n)&&(n=n.replace(/;?.*charset.*$/,""));let[e,i]=s.split(/(?=\.[^\.\\\/]+$)/);return i||(i=he(n||t||"")),s=`${e}${i}`,(!n||[".vtt",".srt"].includes(i))&&(n=fe(i,t)),{filename:s,contentType:n}}var{toString:ut}=Object.prototype;function P(s){if(ut.call(s)!=="[object Object]")return!1;let n=Object.getPrototypeOf(s);return n===null||n===Object.getPrototypeOf({})}function ke(s){return typeof s?.stream=="function"}function Ce(s){return`${s[0]}${s.slice(1)}`}var lt=["blob:","data:"],E={async string(s,n){let t=y.parseUrl(s);if(lt.includes(t.protocol)){let e=await(await y.fetch(t)).blob();return E.blob(e,n)}if(n.disableExternalResources)throw new Error(`${t.protocol} protocol not allowed`);if(t.protocol==="file:")return E.localFile(t,n);throw new TypeError("Only Blob / DateURI URLs are supported")},async localFile(s,n){if(n.disableExternalResources)throw new Error("file: protocol not allowed");return E.response(await y.fetch(s),n)},async stream(s,n){let{contentType:t}=n;if(!(s instanceof ReadableStream))throw new TypeError("Only Blob / Files are supported for file uploads. Pass a File/Blob object");let e=new Response(s,{headers:t?{"content-type":t}:{}});return E.response(e,n)},async response(s,n){let{body:t,headers:e}=s;if(!s.ok||!t)throw await q.create(s);return E.blob(await s.blob(),n)},async blob(s,n){let{filename:t=s.name??"upload",contentType:e=s.type??"",defaultContentType:i}=n,o=Ue(t,e,i);return s.type!==o.contentType&&typeof s.slice=="function"&&(s=new File([s],o.filename,{type:o.contentType})),{file:s,options:{...n,...s.size&&{contentLength:s.size},...o}}},async parse(s,n){if(typeof s=="string"||s instanceof URL)return E.string(s,n);if(s instanceof y.Response)return E.response(s,n);if(!ke(s))throw new TypeError("Only Blob / Files are supported for file uploads. Pass a File/Blob object");return E.blob(s,n)}};function V(s,n,t){s.append(n,JSON.stringify(t))}async function A(s,n,t,e={}){let{file:i,options:o}=await y.uploadParser.parse(t,e);return s.append(n,i,o.filename),o}async function O(s,n,t,e,i,o={}){let{headers:r}=o,p=new y.Headers(r);o.headers=p;let a=y.beforeFileUploadRequest(e,p,i,o),{body:c}=await s.request(n,t,a,o);return c}function dt(s){let n=crypto.getRandomValues(new Uint8Array(s/2));return Array.from(n).map(t=>t.toString(16).padStart(2,"0")).join("")}async function mt(s){let n=new TextEncoder().encode(s),t=await crypto.subtle.digest("SHA-256",n),e=String.fromCharCode(...new Uint8Array(t));return btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}async function gt(s,n){let t=new TextEncoder,e=await crypto.subtle.importKey("raw",t.encode(n),{name:"HMAC",hash:"SHA-256"},!0,["sign"]),i=await crypto.subtle.sign("HMAC",e,t.encode(s));return btoa(String.fromCharCode(...new Uint8Array(i)))}var ve={AbortController:globalThis.AbortController,AbortSignal:globalThis.AbortSignal,createAbortError(s){return new DOMException(s,"AbortError")},fetch(...s){return globalThis.fetch(...s)},FormData:globalThis.FormData,File:globalThis.File,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response,uploadParser:E,randomValues:dt,sha256Hash:mt,hmacSign:gt,parseUrl(s){return s instanceof URL?s:new URL(s,"invalid://")},beforeFileUploadRequest(s,n,t,e){return s},asPlatformStream(s){return s},asWebStream(s){return s}},y=ve,M=!1,Re,Pe=[];function Fe(){return!!M}function Ve(){if(M)return Re||(Re=(async()=>{for(;Pe.length>0;){let s=Pe.shift();if(typeof s=="function")try{let n=await s(ve);Object.assign(ve,n)}catch{}}M=!1,Re=void 0})()),Re}function Le(s){Pe.push(s),M=!0}var je=60*1e3;function yt(s,n={}){if(s&&typeof s=="object"&&(n=Object.assign({},s,n),s=void 0),s||(s=n.fn),typeof s!="function")throw new TypeError("Rate limit function is not a function");let{perSecond:t,perMinute:e,perHour:i,signal:o}=n,r=parseFloat(n.limit)||1,p=parseInt(n.interval,10);if(t&&(r=parseFloat(t),p=1e3),e&&(r=parseFloat(e),p=je),i&&(r=parseFloat(i),p=je*60),r<1?(p/=r,r=1):r=Math.floor(r),!Number.isFinite(r))throw new TypeError(`Invalid limit ${r}`);if(!Number.isFinite(p)||p<=0)throw new TypeError("Invalid interval option");let a=new Map,c=0,u=0,l=function(...f){let g;return new Promise((h,v)=>{let b=()=>{h(s.apply(null,f)),a.delete(g)},w=Date.now();w-c>p?(u=1,c=w):u<r?u++:(c+=p,u=1),g=setTimeout(b,Math.max(c-w,0)),a.set(g,v)})},m=o?()=>l.abort(o.reason?`${o.reason}`:void 0,!0):void 0;return l.abort=(f="Cancelled rate-limit queue",g=!1)=>{g&&o?.removeEventListener("abort",m);for(let[h,v]of a.entries())clearTimeout(h),v(y.createAbortError(f));a.clear()},o?.addEventListener("abort",m),l}var j=yt;var be={get:24e3,post:3600,searchVideos:120,uploadVideo:30,updateVideo:30,videoDetails:2e3,attendeesRealtime:2,auditEndpoint:60,loginReport:10,viewReport:120},_e=()=>Promise.resolve();function We(s){return{...s&&be,...typeof s=="object"&&s}}function we(s,n){let t=be[s],e=n??t;if(!isFinite(e)||e<=0)return _e;let i=e/12;return j({fn:_e,limit:i,interval:5e3})}function Be(s={}){let n=Object.keys(be).map(t=>[t,we(t,s[t])]);return Object.fromEntries(n)}function Ge(s,n){Object.values(s).forEach(e=>e.abort?.(n))}function k(s,n){return s?(s instanceof Date||(s=new Date(s)),isNaN(s.getTime())?n:s):n}async function Ke(s,n=()=>!0,t=3,e=1e3){let i=0;for(;i<t;)try{return await s()}catch(o){if(i+=1,i>=t||!n(o,i))throw o;await _(e)}}async function _(s,n){return new Promise(t=>{let e,i=()=>{clearTimeout(e),n?.removeEventListener("abort",i),t()};e=setTimeout(i,s),n?.addEventListener("abort",i)})}function C(s){if(s!=="null"&&s)try{return JSON.parse(s)}catch{}return null}var q=class s extends Error{constructor(t,e){let{status:i=500,statusText:o="",url:r}=t;super(`${i} ${o}`);d(this,"status");d(this,"url");d(this,"code");d(this,"detail");if("captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor),this.status=i,this.url=r,this.code=`${i}`,this.detail=o,P(e))e.code&&(this.code=e.code),e.detail&&(this.detail=e.detail);else if(typeof e=="string")if(e=e.trim(),e.startsWith("{")){let{code:p,detail:a}=C(e)||{};p&&(this.code=p),a&&(this.detail=a)}else this.status===429?this.detail="Too Many Requests":/^(<!DOCTYPE|<html)/.test(e)&&(this.detail=e.replace(/.*<body>\s+/s,"").replace(/<\/body>.*/s,"").slice(0,256))}get name(){return"RevError"}get[Symbol.toStringTag](){return"RevError"}static async create(t){let e;try{e=await t.text()}catch(i){e={code:"Unknown",detail:`Unable to parse error response body: ${i}`}}return new s(t,e)}},W=class extends Error{constructor(t=408,e="ScrollExpired",i="Timeout while fetching all results in search request"){super("Search Scroll Expired");d(this,"status");d(this,"code");d(this,"detail");Error.captureStackTrace(this,this.constructor),this.status=t,this.code=e,this.detail=i}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var U=class{constructor(n={}){d(this,"current");d(this,"total");d(this,"done");d(this,"options");this.options={maxResults:1/0,onProgress:(t,e,i)=>{},onError:(t=>{throw t}),onScrollError:(t=>{console.warn("DEPRECATED: use onError instead of onScrollError with rev search requests"),this.options.onError(t)}),signal:void 0,...n},this.current=0,this.total=void 0,this.done=!1}async nextPage(){let{onProgress:n,onError:t,signal:e}=this.options;if(e?.aborted&&(this.done=!0),this.done)return{current:this.current,total:this.current,done:this.done,items:[]};let i=await this._requestPage(),o=this._parsePage(i),{current:r,items:p,total:a,done:c,error:u}=o;return n(p,r,a),u&&t(u),{current:r,items:p,total:a,done:c}}_parsePage(n){let{maxResults:t}=this.options,{items:e=[],done:i=this.done,total:o,pageCount:r,error:p}=n;i&&(this.done=!0),isFinite(o)&&(this.total=Math.min(o,t)),r||(r=e.length);let a=this.current;return a+r>=t&&(r=t-a,e=e.slice(0,r),this.done=!0),this.current+=r,this.total!=null&&this.current>=this.total&&(this.done=!0),this.done&&(this.total=this.current),p&&(this.done=!0),{current:a,total:this.total,done:this.done,error:p,items:e}}async exec(){let n=[];for await(let t of this)n.push(t);return n}async*[Symbol.asyncIterator](){let{signal:n}=this.options;do{let{items:t}=await this.nextPage();for await(let e of t){if(n?.aborted)break;yield e}}while(!this.done)}};async function He(s,n){let t=s.headers.get("Content-Type")||n||"",e=s.headers.get("Content-Length");if(/^(application|text)\/[^+]*[+]?json/.test(t)&&e!=="0")try{return await s.json()}catch{}return t.startsWith("text")?s.text():s.body}var R=class extends U{constructor(t,e,i={},o={}){super({onProgress:(a,c,u)=>{let{hitsKey:l}=e;t.log("debug",`searching ${l}, ${c}-${c+a.length} of ${u}...`)},onError:(a=>{throw a}),...o});d(this,"query");d(this,"_reqImpl");let{scrollId:r,...p}=i;this.query=p,this._reqImpl=this._buildReqFunction(t,e),this.current=0,this.total=1/0,this.done=!1}_requestPage(){return this._reqImpl()}_buildReqFunction(t,e){let{endpoint:i,totalKey:o,hitsKey:r,isPost:p=!1,request:a,transform:c}=e,u=a||(p?t.post.bind(t):t.get.bind(t));return async()=>{let l=await u(i,this.query,{responseType:"json"}),{scrollId:m,[o]:f,[r]:g=[],statusCode:h,statusDescription:v}=l,b=!1;this.query.scrollId=m,m||(b=!0);let w=typeof c=="function"?await Promise.resolve(c(g)):g;w.length===0&&(b=!0);let T=h>=400&&v?new W(h,v):void 0;return{total:f,done:b,pageCount:g.length,items:w,error:T}}}};function N(s){let n,t,e={async roles(i=!0){if(n&&i===!0)return n;let o=await s.get("/api/v2/users/roles");return i&&(n=o),o},async getRoleByName(i,o=!0){let r=await e.roles(o),p=r.find(a=>a.roleType===i||a.name===i);if(!p)throw new TypeError(`Invalid Role Name ${i}. Valid values are: ${r.flatMap(a=>a.roleType?[a.roleType,a.name]:[a.name]).join(", ")}`);return{id:p.id,name:p.roleType||p.name}},async customFields(i=!0){if(t&&i===!0)return t;let o=await s.get("/api/v2/video-fields",void 0,{responseType:"json"});return i&&(t=o),o},async getCustomFieldByName(i,o=!0){let r=await e.customFields(o),p=r.find(a=>a.name===i);if(!p)throw new TypeError(`Invalid Custom Field Name ${i}. Valid values are: ${r.map(a=>a.name).join(", ")}`);return p},async brandingSettings(){return s.get("/api/v2/accounts/branding-settings")},async webcastRegistrationFields(){return(await s.get("/api/v2/accounts/webcast-registration-fields")).registrationFields},async createWebcastRegistrationField(i){return(await s.post("/api/v2/accounts/webcast-registration-fields",i)).fieldId},async updateWebcastRegistrationField(i,o){return s.put(`/api/v2/accounts/webcast-registration-fields/${i}`,o)},async deleteWebcastRegistrationField(i){return s.delete(`/api/v2/accounts/webcast-registration-fields/${i}`)},listIQCreditsUsage(i,o){let r={endpoint:"/api/v2/analytics/accounts/iq-credits-usage",totalKey:"total",hitsKey:"sessions"};return new R(s,r,i,o)},async verifySystemHealth(){return await s.get("/api/v2/system-health"),!0},async maintenanceSchedule(){let{schedules:i}=await s.get("/api/v2/maintenance-schedule");return i},async userLocationService(){return s.get("/api/v2/user-location")},async expirationRules(){return s.get("/api/v2/expiration-rules")},async featureSettings(i){let o=i?{videoId:i}:void 0;return s.get("/api/v2/videos/feature-settings",o)}};return e}function Me(s){s=s.replace(/(\r\n|\n|\r)/gm,`
`).replace(/\n$/g,"");let n="",t=!1,e=!1,i="",o=[],r=[],p,a=s.length;function c(l){if(e)return l;if(l!=="")return l.trim()}for(p=0;p<a;p+=1)n=s.charAt(p),!t&&(n===","||n===`
`)?(i=c(i),o.push(i),n===`
`&&(r.push(o),o=[]),i="",e=!1):n==='"'?t?s.charAt(p+1)==='"'?(i+='"',p+=1):t=!1:(t=!0,e=!0):i+=n===`
`?`
`:n;i=c(i),o.push(i),r.push(o);let u=r.shift();return r.map(l=>{let m={};return l.forEach((f,g)=>{f!==void 0&&(m[u[g]]=f)}),m})}function ft(s){return{messageKey:s.MessageKey,entityKey:s.EntityKey,when:s.When,entityId:s.EntityId,principal:C(s.Principal)||{},message:C(s.Message)||{},currentState:C(s.CurrentState)||{},previousState:C(s.PreviousState)||{}}}var x=class extends U{constructor(t,e,i="audit records",{toDate:o,fromDate:r,beforeRequest:p,...a}={}){if(!o&&"endDate"in a)throw new TypeError("Audit API uses toDate param instead of endDate");if(!r&&"startDate"in a)throw new TypeError("Audit API uses fromDate param instead of startDate");super({onProgress:(l,m,f)=>{t.log("debug",`loading ${i}, ${m} of ${f}...`)},...a});d(this,"params");d(this,"_req");let{from:c,to:u}=this._parseDates(r,o);this.params={toDate:u.toISOString(),fromDate:c.toISOString()},this._req=this._buildReqFunction(t,e,p)}_requestPage(){return this._req()}_buildReqFunction(t,e,i){return async()=>{await i?.(this);let o=await t.request("GET",e,this.params,{responseType:"text"}),{body:r,headers:p}=o,a=Me(r).map(l=>ft(l)),c=parseInt(p.get("totalRecords")||"",10);Object.assign(this.params,{nextContinuationToken:p.get("nextContinuationToken")||void 0,fromDate:p.get("nextfromDate")||void 0});let u=!this.params.nextContinuationToken;return{items:a,total:Math.max(this.total||0,c),done:u}}}_parseDates(t,e){let i=k(e,new Date),o=new Date(i);o.setFullYear(i.getFullYear()-1);let r=k(t,o);return i<r&&([i,r]=[r,i]),{from:r,to:i}}};function z(s,n){let t=We(n).auditEndpoint;function e(){if(!t)return p=>p;let r=we("auditEndpoint",t);return(p={})=>({...p,async beforeRequest(a){return await r(),p.beforeRequest?.(a)}})}let i={accountAccess:e(),userAccess:e(),accountUsers:e(),user:e(),accountGroups:e(),group:e(),accountDevices:e(),device:e(),accountVideos:e(),video:e(),accountWebcasts:e(),webcast:e(),principal:e()};return{accountAccess(r,p){let a=i.accountAccess(p);return new x(s,`/network/audit/accounts/${r}/userAccess`,"UserAccess",a)},userAccess(r,p,a){let c=i.userAccess(a);return new x(s,`/network/audit/accounts/${p}/userAccess/${r}`,`UserAccess_${r}`,c)},accountUsers(r,p){let a=i.accountUsers(p);return new x(s,`/network/audit/accounts/${r}/users`,"User",a)},user(r,p,a){let c=i.user(a);return new x(s,`/network/audit/accounts/${p}/users/${r}`,"User",c)},accountGroups(r,p){let a=i.accountGroups(p);return new x(s,`/network/audit/accounts/${r}/groups`,"Groups",a)},group(r,p,a){let c=i.group(a);return new x(s,`/network/audit/accounts/${p}/groups/${r}`,"Group",c)},accountDevices(r,p){let a=i.accountDevices(p);return new x(s,`/network/audit/accounts/${r}/devices`,"Devices",a)},device(r,p,a){let c=i.device(a);return new x(s,`/network/audit/accounts/${p}/devices/${r}`,"Device",c)},accountVideos(r,p){let a=i.accountVideos(p);return new x(s,`/network/audit/accounts/${r}/videos`,"Videos",a)},video(r,p,a){let c=i.video(a);return new x(s,`/network/audit/accounts/${p}/videos/${r}`,"Video",c)},accountWebcasts(r,p){let a=i.accountWebcasts(p);return new x(s,`/network/audit/accounts/${r}/scheduledEvents`,"Webcasts",a)},webcast(r,p,a){let c=i.webcast(a);return new x(s,`/network/audit/accounts/${p}/scheduledEvents/${r}`,"Webcast",c)},principal(r,p,a){let c=i.principal(a);return new x(s,`/network/audit/accounts/${p}/principals/${r}`,"Principal",c)}}}function L(s,n){let t=new y.Headers(s);return new y.Headers(n).forEach((e,i)=>t.set(i,e)),t}var ht="http://rev";function Ne(s,n,t){let e=new URL("/api/v2/oauth2/authorize",s.revUrl);return e.search=new URLSearchParams({client_id:s.oauthApiKey,code_challenge:n,response_type:"code",redirect_uri:s.redirectUri,...t&&{state:t}}).toString(),e.toString()}async function ze(s=y.randomValues(48)){let n=await y.sha256Hash(s);return{codeVerifier:s,codeChallenge:n}}async function Te(s,n,t="1"){let{hmacSign:e}=y,i="code",{oauthApiKey:o,redirectUri:r}=s,a=`${o}::${new Date().toISOString()}`,c=await e(a,n);return{apiKey:o,signature:c,verifier:a,redirect_uri:r,response_type:i,state:t}}function Je(s){typeof s=="string"&&(s=new URL(s,ht)),s instanceof URL&&(s=s.searchParams);let n=s instanceof URLSearchParams?Object.fromEntries(s):s,{auth_code:t="",state:e="",error:i=void 0}=n;return{isSuccess:!i,authCode:`${t}`.replace(/ /g,"+"),state:e,error:i}}function J(s){let n={async loginToken(t,e,i){return s.post("/api/v2/authenticate",{apiKey:t,secret:e},i)},async extendSessionToken(t){return s.post(`/api/v2/auth/extend-session-timeout/${t}`)},async logoffToken(t){return s.delete(`/api/v2/tokens/${t}`)},async loginUser(t,e,i){return s.post("/api/v2/user/login",{username:t,password:e},i)},async logoffUser(t){return s.post("/api/v2/user/logoff",{userId:t})},async extendSessionUser(t){return s.post("/api/v2/user/extend-session-timeout",{userId:t})},async loginJWT(t,e){return s.get("/api/v2/jwtauthenticate",{jwt_token:t},e)},async loginGuestRegistration(t,e,i){let o={...i,headers:L(i?.headers,{"x-requested-with":"xmlhttprequest"})};return s.post(`/external/auth/jwt/${t}`,{token:`vbrick_rev ${e}`},i)},async extendSession(){return s.post("/api/v2/user/extend-session")},async verifySession(){return s.get("/api/v2/user/session")},get logoutUser(){return n.logoffUser},get logoutToken(){return n.logoffToken},async buildOAuth2Authentication(t,e="1",i){let{codeChallenge:o,codeVerifier:r}=await ze(i),p={revUrl:s.url,...t};return{url:`${Ne(p,o,e)}`,codeVerifier:r}},async loginOAuth2(t,e,i,o){return s.post("/api/v2/oauth2/token",{code:e.replace(/ /g,"+"),client_id:t.oauthApiKey,grant_type:"authorization_code",redirect_uri:t.redirectUri,code_verifier:i},o)},async buildOAuthAuthenticationURL(t,e,i="1"){let o=await Te(t,e,i),r=new URL("/api/v2/oauth/authorization",s.url);return r.search=`${new URLSearchParams(o)}`,`${r}`},buildOAuthAuthenticationQuery:Te,parseOAuthRedirectResponse:Je,async loginOAuth(t,e){let i="authorization_code",{oauthApiKey:o,redirectUri:r}=t;return e=e.replace(/ /g,"+"),s.post("/api/v2/oauth/token",{authCode:e,apiKey:o,redirectUri:r,grantType:i})},async extendSessionOAuth(t,e){let i="refresh_token",{oauthApiKey:o}=t;return s.post("/api/v2/oauth/token",{apiKey:o,refreshToken:e,grantType:i})}};return n}function Q(s){return{async create(t){return s.post("/api/v2/categories",t,{responseType:"json"})},async details(t){return s.get(`/api/v2/categories/${t}`,void 0,{responseType:"json"})},async update(t,e){return s.put(`/api/v2/categories/${t}`,e)},async delete(t){return s.delete(`/api/v2/categories/${t}`)},async list(t,e){let i=Object.assign({},t&&{parentCategoryId:t},e!=null&&{includeAllDescendants:e}),{categories:o}=await s.get("/api/v2/categories",i,{responseType:"json"});return o},async listAssignable(){return s.get("/api/v2/assignable-categories")}}}function Z(s){return{async create(t){let{channelId:e}=await s.post("/api/v2/channels",t,{responseType:"json"});return e},async update(t,e){return s.put(`/api/v2/channels/${t}`,e)},async patch(t,e,i){await s.patch(`/api/v2/channels/${t}`,e,i)},async delete(t){return s.delete(`/api/v2/channels/${t}`)},list(t=0,e={}){return new Ae(s,t,e)},async addMembers(t,e){let i=e.map(o=>({op:"add",path:"/Members/-",value:o}));await s.patch(`/api/v2/channels/${t}`,i)},async removeMembers(t,e){let i=e.map(o=>({op:"remove",path:"/Members",value:typeof o=="string"?o:o.id}));await s.patch(`/api/v2/channels/${t}`,i)},get uploadLogo(){return s.upload.channelLogo},get uploadHeader(){return s.upload.channelHeader},async downloadLogo(t,e){let i=t?.logoKey?`/api/v2/channels/thumbnails/${t?.logoKey}`:t?.logoUri;if(!i)throw new TypeError("Channel has no logo");return await s.request("GET",i,void 0,{responseType:"stream",...e})},async downloadHeader(t,e){let i=t?.headerKey?`/api/v2/channels/thumbnails/${t?.headerKey}`:t?.headerUri;if(!i)throw new TypeError("Channel has no header");return await s.request("GET",i,void 0,{responseType:"stream",...e})},search(t,e={}){let i={endpoint:`/api/v2/search/access-entity${e?.assignable?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities"},o={type:e.type||"Channel",...t&&{q:t}};return new R(s,i,o,e)},async listUserChannels(t){return s.get("/api/v2/search/channels",void 0,t)}}}var Ae=class{constructor(n,t=0,e={}){d(this,"currentPage");d(this,"current");d(this,"total");d(this,"done");d(this,"options");d(this,"_req");this.options={maxResults:1/0,pageSize:10,onProgress:(i,o,r)=>{n.log("debug",`loading channels, ${o} of ${r}...`)},...e},this.current=0,this.total=1/0,this.done=!1,this.currentPage=t,this._req=()=>{let i={page:this.currentPage,size:this.options.pageSize};return n.get("/api/v2/channels",i,{responseType:"json"})}}async nextPage(){let{maxResults:n,onProgress:t}=this.options,e=this.current,i=await this._req();if((!Array.isArray(i)||i.length==0)&&(this.done=!0,i=[]),e+i.length>=n){let o=n-e;i=i.slice(0,o),this.done=!0}return this.total=e+i.length,t(i,e,this.total),this.current+=i.length,this.currentPage+=1,{current:e,total:this.total,done:this.done,items:i}}async exec(){let n=[];for await(let t of this)n.push(t);return n}async*[Symbol.asyncIterator](){do{let{items:n}=await this.nextPage();for await(let t of n)yield t}while(!this.done)}};function Rt(s){let n={deviceId:s.deviceId,deviceName:s.deviceName,deviceType:s.deviceType};return{...s,items:s.items.map(t=>({...n,...t}))}}var Y=class extends R{constructor(n,t,e={}){let{accountId:i,deviceId:o,...r}=t,p=o?`/api/v2/devices/${o}/logs`:i?`/api/v2/devices/accounts/${i}/logs`:void 0;if(!p)throw new TypeError("Must specify accountId or deviceId");let a={endpoint:p,totalKey:"total",hitsKey:"items",request:async(c,u,l)=>{let m=await n.get(c,u,l);return o?Rt(m):m}};super(n,a,t,e)}};function X(s){return{async listDMEs(){return(await s.get("/api/v2/devices/dmes")).devices},async listZoneDevices(){return(await s.get("/api/v2/zonedevices")).devices},async listPresentationProfiles(){return s.get("/api/v2/presentation-profiles")},async add(t){return s.post("/api/v2/devices/dmes",t)},async healthStatus(t){return s.get(`/api/v2/devices/dmes/${t}/health-status`)},async delete(t){return s.delete(`/api/v2/devices/dmes/${t}`)},async rebootDME(t){return s.put(`/api/v2/devices/dmes/${t}`)},async prepositionVideos(t,e,i){let o=Array.isArray(e)?e:[e];return s.post(`/api/v2/devices/dmes/${t}/prepositioned-videos`,o,i)},getLogs(t,e){return new Y(s,t,e)}}}function ee(s){let n={async create(t){let{groupId:e}=await s.post("/api/v2/groups",t);return e},async delete(t){await s.delete(`/api/v2/groups/${t}`)},async details(t){return s.get(`/api/v2/groups/${t}`)},search(t,e={}){let i={endpoint:`/api/v2/search/access-entity${e?.assignable?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities",transform:r=>r.map(vt)},o={type:"group"};return t&&(o.q=t),new R(s,i,o,e)},list(t={}){return n.search(void 0,t)},listUsers(t,e={}){let i={endpoint:`/api/v2/search/groups/${t}/users`,totalKey:"totalUsers",hitsKey:"userIds"};return new R(s,i,void 0,e)},listUserDetails(t,e={}){let i={endpoint:`/api/v2/search/groups/${t}/users`,totalKey:"totalUsers",hitsKey:"userIds",transform:async o=>{let r=[];for(let p of o){let a={userId:p};try{let c=await s.user.details(p);Object.assign(a,c)}catch(c){a.error=c}r.push(a)}return r}};return new R(s,i,void 0,e)}};return n}function vt(s){return{id:s.Id,name:s.Name,entityType:s.EntityType}}function Pt(s,n){let t=["scrollId","statusCode","statusDescription"];return Object.fromEntries(Object.entries(s).filter(([i,o])=>!(i===n||t.includes(i)||Array.isArray(o))))}var te=class extends R{constructor(t,e,i={},o={}){let r={endpoint:`/api/v2/playlists/${e}`,totalKey:"totalVideos",hitsKey:"videos",request:async(p,a,c)=>{await t.session.queueRequest("searchVideos");let u=await t.get(p,a,c);return Object.assign(this.playlist,Pt(u,"videos")),u}};super(t,r,i,o);d(this,"playlist",{})}get playlistName(){return this.playlist.playlistDetails?.name||this.playlist.name}get searchFilter(){return this.playlist?.playlistType==="Dynamic"?this.playlist.playlistDetails?.searchFilter||this.playlist.searchFilter:void 0}async getPlaylistInfo(){this.options.maxResults=0;let{items:t}=await this.nextPage();return{...this.playlist,...this.playlist?.playlistDetails,videos:t,playlistName:this.playlistName,searchFilter:this.searchFilter}}};function se(s){return{async create(t,e){let o=Array.isArray(e)?{name:t,playlistType:"Static",videoIds:e}:{name:t,playlistType:"Dynamic",playlistDetails:e},{playlistId:r}=await s.post("/api/v2/playlists",o,{responseType:"json"});return r},async details(t,e){return s.get(`/api/v2/playlists/${t}`,e,{responseType:"json"})},listVideos(t,e,i){return new te(s,t,e,i)},async update(t,e){let o=Array.isArray(e)?{playlistVideoDetails:e}:{playlistDetails:e};return s.put(`/api/v2/playlists/${t}`,o)},async updateFeatured(t){let e={playlistVideoDetails:t};return s.put("/api/v2/playlists/featured-playlist",e)},async delete(t){return s.delete(`/api/v2/playlists/${t}`)},async list(){function t(p){let{id:a,playlistId:c,featurePlaylistId:u,featuredPlaylist:l,name:m,playlistName:f,...g}=p;return{...g,id:a??c??u??l,name:m??f,videos:p.videos??p.Videos}}let e=await s.get("/api/v2/playlists",void 0,{responseType:"json"}),i=!Array.isArray(e),r={playlists:(i?e.playlists:e).map(t)};return i&&(P(e.featuredPlaylist)?r.featuredPlaylist=t(e.featuredPlaylist):Array.isArray(e.videos)&&(r.featuredPlaylist=t(e))),r}}}function ie(s){return{async startVideoConferenceRecording(t,e,i){let{videoId:o}=await s.post("/api/v2/vc/start-recording",{title:i,sipAddress:t,sipPin:e},{responseType:"json"});return o},async getVideoConferenceStatus(t){let{status:e}=await s.get(`/api/v2/vc/recording-status/${t}`,void 0,{responseType:"json"});return e},async stopVideoConferenceRecording(t){let e={videoId:t},i=await s.post("/api/v2/vc/stop-recording",e,{responseType:"json"});return P(i)?i.message:i},async startPresentationProfileRecording(t){let{scheduledRecordingId:e}=await s.post("/api/v2/pp/start-recording",t,{responseType:"json"});return e},async getPresentationProfileStatus(t){return await s.get(`/api/v2/pp/recording-status/${t}`,void 0,{responseType:"json"})},async stopPresentationProfileRecording(t){let e={scheduledRecordingId:t};return await s.get("/api/v2/vc/recording-status",e,{responseType:"json"})}}}function S(s,n){let{filename:t,contentType:e,contentLength:i,useChunkedTransfer:o,defaultContentType:r=n,...p}=s;return{requestOptions:p,uploadOptions:{...t&&{filename:t},...e&&{contentType:e},...i&&{contentLength:i},...o&&{useChunkedTransfer:o},defaultContentType:r}}}function ne(s){return{async video(t,e={uploader:s.session.username??""},i={}){let{uploadOptions:o,requestOptions:r}=S(i,"video/mp4"),p=new y.FormData;if(!e.uploader){let u=s.session.username;if(u)e.uploader=u;else throw new TypeError("metadata must include uploader parameter")}V(p,"video",e);let a=await A(p,"VideoFile",t,o);s.log("info",`Uploading ${a.filename} (${a.contentType})`),await s.session.queueRequest("uploadVideo");let{videoId:c}=await O(s,"POST","/api/v2/uploads/videos",p,a,r);return c},async replaceVideo(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"video/mp4"),p=new y.FormData,a=await A(p,"VideoFile",e,o);s.log("info",`Replacing ${t} with ${a.filename} (${a.contentType})`),await s.session.queueRequest("uploadVideo"),await O(s,"PUT",`/api/v2/uploads/videos/${t}`,p,a,r)},async transcription(t,e,i="en",o={}){let{uploadOptions:r,requestOptions:p}=S(o,"application/x-subrip"),a=new y.FormData,c=i.toLowerCase();(r.contentType==="text/plain"||r.filename?.endsWith("txt"))&&(r.filename=`${r.filename||"upload"}.srt`);let u=await A(a,"File",e,r),l={files:[{language:c,fileName:u.filename}]};V(a,"TranscriptionFiles",l),s.log("info",`Uploading transcription to ${t} ${c} ${u.filename} (${u.contentType})`),await O(s,"POST",`/api/v2/uploads/transcription-files/${t}`,a,u,p)},async supplementalFile(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i),p=new y.FormData,a=await A(p,"File",e,o),c={files:[{fileName:a.filename}]};V(p,"SupplementalFiles",c),s.log("info",`Uploading supplemental content to ${t} ${a.filename} (${a.contentType})`),await O(s,"POST",`/api/v2/uploads/supplemental-files/${t}`,p,a,r)},async chapters(t,e,i="replace",o={}){let{uploadOptions:r,requestOptions:p}=S(o,"image/png"),a=new y.FormData,c={chapters:[]};for(let[l,m]of e.entries()){let{title:f,time:g,imageFile:h,uploadOptions:v={}}=m,b={time:g};if(f&&(b.title=f),h){let w={...r,filename:`chapter${l+1}`,...v},T=await A(a,"File",h,w);b.imageFile=T.filename}c.chapters.push(b)}V(a,"Chapters",c),s.log("info",`${i==="replace"?"Uploading":"Updating"} ${c.chapters.length} chapters to ${t}`),await O(s,i==="replace"?"POST":"PUT",`/api/v2/uploads/chapters/${t}`,a,r,p)},async thumbnail(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a=await A(p,"ThumbnailFile",e,o);s.log("info",`Uploading thumbnail for ${t} ${a.filename} (${a.contentType})`),await O(s,"POST",`/api/v2/uploads/images/${t}`,p,a,r)},async presentationChapters(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"application/vnd.ms-powerpoint"),p=new y.FormData,a=await A(p,"PresentationFile",e,o);s.log("info",`Uploading presentation for ${t} ${a.filename} (${a.contentType})`),await O(s,"POST",`/api/v2/uploads/video-presentations/${t}`,p,a,r)},async webcastPresentation(t,e,i){let{uploadOptions:o,requestOptions:r}=S(i,"application/vnd.ms-powerpoint"),p=new y.FormData,a=await A(p,"PresentationFile",e,o);s.log("info",`Uploading presentation for ${t} ${a.filename} (${a.contentType})`),await O(s,"POST",`/api/v2/uploads/presentations/${t}`,p,a,r)},async webcastBackground(t,e,i){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a=await A(p,"ImageFile",e,o);s.log("info",`Uploading background image for ${t} ${a.filename} (${a.contentType})`),await O(s,"POST",`/api/v2/uploads/background-image/${t}`,p,a,r)},async webcastProducerLayoutBackground(t,e,i){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a=await A(p,"ImageFile",e,o);s.log("info",`Uploading producer layout background image for ${t} ${a.filename} (${a.contentType})`),await O(s,"POST",`/api/v2/uploads/webcast-producer-bgimage/${t}`,p,a,r)},async webcastBranding(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a={...o,filename:"logo",...e.logoImageOptions??{}},c={...o,filename:"background",...e.logoImageOptions??{}},u=await A(p,"LogoImageFile",e.logoImage,a),l=await A(p,"BackgroundImageFile",e.backgroundImage,c),m={...e.branding,logoImageFilename:u.filename,backgroundImageFilename:l.filename};V(p,"Branding",m),s.log("info",`Uploading webcast branding to ${t} (${m.logoImageFilename} ${m.backgroundImageFilename})`),await O(s,"POST",`/api/v2/uploads/webcast-branding/${t}`,p,o,r)},async channelLogo(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a=await A(p,"ImageFile",e,o);s.log("info",`Uploading channel logo for ${t} (${a.filename} ${a.contentType})`),await O(s,"POST",`/api/v2/uploads/channel-logo/${t}`,p,a,r)},async channelHeader(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a=await A(p,"ImageFile",e,o);s.log("info",`Uploading channel header for ${t} (${a.filename} ${a.contentType})`),await O(s,"POST",`/api/v2/uploads/channel-header/${t}`,p,a,r)},async userProfileImage(t,e,i={}){let{uploadOptions:o,requestOptions:r}=S(i,"image/jpeg"),p=new y.FormData,a=await A(p,"ImageFile",e,o);await O(s,"POST",`/api/v2/uploads/profile-image/${t}`,p,a,r)}}}function oe(s){async function n(e,i={}){let{lookupType:o,...r}=typeof i=="string"?{lookupType:i}:i,p=o==="username"||o==="email"?{type:o}:void 0,a=await s.get(`/api/v2/users/${e}`,p,{...r,responseType:"json"});return Array.isArray(a)?a[0]:a}let t={get roles(){return s.admin.roles},async create(e){let{userId:i}=await s.post("/api/v2/users",e);return i},async delete(e){await s.delete(`/api/v2/users/${e}`)},details:n,async profile(e){return n("me",e)},async getByUsername(e){return t.details(e,{lookupType:"username"})},async getByEmail(e){return t.details(e,{lookupType:"email"})},async exists(e,i){let o=i==="username"||i==="email"?{type:i}:void 0,r=await s.request("GET",`/api/v2/users/${e}`,o,{responseType:"json",throwHttpErrors:!1});return r.statusCode===200?r.body:!1},async addToGroup(e,i){let o=[{op:"add",path:"/GroupIds/-",value:i}];await s.patch(`/api/v2/users/${e}`,o)},async removeFromGroup(e,i){let o=[{op:"remove",path:"/GroupIds",value:i}];await s.patch(`/api/v2/users/${e}`,o)},async suspend(e){let i=[{op:"replace",path:"/ItemStatus",value:"Suspended"}];await s.patch(`/api/v2/users/${e}`,i)},async unsuspend(e){let i=[{op:"replace",path:"/ItemStatus",value:"Active"}];await s.patch(`/api/v2/users/${e}`,i)},search(e,i={}){let{assignable:o=!1}=i,r={endpoint:`/api/v2/search/access-entity${o?"/assignable":""}`,totalKey:"totalEntities",hitsKey:"accessEntities",transform:a=>a.map(bt)},p={type:"user"};return e&&(p.q=e),new R(s,r,p,i)},get listChannels(){return s.channel.listUserChannels},async listSubscriptions(){return s.get("/api/v2/users/subscriptions")},async subscribe(e,i){return s.post("/api/v2/users/subscribe",{id:e,type:i})},async unsubscribe(e,i){return s.post("/api/v2/users/unsubscribe",{id:e,type:i})},async getNotifications(e=!1){return s.get("/api/v2/users/notifications",{unread:e})},async markNotificationRead(e){await s.put("/api/v2/users/notifications",e?{notificationId:e}:void 0)},async loginReport(e,i){let o={...e&&{sortField:e},...i&&{sortOrder:i}};await s.session.queueRequest("loginReport");let{Users:r}=await s.get("/api/v2/users/login-report",o,{responseType:"json"});return r},get uploadProfileImage(){return s.upload.userProfileImage},deleteProfileImage(e){return s.delete(`/api/v2/users/${e}/profile-image`)}};return t}function bt(s){return{userId:s.Id,entityType:s.EntityType,email:s.Email,firstname:s.FirstName,lastname:s.LastName,username:s.UserName,profileImageUri:s.ProfileImageUri}}function Qe(s){async function n(a,c={}){return await s.request("GET",`/api/v2/videos/${a}/download`,void 0,{responseType:"stream",...c})}async function t(a,c={}){let{imageUrl:u}=a,{body:l}=await s.request("GET",u,void 0,{responseType:"blob",...c});return l}async function e(a,c,u){let l=P(a)?a.downloadUrl:`/api/v2/videos/${a}/supplemental-files/${c}`,m=P(c)?c:u,{body:f}=await s.request("GET",l,void 0,{responseType:"blob",...m});return f}async function i(a,c,u){let l=P(a)?a.downloadUrl:`/api/v2/videos/${a}/transcription-files/${c}`,m=P(c)?c:u,{body:f}=await s.request("GET",l,void 0,{responseType:"blob",...m});return f}async function o(a,c={}){let{videoId:u="",imageId:l=""}=typeof a=="string"?{imageId:a}:a;if(!(u||l))throw new TypeError("No video/image specified to download");let m="";u?m=`/api/v2/videos/${u}/thumbnail`:l.startsWith("http")?m=`${l}${l.endsWith(".jpg")?"":".jpg"}`:m=`/api/v2/media/videos/thumbnails/${l}.jpg`;let{body:f}=await s.request("GET",m,void 0,{responseType:"blob",...c});return f}async function r(a,c){let u="";if(typeof a=="string")u=a;else if(a&&typeof a=="object"&&"thumbnailSheetsUri"in a)u=a.thumbnailSheetsUri;else if("videoId"in a&&a.videoId){let{videoId:m,sheetIndex:f="1"}=a;u=`/api/v2/videos/${m}/thumbnail-sheets/${f}`}if(!u)throw new TypeError("No thumbnail sheet specified to download");let{body:l}=await s.request("GET",u,void 0,{responseType:"blob",...c});return l}async function p(a,c,u){let{body:l}=await s.request("GET",`/api/v2/videos/${a}/lms-export/scorm`,c,{responseType:"blob",...u});return l}return{download:n,downloadChapter:t,downloadSupplemental:e,downloadThumbnail:o,downloadTranscription:i,downloadThumbnailSheet:r,downloadLmsScormPackage:p}}function Ze(s){return{listExternalAccess(n,t,e){let i={endpoint:`/api/v2/videos/${n}/external-access`,totalKey:"total",hitsKey:"items"},o=t?{q:t}:void 0;return new R(s,i,o,e)},async createExternalAccess(n,t){await s.post(`/api/v2/videos/${n}/external-access`,t)},async renewExternalAccess(n,t){return s.put(`/api/v2/videos/${n}/external-access`,t)},async deleteExternalAccess(n,t){return s.delete(`/api/v2/videos/${n}/external-access`,t)},async revokeExternalAccess(n,t){return s.put(`/api/v2/videos/${n}/external-access/revoke`,t)}}}var Ye=30,wt="asc";function re(s,n){let t=new Date(s.getTime());return t.setDate(t.getDate()+n),t}function Tt(s){let{incrementDays:n=Ye,sortDirection:t=wt,videoIds:e,startDate:i,endDate:o,...r}=s;return n=Math.min(Math.max(1/24/60,parseFloat(n)||Ye),30),Array.isArray(e)&&(e=e.map(p=>p.trim()).filter(Boolean).join(",")),{incrementDays:n,sortDirection:t,videoIds:e,...At(i,o),...r}}function At(s,n){let t=new Date,e=k(s),i=k(n);return i||(e?(i=re(e,30),i.getTime()>t.getTime()&&(i=t)):i=t),e||(e=re(i,-30)),e.getTime()>i.getTime()&&([e,i]=[i,e]),{startDate:e,endDate:i}}var ae=class extends U{constructor(t,e={},i="/api/v2/videos/report"){super(Tt(e));d(this,"_rev");d(this,"_endpoint");this._endpoint=i,this._rev=t}async _requestPage(){let{startDate:t,endDate:e}=this,{incrementDays:i,sortDirection:o,videoIds:r,scrollId:p}=this.options,a=o==="asc",c=t,u=e,l=!1;a?(u=re(c,i),u>=e&&(l=!0,u=e)):(c=re(u,-1*i),c<=t&&(l=!0,c=t));let m={after:c.toJSON(),before:u.toJSON(),...p&&{scrollId:p},...r&&{videoIds:r}};await this._rev.session.queueRequest("viewReport");let f=await this._rev.post(this._endpoint,m,{responseType:"json"}),g=f.sessions??[];return this.options.scrollId=g.length===0?void 0:f.scrollId,this.options.scrollId?l=!1:l||(a?this.startDate=u:this.endDate=c),{items:g,done:l}}get startDate(){return this.options.startDate}set startDate(t){this.options.startDate=t}get endDate(){return this.options.endDate}set endDate(t){this.options.endDate=t}};function Xe(s){function n(e,i={}){return P(e)?i=e:typeof e=="string"&&(i={...i??{},videoIds:e}),new ae(s,i,"/api/v2/videos/report")}function t(e,i,o=new Date,r){let p=i?{after:new Date(i).toISOString(),before:k(o,new Date).toISOString()}:void 0;return s.get(`/api/v2/videos/${e}/summary-statistics`,p,r)}return{report:n,uniqueSessionsReport(e,i={}){return new ae(s,i,`/api/v2/videos/${e}/report`)},summaryStatistics:t}}function pe(s){async function n(e,i=!1){return(await s.get(`/api/v2/videos/${e}/comments`,i?{showAll:"true"}:void 0)).comments}let t={async setTitle(e,i){let o=[{op:"add",path:"/Title",value:i}];await s.session.queueRequest("updateVideo"),await s.patch(`/api/v2/videos/${e}`,o)},async setCustomField(e,i){let{id:o,value:r}=i,p=[{op:"replace",path:"/CustomFields",value:[{id:o,value:r}]}];await s.session.queueRequest("updateVideo"),await s.patch(`/api/v2/videos/${e}`,p)},async delete(e,i){await s.session.queueRequest("updateVideo"),await s.delete(`/api/v2/videos/${e}`,void 0,i)},async status(e,i){return s.get(`/api/v2/videos/${e}/status`,void 0,i)},async details(e,i){return await s.session.queueRequest("videoDetails"),s.get(`/api/v2/videos/${e}/details`,void 0,i)},async update(e,i,o){await s.session.queueRequest("updateVideo"),await s.put(`/api/v2/videos/${e}`,i,o)},comments:n,async chapters(e,i){try{let{chapters:o}=await s.get(`/api/v2/videos/${e}/chapters`,void 0,i);return o}catch(o){if(o instanceof q&&o.code==="NoVideoChapters")return[];throw o}},async supplementalFiles(e,i){let{supplementalFiles:o}=await s.get(`/api/v2/videos/${e}/supplemental-files`,void 0,i);return o},async thumbnailConfiguration(e,i){let{thumbnailCfg:o}=await s.get(`/api/v2/videos/${e}/thumbnail-config`,void 0,i);return o},async transcriptions(e,i){let{transcriptionFiles:o}=await s.get(`/api/v2/videos/${e}/transcription-files`,void 0,i);return o},get upload(){return s.upload.video},get replace(){return s.upload.replaceVideo},async migrate(e,i,o){await s.session.queueRequest("updateVideo"),await s.put(`/api/v2/videos/${e}/migration`,i,o)},search(e={},i={}){let o={endpoint:"/api/v2/videos/search",totalKey:"totalVideos",hitsKey:"videos",async request(p,a,c){return await s.session.queueRequest("searchVideos"),s.get(p,a,c)}};return new R(s,o,e,i)},searchDetailed(e={},i={}){let o={endpoint:"/api/v2/videos/search",totalKey:"totalVideos",hitsKey:"videos",transform:async p=>{let a=[];for(let c of p){let u=c;try{let l=await t.details(c.id);Object.assign(u,l)}catch(l){u.error=l}a.push(u)}return a}};return new R(s,o,e,i)},async playbackInfo(e){let{video:i}=await s.get(`/api/v2/videos/${e}/playback-url`);return i},async playbackUrls(e,{ip:i,userAgent:o}={},r){let p=i?{ip:i}:void 0,a={...r,...o&&{headers:L(r?.headers,{"User-Agent":o})},responseType:"json"};return s.get(`/api/v2/videos/${e}/playback-urls`,p,a)},...Qe(s),...Xe(s),...Ze(s),listDeleted(e={},i={}){let o={endpoint:"/api/v2/videos/deleted",totalKey:"totalVideos",hitsKey:"deletedVideos",async request(p,a,c){return await s.session.queueRequest("searchVideos"),s.get(p,a,c)}};return new R(s,o,e,i)},async trim(e,i){return await s.session.queueRequest("uploadVideo"),s.post(`/api/v2/videos/${e}/trim`,i)},async convertDualStreamToSwitched(e){return await s.session.queueRequest("updateVideo"),s.put(`/api/v2/videos/${e}/convert-dual-streams-to-switched-stream`)},async edit(e,i,o){return await s.session.queueRequest("uploadVideo"),s.post(`/api/v2/videos/${e}/edit`,i,o)},async patch(e,i,o){await s.session.queueRequest("updateVideo"),await s.patch(`/api/v2/videos/${e}`,i,o)},async generateMetadata(e,i=["all"],o){await s.session.queueRequest("updateVideo"),await s.put(`/api/v2/videos/${e}/generate-metadata`,{metadataGenerationFields:i},o)},async generateMetadataStatus(e,i){let{description:o}=await s.get(`/api/v2/videos/${e}/metadata-generation-status`,void 0,{...i,responseType:"json"});return o.status},async transcribe(e,i,o){let r=typeof i=="string"?{language:i}:i;return s.post(`/api/v2/videos/${e}/transcription`,r,{...o,responseType:"json"})},async transcriptionStatus(e,i,o){return s.get(`/api/v2/videos/${e}/transcriptions/${i}/status`,void 0,{...o,responseType:"json"})},async translate(e,i,o,r){let p={sourceLanguage:i,targetLanguages:typeof o=="string"?[o]:o};return s.post(`/api/v2/videos/${e}/translations`,p,{...r,responseType:"json"})},async getTranslationStatus(e,i,o){let{status:r}=await s.get(`/api/v2/videos/${e}/translations/${i}/status`,void 0,{...o,responseType:"json"});return r},async deleteTranscription(e,i,o){let r=Array.isArray(i)?i.map(p=>p.trim()).join(","):i;await s.delete(`/api/v2/videos/${e}/transcription-files`,r?{locale:r}:void 0,o)},async deleteSupplementalFiles(e,i,o){let r=Array.isArray(i)?i.join(","):i;await s.delete(`/api/v2/videos/${e}/supplemental-files`,{fileIds:r},o)},async deleteChapters(e,i,o){i=Array.isArray(i)?i.join(","):i,await s.delete(`/api/v2/videos/${e}/chapters`,{startTime:i},o)},async deleteComments(e,i,o){i=Array.isArray(i)?i.join(","):i,await s.delete(`/api/v2/videos/${e}/comments`,{commentIds:i},o)},async setAudioLanguage(e,i,o,r){let{id:p,audioTracks:a=[]}=typeof e=="string"?{id:e}:e,c=o??a.findIndex(l=>l.isDefault===!0)??0,u={op:"replace",path:`/audioTracks/${c}`,value:{track:c,languageId:i}};await t.patch(p,[u],r)},async patchAudioTracks(e,i,o){let{id:r,audioTracks:p}=typeof e=="string"?await s.video.details(e):e,a=new Map(p.map(({languageName:u,...l})=>[l.track,l]));for(let{op:u,languageId:l,track:m,value:f}of i){if(u==="add"){if(l??(l=f?.languageId),!l)throw new TypeError("value languageId is required when adding audioTrack");let h={isDefault:f?.isDefault??!1,languageId:l,track:a.size,status:"Adding"};a.set(h.track,h);continue}let g=m!=null&&a.has(m)?a.get(m):[...a.values()].find(h=>h.languageId===l);if(!g&&p.length===1&&(g=a.get(p[0].track)),!g)throw new Error(`Attempt to ${u} audioTrack language ${l} ${m}, but no matching track found`);Object.assign(g,{...f,status:u==="remove"?"Deleting":"Updating"})}let c={op:"replace",path:"/audioTracks",value:[...a.values()]};return t.patch(r,[c],o)},async waitTranscode(e,i={},o){let{pollIntervalSeconds:r=30,timeoutMinutes:p=240,signal:a,ignorePlaybackWhileTranscoding:c=!0,onProgress:u,onError:l=v=>{throw v}}=i,m=1e3*60,f=Date.now()+p*m||1/0,g=Math.max((r||30)*1e3,5e3),h={status:"UploadFailed"};for(;Date.now()<f&&!a?.aborted;){try{h=await t.status(e,i);let{isProcessing:v,overallProgress:b=0,status:w}=h;if(c&&w==="Ready"&&v&&(w="Processing"),w==="ProcessingFailed"&&(b=1,v=!1),Object.assign(h,{status:w,overallProgress:b,isProcessing:v}),u?.(h),b===1&&!v)break}catch(v){await Promise.resolve(l(v))}await _(g,a)}return h}};return t}function et(s,n){let t=["scrollId","statusCode","statusDescription"];return Object.fromEntries(Object.entries(s).filter(([i,o])=>!(i===n||t.includes(i)||Array.isArray(o))))}var ce=class extends R{constructor(n,t,e={},i={}){let o={endpoint:`/api/v2/scheduled-events/${t}/real-time/attendees`,totalKey:"total",hitsKey:"attendees",request:async(r,p,a)=>{await n.session.queueRequest("attendeesRealtime");let c=await n.post(r,p,a),u=et(c,"attendees");return Object.assign(this.summary,u),c}};super(n,o,e,i),this.summary={}}async getSummary(){return this.options.maxResults=0,await this.nextPage(),this.summary}},ue=class extends R{constructor(n,t,e={}){let{eventId:i,runNumber:o}=t,r=o&&o>=0?{runNumber:o}:{},p={endpoint:`/api/v2/scheduled-events/${i}/post-event-report`,totalKey:"totalSessions",hitsKey:"sessions",request:async(a,c,u)=>{let l=await n.request("GET",a,c,{...u,responseType:"json",throwHttpErrors:!1});return await this._assertResponseOk(l),Object.assign(this.summary,et(l.body,"sessions")),l.body}};super(n,p,r,e),this.summary={}}async _assertResponseOk({response:n,statusCode:t,body:e}){if(n.ok)return e;throw t==400&&e?.errorDescription?new q(n,{detail:e.errorDescription}):e||n.bodyUsed?new q(n,e):await q.create(n)}async getSummary(){return this.options.maxResults=0,await this.nextPage(),this.summary}};function le(s){let n={async list(t={},e){return s.get("/api/v2/scheduled-events",t,{...e,responseType:"json"})},search(t,e){let i={endpoint:"/api/v2/search/scheduled-events",totalKey:"total",hitsKey:"events",request:(o,r,p)=>s.post(o,r,p),isPost:!0};return new R(s,i,t,e)},async create(t){let{eventId:e}=await s.post("/api/v2/scheduled-events",t);return e},async details(t,e){return s.get(`/api/v2/scheduled-events/${t}`,void 0,e)},async edit(t,e){return s.put(`/api/v2/scheduled-events/${t}`,e)},async patch(t,e,i){await s.patch(`/api/v2/scheduled-events/${t}`,e,i)},async delete(t){return s.delete(`/api/v2/scheduled-events/${t}`)},async editAccess(t,e){return s.put(`/api/v2/scheduled-events/${t}/access-control`,e)},attendees(t,e,i){return new ue(s,{eventId:t,runNumber:e},i)},realtimeAttendees(t,e,i){return new ce(s,t,e,i)},async questions(t,e){let i=(e??-1)>=0?{runNumber:e}:{};return s.get(`/api/v2/scheduled-events/${t}/questions`,i,{responseType:"json"})},async pollResults(t,e){let i=(e??-1)>=0?{runNumber:e}:{},o=await s.get(`/api/v2/scheduled-events/${t}/poll-results`,i,{responseType:"text"}),{polls:r=[]}=o?JSON.parse(o):{};return r},async comments(t,e){let i=(e??-1)>=0?{runNumber:e}:{};return s.get(`/api/v2/scheduled-events/${t}/comments`,i,{responseType:"json"})},async reactions(t){return s.get(`/api/v2/scheduled-events/${t}/reactions`,void 0,{responseType:"json"})},async status(t,e){return s.get(`/api/v2/scheduled-events/${t}/status`,void 0,e)},async isPublic(t,e){let i=await s.request("GET",`/api/v2/scheduled-events/${t}/is-public`,void 0,{...e,throwHttpErrors:!1,responseType:"json"});return i.statusCode!==401&&i.body?.isPublic},async bulkDelete(t,e){let{body:i}=await s.request("DELETE","/api/v2/scheduled-events",t,e);return i},bulkDeleteStatus(t){return s.get(`/api/v2/scheduled-events/delete-status/${t}`)},async playbackUrls(t,{ip:e,userAgent:i}={},o){let r=e?{ip:e}:void 0,p={...o,...i&&{headers:L(o?.headers,{"User-Agent":i})},responseType:"json"};return s.get(`/api/v2/scheduled-events/${t}/playback-url`,r,p)},async playbackUrl(t,e={}){s.log("debug","webcast.playbackUrl is deprecated - use webcast.playbackUrls instead");let{playbackResults:i}=await n.playbackUrls(t,e);return i},async startEvent(t,e=!1){await s.put(`/api/v2/scheduled-events/${t}/start`,{preProduction:e})},async stopEvent(t,e=!1){await s.delete(`/api/v2/scheduled-events/${t}/start`,{preProduction:e})},async startBroadcast(t){await s.put(`/api/v2/scheduled-events/${t}/broadcast`)},async stopBroadcast(t){await s.delete(`/api/v2/scheduled-events/${t}/broadcast`)},async startRecord(t){await s.put(`/api/v2/scheduled-events/${t}/record`)},async stopRecord(t){await s.delete(`/api/v2/scheduled-events/${t}/record`)},async linkVideo(t,e,i=!0){let o={videoId:e,redirectVod:i};return s.put(`/api/v2/scheduled-events/${t}/linked-video`,o)},async unlinkVideo(t){return s.delete(`/api/v2/scheduled-events/${t}/linked-video`)},async guestRegistration(t,e){return s.get(`/api/v2/scheduled-events/${t}/registrations/${e}`)},async muteAttendee(t,e,i){let o=(i??-1)>=0?{runNumber:i}:{};await s.put(`/api/v2/scheduled-events/${t}/users/${e}/mute`,o)},async unmuteAttendee(t,e,i){let o=(i??-1)>=0?{runNumber:i}:{};await s.delete(`/api/v2/scheduled-events/${t}/users/${e}/mute`,o)},async hideComment(t,e,i){let o=(i??-1)>=0?{runNumber:i}:{};await s.put(`/api/v2/scheduled-events/${t}/comments/${e}/hide`,o)},async unhideComment(t,e,i){let o=(i??-1)>=0?{runNumber:i}:{};await s.delete(`/api/v2/scheduled-events/${t}/comments/${e}/hide`,o)},async createGuestRegistration(t,e){return s.post(`/api/v2/scheduled-events/${t}/registrations`,e)},listGuestRegistrations(t,e={},i){let o={endpoint:`/api/v2/scheduled-events/${t}/registrations`,totalKey:"total",hitsKey:"guestUsers"};return new R(s,o,e,i)},updateGuestRegistration(t,e,i){return s.put(`/api/v2/scheduled-events/${t}/registrations/${e}`,i)},patchGuestRegistration(t,e,i){let o=Object.entries(i).map(([r,p])=>({op:"replace",path:`/${Ce(r)}`,value:p}));return s.put(`/api/v2/scheduled-events/${t}/registrations/${e}`,o)},deleteGuestRegistration(t,e){return s.delete(`/api/v2/scheduled-events/${t}/registrations/${e}`)},resendEmailToExternalPresenter(t,e){return s.post(`/api/v2/scheduled-events/${t}/presenter-resend-email?email=${encodeURIComponent(e)}`)},async listEmbeddedEngagements(t){let{contentLinks:e}=await s.get(`/api/v2/scheduled-events/${t}/embedded-content/links`);return e||[]},addEmbeddedEngagement(t,e){return s.post(`/api/v2/scheduled-events/${t}/embedded-content/link`,e)},setEmbeddedEngagementStatus(t,e,i){return s.put(`/api/v2/scheduled-events/${t}/embedded-content/links/${e}/status`,{isEnabled:i})},updateEmbeddedEngagement(t,e){let{id:i,...o}=e;return s.put(`/api/v2/scheduled-events/${t}/embedded-content/links/${i}`,o)},deleteEmbeddedEngagement(t,e){return s.delete(`/api/v2/scheduled-events/${t}/embedded-content/links/${e}`)},async listBanners(t){let{banners:e}=await s.get(`/api/v2/scheduled-events/${t}/banners`);return e||[]},addBanner(t,e){return s.post(`/api/v2/scheduled-events/${t}/banner`,e)},setBannerStatus(t,e,i){return s.put(`/api/v2/scheduled-events/${t}/banner/${e}/status`,{isEnabled:i})},updateBanner(t,e){let{id:i,...o}=e;return s.put(`/api/v2/scheduled-events/${t}/banner/${i}`,o)},deleteBanner(t,e){return s.delete(`/api/v2/scheduled-events/${t}/banner/${e}`)},get uploadBranding(){return s.upload.webcastBranding},get uploadPresentation(){return s.upload.webcastPresentation},get uploadBackgroundImage(){return s.upload.webcastBackground},deleteBackgroundImage(t){return s.delete(`/api/v2/scheduled-events/${t}/background-image`)},get uploadProducerLayoutBackground(){return s.upload.webcastProducerLayoutBackground},deleteProducerLayoutBackground(t){return s.delete(`/api/v2/scheduled-events/${t}/webcast-producer-bgimage`)}};return n}function de(s){let n={async list(){return s.get("/api/v2/zones",void 0,{responseType:"json"})},async flatList(){let{defaultZone:t,zones:e}=await n.list(),i=[t];function o(r){let{childZones:p=[],...a}=r;i.push(a),p.forEach(o)}return e.forEach(o),i},async create(t){let{zoneId:e}=await s.post("/api/v2/zones",t,{responseType:"json"});return e},async edit(t,e){return s.put(`/api/v2/zones/${t}`,e)},delete(t){return s.delete(`/api/v2/zones/${t}`)},get devices(){return s.device.listZoneDevices}};return n}function me(s){let n="",t="",e,i;async function o(c=!1){if(!n||c){let u=await s.get("/",void 0,{responseType:"text"}).catch(l=>"");n=(/(['"])account\1[:{\s\n]*\1id\1[\s\n:]+\1([0-9a-f-]{36})\1/m.exec(u)||[])[2]||""}return n}async function r(c=!1){if(!t||c){let u=await s.get("/js/version.js",void 0,{responseType:"text"}).catch(l=>"");t=(/buildNumber['":\s\n]*([\d.]+)/m.exec(u)||[])[1]||""}return t}async function p(c=!1){try{return await s.get("/api/v2/accounts/bootstrap",void 0,{responseType:"json"})}catch{let[l,m]=await Promise.all([o(c),r(c)]);return{account:{id:l},environment:{version:m}}}}return{async bootstrap(c=!1){return(!i||c)&&(i=p(c),i.catch(u=>{i=void 0})),await i},async getAccountId(c=!1,u=!1){return(!n||c)&&(n=u?await o(c):(await p(c)).account.id),n},async getRevVersion(c=!1,u=!1){return(!t||c)&&(t=u?await r(c):(await p(c)).environment.version),t},async getUserLocalIp(c=10*1e3,u=!1){if((!e||u)&&(e=await s.get("/api/v2/user-location")),!e?.enabled||e.locationUrls.length===0)return;let l=new AbortController,m=async function(g){try{let{ip:h=""}=await s.get(g,{},{headers:{Authorization:""},responseType:"json",signal:l.signal});return h=`${h}`.split(",")[0].trim(),h&&l.abort(),h}catch(h){s.log("debug",`ULS URL Failed: ${g}`,h);return}},f=setTimeout(()=>l.abort(),c);try{return(await Promise.all(e.locationUrls.map(m))).find(h=>!!h)}finally{clearTimeout(f)}}}}var B=1e3*60,Ot=10,I=Symbol("credentials"),ge=class{constructor(n,t={}){d(this,"_session");d(this,"controller");d(this,"extendOptions");d(this,"error");d(this,"_isExtending",!1);this.extendOptions={extendThresholdMilliseconds:3*B,keepAliveInterval:10*B,verify:!0,...t},Object.defineProperties(this,{_session:{get:()=>n,enumerable:!1}})}getNextExtendTime(){let{expires:n}=this._session;if(!n)return 0;let{keepAliveInterval:t,extendThresholdMilliseconds:e}=this.extendOptions,i=5*1e3,o=n.getTime()-Date.now();return Math.max(i,Math.min(o-e,t))}async _poll(){let{_session:n}=this,t=this._reset(),{signal:e}=t;for(;n.isConnected&&!e.aborted;){let i=this.getNextExtendTime();if(await _(i,e),e.aborted)break;try{this._isExtending=!0,await n.lazyExtend(this.extendOptions)}catch(o){t.abort(),this.error=o}finally{this._isExtending=!1}}}start(){this._isExtending||this._poll()}stop(){this._isExtending||this.controller&&this.controller.abort()}_reset(){this.error=void 0,this._isExtending=!1;let n=this.controller;return this.controller=new y.AbortController,n&&n.abort(),this.controller}get isAlive(){return this.controller&&!this.controller.signal.aborted}},tt;tt=I;var $=class{constructor(n,t,e,i){d(this,"token");d(this,"expires");d(this,"rev");d(this,tt);d(this,"keepAlive");d(this,"_rateLimits");this.expires=new Date,e===!0?this.keepAlive=new ge(this):P(e)&&(this.keepAlive=new ge(this,e));let o;i&&(o=Be(P(i)?i:void 0)),Object.defineProperties(this,{rev:{get(){return n},enumerable:!1},[I]:{get(){return t},enumerable:!1},_rateLimits:{get(){return o},enumerable:!1}})}async login(){this.token=void 0,this.expires=new Date;let{expiration:n,...t}=await this._login();Object.assign(this,t);let e=new Date(n);isNaN(e.getTime())||e.getTime()<this.expires.getTime()?this.expires.setUTCMinutes(this.expires.getUTCMinutes()+Ot):this.expires=e,this.keepAlive&&this.keepAlive.start()}async extend(){let{expiration:n}=await this._extend();this.expires=new Date(n)}async logoff(){this.keepAlive&&this.keepAlive.stop();try{await this._logoff()}finally{this.token=void 0,this.expires=new Date}}async verify(){try{return await this.rev.auth.verifySession(),!0}catch{return!1}}async lazyExtend(n={}){let{extendThresholdMilliseconds:t=3*B,verify:e=!0}=n,{expires:i}=this,o=i?i.getTime()-Date.now():-1;if(o<=0)return await this.login(),!0;if(o>t)try{return await this.extend(),!0}catch(r){this.rev.log("warn","Error extending session - re-logging in",r)}else if(!e||await this.verify())return!1;return await this.login(),!0}async queueRequest(n){await this._rateLimits?.[n]?.()}async clearQueues(n){await Ge(this._rateLimits??{},n)}get isExpired(){let{expires:n}=this;return n?Date.now()>n.getTime():!0}get isConnected(){return!!this.token&&!this.isExpired}get username(){return this[I].username}get hasRateLimits(){return!!this._rateLimits}},xe=class extends ${constructor(){super(...arguments);d(this,"refreshToken")}async _login(){let{oauthConfig:t,authCode:e}=this[I];if(!t||!e)throw new TypeError("OAuth Config / auth code not specified");let{accessToken:i,expiration:o,refreshToken:r,userId:p}=await this.rev.auth.loginOAuth(t,e);return{token:i,expiration:o,refreshToken:r,userId:p}}async _extend(){let{[I]:{oauthConfig:t}}=this,{accessToken:e,expiration:i,refreshToken:o}=await this.rev.auth.extendSessionOAuth(t,this.refreshToken);return Object.assign(this,{token:e,refreshToken:o}),{expiration:i}}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires,refreshToken:this.refreshToken}}},Oe=class extends ${constructor(){super(...arguments);d(this,"refreshToken")}async _login(){let{oauthConfig:t,code:e,codeVerifier:i}=this[I];if(!t||!e||!i)throw new TypeError("OAuth Config / auth code / verifier not specified");let{access_token:o,expires_in:r,refresh_token:p,userId:a}=await this.rev.auth.loginOAuth2(t,e,i),c=Date.now()+parseInt(r,10)*1e3,u=new Date(c).toISOString();return{token:o,expiration:u,refreshToken:p,userId:a}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},Se=class extends ${constructor(){super(...arguments);d(this,"userId")}async _login(){let{username:t,password:e}=this[I];if(!t||!e)throw new TypeError("username/password not specified");let{token:i,expiration:o,id:r}=await this.rev.auth.loginUser(t,e);return{token:i,expiration:o,userId:r}}async _extend(){let{userId:t}=this;return this.rev.auth.extendSessionUser(t)}async _logoff(){let{userId:t}=this;return this.rev.auth.logoffUser(t)}toJSON(){return{token:this.token||"",expiration:this.expires,userId:this.userId}}},Ie=class extends ${async _login(){let{apiKey:n,secret:t}=this[I];if(!n||!t)throw new TypeError("apiKey/secret not specified");return this.rev.auth.loginToken(n,t)}async _extend(){let{apiKey:n}=this[I];return this.rev.auth.extendSessionToken(n)}async _logoff(){let{apiKey:n}=this[I];return this.rev.auth.logoffToken(n)}toJSON(){return{token:this.token||"",expiration:this.expires,apiKey:this[I].apiKey}}},qe=class extends ${async _login(){let{jwtToken:n}=this[I];if(!n)throw new TypeError("JWT Token not specified");let{accessToken:t,expiration:e}=await this.rev.auth.loginJWT(n);return{token:t,expiration:e,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},Ee=class extends ${async _login(){let{webcastId:n,guestRegistrationToken:t}=this[I];if(!t||!n)throw new TypeError("Guest Registration Token or Webcast ID not specified");let{accessToken:e}=await this.rev.auth.loginGuestRegistration(n,t),i=Date.now()+1e3*60*15,o=new Date(i).toISOString();return{token:e,expiration:o,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}},$e=class extends ${async _login(){let{token:n}=this[I].session??{};this.token||(this.token=n);let{expiration:t}=await this.rev.auth.extendSession();return{token:this.token||"",expiration:t,issuer:"vbrick"}}async _extend(){return this.rev.auth.extendSession()}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}get isConnected(){return!0}get isExpired(){return!1}},De=class extends ${async _login(){return this.rev.log("debug","Using client with no authentication (publicOnly) - non-public endpoints will return 401"),{token:this.token||"",expiration:new Date(Date.now()+1440*B).toISOString(),issuer:"vbrick"}}async _extend(){return{expiration:new Date(Date.now()+1440*B).toISOString()}}async _logoff(){}toJSON(){return{token:this.token||"",expiration:this.expires}}get isConnected(){return!0}get isExpired(){return!1}};function st(s,n,t,e){let i,{session:o={},publicOnly:r,...p}=n,{token:a,expiration:c,refreshToken:u,userId:l}=o,m=Date.now(),f=new Date(c||m),g=a&&typeof a=="string"&&f.getTime()>m,h=n.oauthConfig&&n.code&&n.codeVerifier,v=n.oauthConfig&&(n.authCode||g&&u),b=n.apiKey&&(n.secret||g&&!l),w=n.username&&(n.password||g&&l),T=n.jwtToken,F=n.webcastId&&n.guestRegistrationToken;if(h)i=new Oe(s,p,t,e);else if(v)i=new xe(s,p,t,e),u&&(i.refreshToken=u);else if(b)i=new Ie(s,p,t,e);else if(T)i=new qe(s,p,t,e);else if(F)i=new Ee(s,p,t,e);else if(w)i=new Se(s,p,t,e),l&&(i.userId=l);else if(r)i=new De(s,p,!1,e);else if(g)i=new $e(s,{session:o},t,e);else throw new TypeError("Must specify credentials (username+password, apiKey+secret or oauthConfig+authCode)");return g&&(i.token=a,i.expires=f),i}var G=class{constructor(n){d(this,"url");d(this,"logEnabled");d(this,"session");d(this,"admin");d(this,"audit");d(this,"auth");d(this,"category");d(this,"channel");d(this,"device");d(this,"environment");d(this,"group");d(this,"playlist");d(this,"recording");d(this,"upload");d(this,"user");d(this,"video");d(this,"webcast");d(this,"zones");d(this,"_streamPreference");if(!P(n)||!n.url)throw new TypeError("Missing configuration options for client - url and username/password or apiKey/secret");let{url:t,log:e,logEnabled:i=!1,keepAlive:o=!0,rateLimits:r=!1,defaultStreamPreference:p="stream",...a}=n,c=new URL(t);this.url=c.origin,this.session=st(this,a,o,r),this.logEnabled=!!i,e&&(this.log=(u,...l)=>{this.logEnabled&&e(u,...l)}),this._streamPreference=p,Object.defineProperties(this,{admin:{value:N(this),writable:!1},audit:{value:z(this,r),writable:!1},auth:{value:J(this),writable:!1},category:{value:Q(this),writable:!1},channel:{value:Z(this),writable:!1},device:{value:X(this),writable:!1},environment:{value:me(this),writable:!1},group:{value:ee(this),writable:!1},playlist:{value:se(this),writable:!1},recording:{value:ie(this),writable:!1},upload:{value:ne(this),writable:!1},user:{value:oe(this),writable:!1},video:{value:pe(this),writable:!1},webcast:{value:le(this),writable:!1},webcasts:{get:()=>(this.log("debug","webcasts is deprecated - use rev.webcast instead"),this.webcast),enumerable:!1},zones:{value:de(this),writable:!1}})}async request(n,t,e=void 0,i={}){Fe()&&await Ve();let o=new URL(t,this.url);if(o.origin!==this.url)throw new TypeError(`Invalid endpoint - must be relative to ${this.url}`);let{headers:r,responseType:p,throwHttpErrors:a=!0,...c}=i,u=new y.Headers(r);this.session.token&&!u.has("Authorization")&&u.set("Authorization",`VBrick ${this.session.token}`),u.get("Authorization")===""&&u.delete("Authorization");let l={mode:"cors",method:n,...c,headers:u},m=!u.has("Content-Type"),f=n.toUpperCase();if(e)if(["POST","PUT","PATCH"].includes(f))typeof e=="string"?l.body=e:e instanceof y.FormData?(m=!1,l.body=e):P(e)||Array.isArray(e)?l.body=JSON.stringify(e):l.body=e;else if(P(e))for(let[F,K]of Object.entries(e))K instanceof Date&&(K=K.toISOString()),o.searchParams.append(F,K);else throw new TypeError(`Invalid payload for request to ${n} ${t}`);if(u.has("Accept")||u.set("Accept","application/json"),m&&l.body&&u.set("Content-Type","application/json"),this.log("debug",`Request ${n} ${t}`),this.session.hasRateLimits)switch(f){case"GET":await this.session.queueRequest("get");break;case"POST":case"PATCH":case"PUT":case"DELETE":await this.session.queueRequest("post");break}let g=await y.fetch(`${o}`,{...l,method:n,headers:u}),{ok:h,status:v,statusText:b,headers:w}=g;if(!h){if(a){let F=await q.create(g);throw this.log("debug",`Response ${n} ${t} ${v} ${F.code||b}`),F}p=void 0}this.log("debug",`Response ${n} ${t} ${v} ${b}`);let T=g.body;switch(p){case"json":`${w.get("content-length")}`=="0"?T=null:T=await g.json();break;case"text":T=await g.text();break;case"blob":T=await g.blob();break;case"stream":switch(this._streamPreference){case"webstream":T=y.asWebStream(g.body);break;case"nativestream":T=y.asPlatformStream(g.body);break;default:T=g.body}T=g.body;break;case"webstream":T=y.asWebStream(g.body);break;case"nativestream":T=y.asPlatformStream(g.body);break;default:T=await He(g,u.get("Accept"))}return{statusCode:v,headers:w,body:T,response:g}}async get(n,t,e){let{body:i}=await this.request("GET",n,t,e);return i}async post(n,t,e){let{body:i}=await this.request("POST",n,t,e);return i}async put(n,t,e){let{body:i}=await this.request("PUT",n,t,e);return i}async patch(n,t,e){await this.request("PATCH",n,t,e)}async delete(n,t,e){await this.request("DELETE",n,t,e)}async connect(){await Ke(()=>this.session.login(),n=>![401,429].includes(n.status))}async disconnect(){try{await this.session.logoff()}catch(n){this.log("warn",`Error in logoff, ignoring: ${n}`)}}async extendSession(){return this.session.extend()}async verifySession(){return this.session.verify()}get isConnected(){return this.session.isConnected}get token(){return this.session.token}get sessionExpires(){return this.session.expires}get sessionState(){return this.session.toJSON()}set sessionState(n){this.session.token=`${n.token}`,this.session.expires=new Date(n.expiration);for(let t of["apiKey","refreshToken","userId"])t in n&&(this.session[t]=`${n[t]||""}`)}log(n,...t){if(!this.logEnabled)return;let e=new Date().toJSON().replace("T"," ").slice(0,-5);console.debug(`${e} REV-CLIENT [${n}]`,...t)}};var St={rateLimit:j,getExtensionForMime:he,getMimeForExtension:fe,setPolyfills:Le},It=G;return ct(qt);})();
//# sourceMappingURL=rev-client.iife.js.map